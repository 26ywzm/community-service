(function(){"use strict";var e={8313:function(e,t,a){var s=a(5130),o=a(6768),r=a(4232);const i={id:"app"},n={class:"menu-right"};function l(e,t,a,s,l,c){const d=(0,o.g2)("router-link"),u=(0,o.g2)("el-menu-item"),h=(0,o.g2)("el-menu"),m=(0,o.g2)("router-view"),p=(0,o.g2)("van-tabbar-item"),g=(0,o.g2)("van-tabbar");return(0,o.uX)(),(0,o.CE)("div",i,[l.isMobile?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(h,{key:0,"default-active":l.activeIndex,class:(0,r.C4)([{"nav-hidden":l.isNavHidden},"top-menu"]),mode:"horizontal","background-color":"#444","text-color":"#fff","active-text-color":"#1e90ff"},{default:(0,o.k6)((()=>[t[3]||(t[3]=(0,o.Lk)("div",{class:"logo"},"社区服务",-1)),(0,o.Lk)("div",n,[(0,o.bF)(u,{index:"1"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{to:"/"},{default:(0,o.k6)((()=>t[0]||(t[0]=[(0,o.eW)("首页")]))),_:1})])),_:1}),(0,o.bF)(u,{index:"2"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{to:"/discover"},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)("发现")]))),_:1})])),_:1}),(0,o.bF)(u,{index:"3"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{to:"/profile"},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("我的")]))),_:1})])),_:1})])])),_:1},8,["default-active","class"])),(0,o.Lk)("div",{class:(0,r.C4)({"content-padding":!l.isNavHidden&&!l.isMobile}),style:{"margin-bottom":"60px"}},[(0,o.bF)(m)],2),l.isMobile?((0,o.uX)(),(0,o.Wv)(g,{key:1,route:""},{default:(0,o.k6)((()=>[(0,o.bF)(p,{replace:"",to:"/",icon:"home-o"},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.eW)(" 首页 ")]))),_:1}),(0,o.bF)(p,{replace:"",to:"/discover",icon:"apps-o"},{default:(0,o.k6)((()=>t[5]||(t[5]=[(0,o.eW)(" 发现 ")]))),_:1}),(0,o.bF)(p,{to:c.profilePath,icon:"user-o",onClick:c.handleProfileClick},{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.eW)(" 我的 ")]))),_:1},8,["to","onClick"])])),_:1})):(0,o.Q3)("",!0)])}a(4114);var c={data(){return{isMobile:!1,isNavHidden:!1,lastScrollTop:0,activeIndex:"1"}},computed:{profilePath(){localStorage.getItem("authToken");return"/profile"}},mounted(){this.checkDevice(),window.addEventListener("resize",this.checkDevice),window.addEventListener("scroll",this.handleScroll)},methods:{checkDevice(){this.isMobile=window.innerWidth<=768},handleScroll(){const e=window.pageYOffset||document.documentElement.scrollTop;this.isNavHidden=e>this.lastScrollTop&&e>100,this.lastScrollTop=e},handleProfileClick(){const e=localStorage.getItem("authToken");e||this.$router.push("/profile")}}},d=a(1241);const u=(0,d.A)(c,[["render",l],["__scopeId","data-v-34c96f02"]]);var h=u,m=a(1387);const p={class:"home-container"},g=["src"],k={class:"hot-news"},v={class:"hot-news-grid"},f=["src"],L={class:"news-list"},w={class:"news-date"};function b(e,t,a,s,i,n){const l=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("div",{class:"carousel",onMouseenter:t[2]||(t[2]=(...e)=>n.pauseCarousel&&n.pauseCarousel(...e)),onMouseleave:t[3]||(t[3]=(...e)=>n.startCarousel&&n.startCarousel(...e))},[i.carouselImages.length>0?((0,o.uX)(),(0,o.Wv)(l,{key:0,to:{name:"NewsDetail",params:{id:i.carouselImages[i.currentImage].id}}},{default:(0,o.k6)((()=>[(0,o.Lk)("img",{src:i.carouselImages[i.currentImage].blobUrl,alt:"轮播图",class:"carousel-image"},null,8,g)])),_:1},8,["to"])):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.prevImage&&n.prevImage(...e))},"‹"),(0,o.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.nextImage&&n.nextImage(...e))},"›")],32),(0,o.Lk)("section",k,[t[4]||(t[4]=(0,o.Lk)("h2",null,"热门新闻",-1)),(0,o.Lk)("div",v,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.hotNews,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"news-item"},[(0,o.bF)(l,{to:{name:"NewsDetail",params:{id:e.id}}},{default:(0,o.k6)((()=>[(0,o.Lk)("img",{src:e.blobUrl,alt:"新闻图片",class:"news-image"},null,8,f)])),_:2},1032,["to"]),(0,o.Lk)("p",null,(0,r.v_)(e.title),1)])))),128))])]),(0,o.Lk)("section",L,[t[5]||(t[5]=(0,o.Lk)("h2",null,"新闻列表",-1)),(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.newsList,(e=>((0,o.uX)(),(0,o.CE)("li",{key:e.id},[(0,o.bF)(l,{to:{name:"NewsDetail",params:{id:e.id}}},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(e.title)+" ",1),(0,o.Lk)("span",w,(0,r.v_)(n.formatDate(e.created_at)),1)])),_:2},1032,["to"])])))),128))])])])}a(4603),a(7566),a(8721);var y=a(4373),I={data(){return{isMobile:!1,isNavHidden:!1,carouselImages:["carousel1.jpg","carousel2.jpg","carousel3.jpg"],currentImage:0,hotNews:[{id:1,title:"社区活动一",image:"hot1.jpg"},{id:2,title:"社区活动二",image:"hot2.jpg"},{id:3,title:"社区活动三",image:"hot3.jpg"}],newsList:[{id:1,title:"新闻条目1"},{id:2,title:"新闻条目2"},{id:3,title:"新闻条目3"}]}},mounted(){this.checkDevice(),window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.checkDevice)},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.checkDevice)},methods:{checkDevice(){this.isMobile=window.innerWidth<=768},handleScroll(){this.isNavHidden=window.scrollY>100},toggleNav(){this.isNavHidden=!this.isNavHidden},prevImage(){this.currentImage=(this.currentImage+this.carouselImages.length-1)%this.carouselImages.length},nextImage(){this.currentImage=(this.currentImage+1)%this.carouselImages.length}}};const C="https://api.26ywzm.icu/api/auth";var _={...I,data(){return{...I.data(),carouselImages:[],hotNews:[],newsList:[],currentImage:0,intervalId:null,imageCache:new Map}},mounted(){this.checkDevice(),window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.checkDevice),this.fetchData(),this.startCarousel()},beforeUnmount(){clearInterval(this.intervalId)},methods:{...I.methods,async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=e.startsWith("/uploads/")?e:`/uploads/${e}`,a=C.replace("/api/auth",""),s=await fetch(`${a}${t}`),o=await s.blob(),r=URL.createObjectURL(o);return this.imageCache.set(e,r),r}catch(t){return console.error("加载图片失败:",t),""}},async fetchData(){try{const e=await y.A.get(`${C}/articles?category=carousel`);this.carouselImages=e.data;for(const s of this.carouselImages)await this.loadImage(s);const t=await y.A.get(`${C}/articles?category=hotNews`);this.hotNews=t.data;for(const s of this.hotNews)await this.loadImage(s);const a=await y.A.get(`${C}/articles?category=newsList`);this.newsList=a.data}catch(e){console.error("获取数据失败:",e)}},startCarousel(){this.intervalId=setInterval((()=>{this.nextImage()}),3e3)},pauseCarousel(){clearInterval(this.intervalId)},nextImage(){this.carouselImages.length>0&&(this.currentImage=(this.currentImage+1)%this.carouselImages.length)},prevImage(){this.carouselImages.length>0&&(this.currentImage=(this.currentImage+this.carouselImages.length-1)%this.carouselImages.length)},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}}};const A=(0,d.A)(_,[["render",b],["__scopeId","data-v-4b5d05a2"]]);var E=A;const S={class:"login-page"},$={class:"login-container"},X={class:"form-group"},U={class:"form-group"},F={class:"password-input"},T=["type"],M={class:"form-footer"},V=["disabled"],D={class:"button-icon"},z={class:"register-link"};function P(e,t,a,i,n,l){const c=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",S,[(0,o.Lk)("div",$,[t[8]||(t[8]=(0,o.Lk)("div",{class:"login-header"},[(0,o.Lk)("div",{class:"logo-container"},[(0,o.Lk)("span",{class:"logo-icon"},"🏠")]),(0,o.Lk)("h2",null,"欢迎回来"),(0,o.Lk)("p",{class:"subtitle"},"请登录您的账户")],-1)),(0,o.Lk)("form",{onSubmit:t[3]||(t[3]=(0,s.D$)(((...e)=>l.login&&l.login(...e)),["prevent"])),class:"login-form"},[(0,o.Lk)("div",X,[t[4]||(t[4]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"📧"),(0,o.eW)(" 邮箱 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",placeholder:"请输入您的邮箱地址"},null,512),[[s.Jo,n.email]])]),(0,o.Lk)("div",U,[t[5]||(t[5]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"🔒"),(0,o.eW)(" 密码 ")],-1)),(0,o.Lk)("div",F,[(0,o.bo)((0,o.Lk)("input",{type:n.showPassword?"text":"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",placeholder:"请输入您的密码"},null,8,T),[[s.hp,n.password]]),(0,o.Lk)("button",{type:"button",class:"toggle-password",onClick:t[2]||(t[2]=e=>n.showPassword=!n.showPassword)},(0,r.v_)(n.showPassword?"👁️":"👁️‍🗨️"),1)])]),(0,o.Lk)("div",M,[(0,o.Lk)("button",{type:"submit",class:"login-button",disabled:n.loading},[(0,o.Lk)("span",D,(0,r.v_)(n.loading?"⌛":"🔑"),1),(0,o.eW)(" "+(0,r.v_)(n.loading?"登录中...":"登录"),1)],8,V),(0,o.Lk)("p",z,[t[7]||(t[7]=(0,o.eW)(" 还没有账号？ ")),(0,o.bF)(c,{to:"/register"},{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.eW)("立即注册")]))),_:1})])])],32)])])}const R="https://api.26ywzm.icu/api/auth";var W={name:"UserLogin",data(){return{email:"",password:"",loading:!1,showPassword:!1}},methods:{async login(){this.loading=!0;try{const e=await y.A.post(`${R}/login`,{email:this.email,password:this.password}),{token:t,user:a}=e.data;switch(localStorage.setItem("authToken",t),localStorage.setItem("userRole",a.role),localStorage.setItem("username",a.username),localStorage.setItem("userId",a.id),localStorage.setItem("email",a.email),a.role){case"super_admin":await this.$router.push("/profile");break;case"admin":await this.$router.push("/profile");break;default:await this.$router.push("/profile")}}catch(e){let t="登录失败，请重试";e.response?.data?.message&&(t=e.response.data.message),alert(t)}finally{this.loading=!1}}}};const x=(0,d.A)(W,[["render",P],["__scopeId","data-v-4c711710"]]);var O=x;const B={class:"register-page"},Q={class:"register-container"},N={class:"form-group"},q={class:"form-group"},j={class:"form-group"},K={class:"password-input"},J=["type"],H={class:"form-group"},Z={class:"password-input"},Y=["type"],G={key:0,class:"password-strength"},ee={class:"strength-meter"},te={class:"form-footer"},ae=["disabled"],se={class:"button-icon"},oe={class:"login-link"};function re(e,t,a,i,n,l){const c=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",B,[(0,o.Lk)("div",Q,[t[14]||(t[14]=(0,o.Lk)("div",{class:"register-header"},[(0,o.Lk)("div",{class:"logo-container"},[(0,o.Lk)("span",{class:"logo-icon"},"✨")]),(0,o.Lk)("h2",null,"创建账户"),(0,o.Lk)("p",{class:"subtitle"},"加入我们的社区")],-1)),(0,o.Lk)("form",{onSubmit:t[6]||(t[6]=(0,s.D$)(((...e)=>l.register&&l.register(...e)),["prevent"])),class:"register-form"},[(0,o.Lk)("div",N,[t[7]||(t[7]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"👤"),(0,o.eW)(" 用户名 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),required:"",placeholder:"请输入用户名"},null,512),[[s.Jo,n.username]])]),(0,o.Lk)("div",q,[t[8]||(t[8]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"📧"),(0,o.eW)(" 邮箱 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",placeholder:"请输入邮箱地址"},null,512),[[s.Jo,n.email]])]),(0,o.Lk)("div",j,[t[9]||(t[9]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"🔒"),(0,o.eW)(" 密码 ")],-1)),(0,o.Lk)("div",K,[(0,o.bo)((0,o.Lk)("input",{type:n.showPassword?"text":"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",placeholder:"请输入密码"},null,8,J),[[s.hp,n.password]]),(0,o.Lk)("button",{type:"button",class:"toggle-password",onClick:t[3]||(t[3]=e=>n.showPassword=!n.showPassword)},(0,r.v_)(n.showPassword?"👁️":"👁️‍🗨️"),1)])]),(0,o.Lk)("div",H,[t[10]||(t[10]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"🔐"),(0,o.eW)(" 确认密码 ")],-1)),(0,o.Lk)("div",Z,[(0,o.bo)((0,o.Lk)("input",{type:n.showConfirmPassword?"text":"password","onUpdate:modelValue":t[4]||(t[4]=e=>n.confirmPassword=e),required:"",placeholder:"请再次输入密码"},null,8,Y),[[s.hp,n.confirmPassword]]),(0,o.Lk)("button",{type:"button",class:"toggle-password",onClick:t[5]||(t[5]=e=>n.showConfirmPassword=!n.showConfirmPassword)},(0,r.v_)(n.showConfirmPassword?"👁️":"👁️‍🗨️"),1)])]),n.password?((0,o.uX)(),(0,o.CE)("div",G,[t[11]||(t[11]=(0,o.Lk)("div",{class:"strength-label"},"密码强度：",-1)),(0,o.Lk)("div",ee,[(0,o.Lk)("div",{class:(0,r.C4)(["strength-bar",l.strengthClass]),style:(0,r.Tr)({width:l.passwordStrength+"%"})},null,6)]),(0,o.Lk)("div",{class:(0,r.C4)(["strength-text",l.strengthClass])},(0,r.v_)(l.strengthText),3)])):(0,o.Q3)("",!0),(0,o.Lk)("div",te,[(0,o.Lk)("button",{type:"submit",class:"register-button",disabled:n.loading||!l.isPasswordMatch},[(0,o.Lk)("span",se,(0,r.v_)(n.loading?"⌛":"✨"),1),(0,o.eW)(" "+(0,r.v_)(n.loading?"注册中...":"注册"),1)],8,ae),(0,o.Lk)("p",oe,[t[13]||(t[13]=(0,o.eW)(" 已有账号？ ")),(0,o.bF)(c,{to:"/login"},{default:(0,o.k6)((()=>t[12]||(t[12]=[(0,o.eW)("立即登录")]))),_:1})])])],32)])])}const ie=(e=!0)=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),e&&Or.push("/login")},ne=(e,t={})=>{const{customErrorHandler:a=null,suppressAuthError:s=!1,showAlert:o=!0}=t;if(console.error("API请求失败:",e),e.response){const t=e.response.status,r=e.response.data?.message||"操作失败，请重试。",i=localStorage.getItem("userRole");if((401===t||403===t)&&"admin"===i)return o&&alert(403===t?"您没有权限执行此操作":"您的操作未被授权，请联系超级管理员"),Promise.reject(e);switch(t){case 403:case 401:s?o&&(alert("您的登录已过期，请重新登录"),Or.push("/login")):ie();break;default:a?a(e):o&&alert(r)}}else e.request?o&&alert("网络错误，请检查您的网络连接。"):o&&alert("请求错误，请重试。");return Promise.reject(e)},le="https://api.26ywzm.icu/api/auth";var ce={name:"UserRegister",data(){return{username:"",email:"",password:"",confirmPassword:"",loading:!1,showPassword:!1,showConfirmPassword:!1}},computed:{isPasswordMatch(){return this.password===this.confirmPassword},passwordStrength(){if(!this.password)return 0;let e=0;return this.password.length>=8&&(e+=25),/\d/.test(this.password)&&(e+=25),/[a-z]/.test(this.password)&&(e+=25),(/[A-Z]/.test(this.password)||/[^A-Za-z0-9]/.test(this.password))&&(e+=25),e},strengthClass(){return this.passwordStrength<=25?"weak":this.passwordStrength<=50?"medium":this.passwordStrength<=75?"good":"strong"},strengthText(){return this.passwordStrength<=25?"弱":this.passwordStrength<=50?"中":this.passwordStrength<=75?"良好":"强"}},methods:{async register(){if(this.password===this.confirmPassword){this.loading=!0;try{await y.A.post(`${le}/register`,{username:this.username,email:this.email,password:this.password}),alert("注册成功！请登录"),this.$router.push("/login")}catch(e){ne(e,(()=>{e.response?.data?.message?alert(e.response.data.message):alert("注册失败，请重试")}))}finally{this.loading=!1}}else alert("两次输入的密码不一致")}}};const de=(0,d.A)(ce,[["render",re],["__scopeId","data-v-22d222ac"]]);var ue=de;const he={class:"discover-container"},me={class:"discover"},pe={key:0,class:"content-wrapper"},ge={key:0,class:"feature-grid"},ke={key:1,class:"orders-section"},ve={class:"order-list"},fe={class:"order-header"},Le={class:"order-number"},we={class:"order-body"},be={class:"order-info"},ye={class:"price"},Ie={class:"date"},Ce=["onClick"],_e={key:2,class:"admin-section"},Ae={class:"feature-grid"},Ee={class:"admin-panel"},Se={class:"panel-header"},$e={key:0,class:"role-info"},Xe={class:"panel-content"},Ue={key:0,class:"error-message"},Fe={class:"user-section"},Te={class:"user-list"},Me={class:"user-info"},Ve={class:"username"},De={key:0,class:"user-actions"},ze=["onClick"],Pe=["onClick"],Re={class:"user-section"},We={class:"user-list"},xe={class:"user-info"},Oe={class:"username"},Be={key:0,class:"user-actions"},Qe=["onClick"],Ne=["onClick"],qe={class:"dialog-footer"},je={key:1,class:"login-prompt"};function Ke(e,t,a,s,i,n){const l=(0,o.g2)("router-link"),c=(0,o.g2)("el-alert"),d=(0,o.g2)("el-button"),u=(0,o.g2)("el-dialog"),h=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",he,[(0,o.Lk)("div",me,[t[22]||(t[22]=(0,o.Lk)("header",{class:"page-header"},[(0,o.Lk)("h1",null,"发现")],-1)),n.isLoggedIn?((0,o.uX)(),(0,o.CE)("div",pe,[n.isAdmin||n.isSuperAdmin?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",ge,[(0,o.bF)(l,{to:"/CanteenOrder",class:"feature-card"},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.Lk)("div",{class:"card-icon"},"🍽️",-1),(0,o.Lk)("span",{class:"card-title"},"社区食堂",-1)]))),_:1}),(0,o.Lk)("div",{class:"feature-card",onClick:t[0]||(t[0]=(...e)=>n.fetchUserOrders&&n.fetchUserOrders(...e))},t[4]||(t[4]=[(0,o.Lk)("div",{class:"card-icon"},"📋",-1),(0,o.Lk)("span",{class:"card-title"},"我的订单",-1)])),(0,o.bF)(l,{to:"/feedback",class:"feature-card"},{default:(0,o.k6)((()=>t[5]||(t[5]=[(0,o.Lk)("div",{class:"card-icon"},"💭",-1),(0,o.Lk)("span",{class:"card-title"},"意见反馈",-1)]))),_:1}),(0,o.bF)(l,{to:"/votelist",class:"feature-card"},{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.Lk)("div",{class:"card-icon"},"📊",-1),(0,o.Lk)("span",{class:"card-title"},"管理投票",-1)]))),_:1})])),i.orders.length>0?((0,o.uX)(),(0,o.CE)("div",ke,[t[7]||(t[7]=(0,o.Lk)("h2",{class:"section-title"},"我的订单",-1)),(0,o.Lk)("div",ve,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.orders,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"order-card"},[(0,o.Lk)("div",fe,[(0,o.Lk)("span",Le,"订单号: "+(0,r.v_)(e.id),1),(0,o.Lk)("span",{class:(0,r.C4)(["order-status",e.status])},(0,r.v_)(n.getOrderStatusText(e.status)),3)]),(0,o.Lk)("div",we,[(0,o.Lk)("div",be,[(0,o.Lk)("div",ye,"¥"+(0,r.v_)(e.total_price),1),(0,o.Lk)("div",Ie,(0,r.v_)(n.formatDate(e.created_at)),1)]),(0,o.Lk)("button",{onClick:t=>n.viewOrderDetails(e.id),class:"view-details-btn"}," 查看详情 ",8,Ce)])])))),128))])])):(0,o.Q3)("",!0),n.isAdmin||n.isSuperAdmin?((0,o.uX)(),(0,o.CE)("div",_e,[(0,o.Lk)("div",Ae,[(0,o.bF)(l,{to:"/articles/new",class:"feature-card admin"},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.Lk)("div",{class:"card-icon"},"📝",-1),(0,o.Lk)("span",{class:"card-title"},"文章编写",-1)]))),_:1}),(0,o.Lk)("div",{class:"feature-card admin",onClick:t[1]||(t[1]=(...e)=>n.openAdminPanel&&n.openAdminPanel(...e))},t[9]||(t[9]=[(0,o.Lk)("div",{class:"card-icon"},"⚙️",-1),(0,o.Lk)("span",{class:"card-title"},"管理模块",-1)])),(0,o.bF)(l,{to:"/canteenadmin",class:"feature-card admin"},{default:(0,o.k6)((()=>t[10]||(t[10]=[(0,o.Lk)("div",{class:"card-icon"},"🏪",-1),(0,o.Lk)("span",{class:"card-title"},"食堂管理",-1)]))),_:1}),(0,o.bF)(l,{to:"/canteen/orders",class:"feature-card admin"},{default:(0,o.k6)((()=>t[11]||(t[11]=[(0,o.Lk)("div",{class:"card-icon"},"📦",-1),(0,o.Lk)("span",{class:"card-title"},"订单管理",-1)]))),_:1}),(0,o.bF)(l,{to:"/managefeedback",class:"feature-card admin"},{default:(0,o.k6)((()=>t[12]||(t[12]=[(0,o.Lk)("div",{class:"card-icon"},"📢",-1),(0,o.Lk)("span",{class:"card-title"},"意见反馈",-1)]))),_:1}),(0,o.bF)(l,{to:"/adminvotes",class:"feature-card admin"},{default:(0,o.k6)((()=>t[13]||(t[13]=[(0,o.Lk)("div",{class:"card-icon"},"🗳️",-1),(0,o.Lk)("span",{class:"card-title"},"管理投票",-1)]))),_:1})])])):(0,o.Q3)("",!0),(0,o.bF)(u,{modelValue:i.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>i.dialogVisible=e),title:"管理模块",width:"90%",fullscreen:i.isMobile,"before-close":n.handleClose,"close-on-click-modal":!1,class:"admin-dialog"},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",qe,[(0,o.bF)(d,{onClick:n.closeDialog,type:"primary"},{default:(0,o.k6)((()=>t[18]||(t[18]=[(0,o.eW)("关闭")]))),_:1},8,["onClick"])])])),default:(0,o.k6)((()=>[(0,o.Lk)("div",Ee,[(0,o.Lk)("div",Se,[t[14]||(t[14]=(0,o.Lk)("h3",null,"管理员和用户列表",-1)),n.isAdmin&&!n.isSuperAdmin?((0,o.uX)(),(0,o.CE)("div",$e,[(0,o.bF)(c,{title:"提示：您可以查看用户列表，但只有超级管理员可以修改权限",type:"info",closable:!1,"show-icon":""})])):(0,o.Q3)("",!0)]),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",Xe,[i.error?((0,o.uX)(),(0,o.CE)("div",Ue,(0,r.v_)(i.error),1)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("div",Fe,[t[15]||(t[15]=(0,o.Lk)("h4",null,"管理员列表",-1)),(0,o.Lk)("div",Te,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.admins,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"user-card"},[(0,o.Lk)("div",Me,[(0,o.Lk)("span",Ve,(0,r.v_)(e.username),1),(0,o.Lk)("span",{class:(0,r.C4)(["role-badge",{super:"super_admin"===e.role}])},(0,r.v_)("super_admin"===e.role?"超级管理员":"管理员"),3)]),n.isSuperAdmin&&"super_admin"!==e.role?((0,o.uX)(),(0,o.CE)("div",De,[(0,o.Lk)("button",{onClick:t=>n.demoteUser(e.id),class:"action-btn demote"},"降为用户",8,ze),(0,o.Lk)("button",{onClick:t=>n.deleteUser(e.id),class:"action-btn delete"},"删除",8,Pe)])):(0,o.Q3)("",!0)])))),128))])]),(0,o.Lk)("div",Re,[t[17]||(t[17]=(0,o.Lk)("h4",null,"用户列表",-1)),(0,o.Lk)("div",We,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.users,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"user-card"},[(0,o.Lk)("div",xe,[(0,o.Lk)("span",Oe,(0,r.v_)(e.username),1),t[16]||(t[16]=(0,o.Lk)("span",{class:"role-badge"},"用户",-1))]),n.isSuperAdmin?((0,o.uX)(),(0,o.CE)("div",Be,[(0,o.Lk)("button",{onClick:t=>n.promoteUser(e.id),class:"action-btn promote"},"升为管理员",8,Qe),(0,o.Lk)("button",{onClick:t=>n.deleteUser(e.id),class:"action-btn delete"},"删除",8,Ne)])):(0,o.Q3)("",!0)])))),128))])])],64))])),[[h,i.loading]])])])),_:1},8,["modelValue","fullscreen","before-close"])])):((0,o.uX)(),(0,o.CE)("div",je,[t[20]||(t[20]=(0,o.Lk)("div",{class:"prompt-icon"},"🔒",-1)),t[21]||(t[21]=(0,o.Lk)("p",null,"请登录以查看内容",-1)),(0,o.bF)(l,{to:"/login",class:"login-btn"},{default:(0,o.k6)((()=>t[19]||(t[19]=[(0,o.eW)("立即登录")]))),_:1})]))])])}const Je="https://api.26ywzm.icu/api/auth",He=async()=>{try{const e=localStorage.getItem("authToken");if(!e)return{valid:!1,reason:"no-token"};const t=await y.A.get(`${Je}/verify`,{headers:{Authorization:`Bearer ${e}`}});return t.data.valid?{valid:!0,role:t.data.role}:t.data.correctRole?(localStorage.setItem("userRole",t.data.correctRole),{valid:!1,reason:"role-mismatch",newRole:t.data.correctRole}):(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),{valid:!1,reason:"invalid-token"})}catch(e){return console.error("验证失败:",e),e.response&&401===e.response.status?(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),{valid:!1,reason:"unauthorized"}):{valid:!0}}};var Ze=a(167);const Ye="https://api.26ywzm.icu/api/auth";var Ge={data(){return{dialogVisible:!1,showAdminPanel:!1,users:[],admins:[],orders:[],verificationInterval:null,loading:!1,error:null,isMobile:window.innerWidth<=768}},computed:{isLoggedIn(){return!!localStorage.getItem("authToken")},isAdmin(){const e=localStorage.getItem("userRole");return"admin"===e},isSuperAdmin(){const e=localStorage.getItem("userRole");return"super_admin"===e}},created(){this.isLoggedIn&&this.startVerification(),window.addEventListener("resize",this.handleResize)},beforeUnmount(){this.verificationInterval&&clearInterval(this.verificationInterval),window.removeEventListener("resize",this.handleResize)},methods:{handleResize(){this.isMobile=window.innerWidth<=768},startVerification(){this.verificationInterval&&clearInterval(this.verificationInterval),this.verifyAndUpdate(),this.verificationInterval=setInterval(this.verifyAndUpdate,3e5)},async verifyAndUpdate(){if(!this.isLoggedIn)return;const e=await He();e.valid||this.handleAuthError(e.reason)},handleAuthError(e){["no-token","invalid-token","unauthorized"].includes(e)&&(localStorage.clear(),this.verificationInterval&&clearInterval(this.verificationInterval),this.$router.push("/login"))},async fetchUserOrders(){try{const e=await y.A.get(`${Ye}/orders/user`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});this.orders=e.data.orders||e.data||[],0===this.orders.length&&Ze.nk.info("暂无订单记录")}catch(e){console.error("获取订单失败:",e),Ze.nk.error("获取订单列表失败，请重试")}},async fetchUsers(){try{const e=await y.A.get(`${Ye}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});this.users=e.data.users||e.data}catch(e){console.error("获取用户列表失败:",e),403===e.response?.status?Ze.nk.warning("您只有查看权限"):Ze.nk.error("获取用户列表失败，请重试")}},async fetchAdmins(){try{const e=await y.A.get(`${Ye}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},params:{role:"admin"}}),t=e.data.users||e.data;this.admins=t.filter((e=>"admin"===e.role||"super_admin"===e.role))}catch(e){console.error("获取管理员列表失败:",e),403===e.response?.status?Ze.nk.warning("您只有查看权限"):Ze.nk.error("获取管理员列表失败，请重试")}},async openAdminPanel(){this.dialogVisible=!0,await this.loadAdminData()},async loadAdminData(){this.loading=!0,this.error=null;try{const e=await Promise.allSettled([this.fetchUsers(),this.fetchAdmins()]),t=e.every((e=>"rejected"===e.status));t&&(this.error="加载数据失败，请重试")}catch(e){console.error("加载数据失败:",e),this.error="加载数据失败，请重试"}finally{this.loading=!1}},closeDialog(){this.dialogVisible=!1,this.error=null},handleClose(e){this.error=null,e()},async promoteUser(e){if(this.isSuperAdmin)try{await y.A.post(`${Ye}/promote/${e}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("用户已成功升级为管理员"),await this.loadAdminData()}catch(t){ne(t),Ze.nk.error("升级管理员失败，请稍后重试")}},async demoteUser(e){if(this.isSuperAdmin)try{await y.A.post(`${Ye}/demote/${e}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("管理员已成功降级为普通用户"),await this.loadAdminData()}catch(t){ne(t),Ze.nk.error("降级管理员失败，请稍后重试")}},async deleteUser(e){if(this.isSuperAdmin)try{await y.A.delete(`${Ye}/users/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),await this.loadAdminData()}catch(t){ne(t)}},viewOrderDetails(e){this.$router.push({name:"OrderDetail",params:{orderId:e}})},formatDate(e){if(!e)return"感谢使用";try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1};return t.toLocaleString("zh-CN",a).replace(/\//g,"-")}catch(t){return console.error("日期格式化错误:",t),"--"}},getOrderStatusText(e){const t={0:"待处理",1:"处理中",2:"已完成",3:"已取消"};return t[e]||"未知状态"}},mounted(){this.isSuperAdmin&&(this.fetchUsers(),this.fetchAdmins())}};const et=(0,d.A)(Ge,[["render",Ke],["__scopeId","data-v-1e79242f"]]);var tt=et;const at={class:"profile-container"},st={class:"profile-card"},ot={key:0,class:"not-logged-in"},rt={class:"auth-buttons"},it={key:1,class:"loading-section"},nt={key:2,class:"profile-content"},lt={key:0,class:"message error"},ct={key:1,class:"message success"},dt={key:2,class:"user-info"},ut={class:"avatar-section"},ht={class:"avatar-overlay"},mt={class:"info-section"},pt={class:"info-item"},gt={class:"info-value"},kt={class:"info-item"},vt={class:"info-value"},ft={class:"action-buttons"},Lt={class:"form-group"},wt={class:"form-group"},bt={class:"form-group"},yt={class:"form-group"},It={class:"form-group"},Ct={class:"file-upload"},_t={key:0,class:"file-name"},At={class:"form-actions"},Et=["disabled"];function St(e,t,a,i,n,l){const c=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",at,[(0,o.Lk)("div",st,[n.isLoggedIn?n.loading?((0,o.uX)(),(0,o.CE)("div",it,t[14]||(t[14]=[(0,o.Lk)("div",{class:"loading-spinner"},null,-1),(0,o.Lk)("p",null,"正在加载您的个人信息...",-1)]))):((0,o.uX)(),(0,o.CE)("div",nt,[n.loadError?((0,o.uX)(),(0,o.CE)("div",lt,[t[15]||(t[15]=(0,o.Lk)("span",{class:"message-icon"},"⚠️",-1)),(0,o.Lk)("span",null,(0,r.v_)(n.loadError),1),(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.retryLoad&&l.retryLoad(...e)),class:"btn small"},"重试")])):(0,o.Q3)("",!0),n.updateSuccess?((0,o.uX)(),(0,o.CE)("div",ct,[t[16]||(t[16]=(0,o.Lk)("span",{class:"message-icon"},"✅",-1)),(0,o.Lk)("span",null,(0,r.v_)(n.updateSuccess),1)])):(0,o.Q3)("",!0),n.editMode?((0,o.uX)(),(0,o.CE)("form",{key:3,class:"edit-form",onSubmit:t[9]||(t[9]=(0,s.D$)(((...e)=>l.updateProfile&&l.updateProfile(...e)),["prevent"]))},[t[31]||(t[31]=(0,o.Lk)("h3",null,"编辑个人信息",-1)),(0,o.Lk)("div",Lt,[t[23]||(t[23]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"👤"),(0,o.eW)(" 用户名 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>n.userInfo.username=e),placeholder:"请输入用户名",required:""},null,512),[[s.Jo,n.userInfo.username]])]),(0,o.Lk)("div",wt,[t[24]||(t[24]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"📧"),(0,o.eW)(" 邮箱 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>n.userInfo.email=e),placeholder:"请输入邮箱",required:""},null,512),[[s.Jo,n.userInfo.email]])]),(0,o.Lk)("div",bt,[t[25]||(t[25]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"🔒"),(0,o.eW)(" 当前密码 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"password","onUpdate:modelValue":t[5]||(t[5]=e=>n.currentPassword=e),placeholder:"请输入当前密码",required:""},null,512),[[s.Jo,n.currentPassword]])]),(0,o.Lk)("div",yt,[t[26]||(t[26]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"🔑"),(0,o.eW)(" 新密码 ")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"password","onUpdate:modelValue":t[6]||(t[6]=e=>n.newPassword=e),placeholder:"如需修改密码请输入新密码"},null,512),[[s.Jo,n.newPassword]])]),(0,o.Lk)("div",It,[t[28]||(t[28]=(0,o.Lk)("label",null,[(0,o.Lk)("span",{class:"label-icon"},"🖼️"),(0,o.eW)(" 头像 ")],-1)),(0,o.Lk)("div",Ct,[(0,o.Lk)("input",{type:"file",onChange:t[7]||(t[7]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e)),accept:"image/*",id:"avatar-upload"},null,32),t[27]||(t[27]=(0,o.Lk)("label",{for:"avatar-upload",class:"file-upload-label"},[(0,o.Lk)("span",{class:"btn-icon"},"📤"),(0,o.eW)(" 选择图片 ")],-1)),n.file?((0,o.uX)(),(0,o.CE)("span",_t,(0,r.v_)(n.file.name),1)):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",At,[(0,o.Lk)("button",{type:"submit",class:"btn primary",disabled:n.loading},[t[29]||(t[29]=(0,o.Lk)("span",{class:"btn-icon"},"💾",-1)),(0,o.eW)(" "+(0,r.v_)(n.loading?"保存中...":"保存修改"),1)],8,Et),(0,o.Lk)("button",{type:"button",class:"btn secondary",onClick:t[8]||(t[8]=(...e)=>l.cancelEdit&&l.cancelEdit(...e))},t[30]||(t[30]=[(0,o.Lk)("span",{class:"btn-icon"},"✖️",-1),(0,o.eW)(" 取消 ")]))])],32)):((0,o.uX)(),(0,o.CE)("div",dt,[(0,o.Lk)("div",ut,[(0,o.Lk)("div",{class:"avatar",style:(0,r.Tr)({backgroundImage:`url(${n.userInfo.avatar||"/default-avatar.png"})`})},[(0,o.Lk)("div",ht,[(0,o.Lk)("span",{class:(0,r.C4)(["role-badge",n.userInfo.role])},(0,r.v_)(l.formatRole(n.userInfo.role)),3)])],4)]),(0,o.Lk)("div",mt,[(0,o.Lk)("h2",null,(0,r.v_)(n.userInfo.username),1),(0,o.Lk)("div",pt,[t[17]||(t[17]=(0,o.Lk)("span",{class:"info-icon"},"📧",-1)),t[18]||(t[18]=(0,o.Lk)("span",{class:"info-label"},"邮箱：",-1)),(0,o.Lk)("span",gt,(0,r.v_)(n.userInfo.email),1)]),(0,o.Lk)("div",kt,[t[19]||(t[19]=(0,o.Lk)("span",{class:"info-icon"},"👑",-1)),t[20]||(t[20]=(0,o.Lk)("span",{class:"info-label"},"角色：",-1)),(0,o.Lk)("span",vt,(0,r.v_)(l.formatRole(n.userInfo.role)),1)])]),(0,o.Lk)("div",ft,[(0,o.Lk)("button",{class:"btn primary",onClick:t[1]||(t[1]=e=>n.editMode=!0)},t[21]||(t[21]=[(0,o.Lk)("span",{class:"btn-icon"},"✏️",-1),(0,o.eW)(" 编辑资料 ")])),(0,o.Lk)("button",{class:"btn outline-danger",onClick:t[2]||(t[2]=(...e)=>l.logout&&l.logout(...e))},t[22]||(t[22]=[(0,o.Lk)("span",{class:"btn-icon"},"🚪",-1),(0,o.eW)(" 退出登录 ")]))])]))])):((0,o.uX)(),(0,o.CE)("div",ot,[t[12]||(t[12]=(0,o.Lk)("h2",null,"欢迎来到社区",-1)),t[13]||(t[13]=(0,o.Lk)("p",null,"登录或注册以开始您的社区之旅",-1)),(0,o.Lk)("div",rt,[(0,o.bF)(c,{to:"/login",class:"auth-button login-btn"},{default:(0,o.k6)((()=>t[10]||(t[10]=[(0,o.Lk)("span",{class:"button-icon"},"🔑",-1),(0,o.eW)(" 登录 ")]))),_:1}),(0,o.bF)(c,{to:"/register",class:"auth-button login-btn"},{default:(0,o.k6)((()=>t[11]||(t[11]=[(0,o.Lk)("span",{class:"button-icon"},"✨",-1),(0,o.eW)(" 注册 ")]))),_:1})])]))])])}const $t="https://api.26ywzm.icu/api/auth";var Xt={name:"UserProfile",data(){return{isLoggedIn:!!localStorage.getItem("authToken"),userInfo:{username:"",email:"",role:"",balance:0},editMode:!1,currentPassword:"",newPassword:"",file:null,loading:!1,loadError:"",updateSuccess:""}},async created(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("userRole"),a=localStorage.getItem("username"),s=localStorage.getItem("email");if(e){this.userInfo={username:a||"",email:s||"",role:t||""};try{await this.fetchUserProfile()}catch(o){console.error("Failed to fetch user profile:",o),o.response&&401===o.response.status&&this.handleUnauthorized()}}else this.isLoggedIn=!1},methods:{formatRole(e){const t={super_admin:"超级管理员",admin:"管理员",user:"普通用户"};return t[e]||e},async retryLoad(){this.loadError="",await this.fetchUserProfile()},async fetchUserProfile(){this.loading=!0,this.loadError="";try{const e=localStorage.getItem("authToken");if(!e)return console.warn("No auth token found, using local storage data"),void this.useLocalStorageData();const t={method:"get",url:`${$t}/me`,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}},a=await(0,y.A)(t);if(a.data&&a.data.user)this.userInfo=a.data.user;else{if(!a.data)throw new Error("Invalid response format");this.userInfo=a.data}}catch(e){if(console.error("Error fetching user profile:",e),e.response){if(401===e.response.status)return void this.handleUnauthorized();this.loadError=`加载失败: ${e.response.data.message||"服务器错误"}`}else this.loadError="网络错误，请检查网络连接";this.useLocalStorageData()}finally{this.loading=!1}},useLocalStorageData(){this.userInfo={username:localStorage.getItem("username")||"",email:localStorage.getItem("email")||"",role:localStorage.getItem("userRole")||""}},handleUnauthorized(){localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),this.isLoggedIn=!1},async updateProfile(){this.loading=!0,this.updateSuccess="";try{const e=new FormData;e.append("username",this.userInfo.username),e.append("email",this.userInfo.email),this.currentPassword&&(e.append("currentPassword",this.currentPassword),this.newPassword&&e.append("newPassword",this.newPassword)),this.file&&e.append("avatar",this.file),await y.A.put(`${$t}/me`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"multipart/form-data"}}),this.updateSuccess="个人信息更新成功！",this.editMode=!1,this.currentPassword="",this.newPassword="",this.file=null,await this.fetchUserProfile()}catch(e){ne(e)}finally{this.loading=!1}},handleFileUpload(e){this.file=e.target.files[0]},goToLogin(){this.$router.push("/login")},goToRegister(){this.$router.push("/register")},async logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),await this.$router.push("/login"),alert("已成功退出登录")},cancelEdit(){this.editMode=!1,this.currentPassword="",this.newPassword="",this.file=null,this.fetchUserProfile()}}};const Ut=(0,d.A)(Xt,[["render",St],["__scopeId","data-v-36b95f51"]]);var Ft=Ut;const Tt={class:"news-detail-container"},Mt={class:"news-detail"},Vt={class:"news-content"},Dt={key:0,class:"meta-info"},zt={class:"date"},Pt={class:"views"},Rt={key:0,class:"featured-image"},Wt=["src"],xt={key:1,class:"content"};function Ot(e,t,a,s,i,n){return(0,o.uX)(),(0,o.CE)("div",Tt,[(0,o.Lk)("div",Mt,[(0,o.Lk)("div",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>n.goBack&&n.goBack(...e))},t[1]||(t[1]=[(0,o.Lk)("i",{class:"back-icon"},"←",-1),(0,o.Lk)("span",null,"返回",-1)])),(0,o.Lk)("article",Vt,[(0,o.Lk)("header",null,[(0,o.Lk)("h1",null,(0,r.v_)(i.news.title),1),i.news.created_at?((0,o.uX)(),(0,o.CE)("div",Dt,[(0,o.Lk)("span",zt,(0,r.v_)(n.formatDate(i.news.created_at)),1),t[2]||(t[2]=(0,o.Lk)("span",{class:"divider"},"|",-1)),(0,o.Lk)("span",Pt,"阅读 "+(0,r.v_)(i.news.views||0),1)])):(0,o.Q3)("",!0)]),i.news.blobUrl?((0,o.uX)(),(0,o.CE)("div",Rt,[(0,o.Lk)("img",{src:i.news.blobUrl,alt:"新闻图片"},null,8,Wt)])):(0,o.Q3)("",!0),i.news.content?((0,o.uX)(),(0,o.CE)("div",xt,[(0,o.Lk)("p",null,(0,r.v_)(i.news.content),1)])):(0,o.Q3)("",!0)])])])}const Bt="https://api.26ywzm.icu",Qt=`${Bt}/api/auth`;var Nt={data(){return{news:{},imageCache:new Map}},mounted(){this.fetchNews()},methods:{async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=e.startsWith("/uploads/")?e:`/uploads/${e}`,a=Qt.replace("/api/auth",""),s=await fetch(`${a}${t}`),o=await s.blob(),r=URL.createObjectURL(o);return this.imageCache.set(e,r),r}catch(t){return console.error("加载图片失败:",t),""}},async fetchNews(){try{const e=await y.A.get(`${Qt}/articles/${this.$route.params.id}`);this.news=e.data,await this.loadImage(this.news)}catch(e){console.error("获取新闻详情失败:",e)}},goBack(){this.$router.push("/")},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}}};const qt=(0,d.A)(Nt,[["render",Ot],["__scopeId","data-v-1654ac4c"]]);var jt=qt;const Kt={class:"article-editor"},Jt={type:"submit"},Ht={class:"articles-area"},Zt={class:"category-buttons"},Yt=["src","onError","alt"],Gt={class:"action-buttons"},ea=["onClick"],ta=["onClick"];function aa(e,t,a,i,n,l){return(0,o.uX)(),(0,o.CE)("div",Kt,[(0,o.Lk)("h2",null,(0,r.v_)(n.editingArticleId?"编辑文章":"编写文章"),1),(0,o.Lk)("form",{onSubmit:t[6]||(t[6]=(0,s.D$)(((...e)=>l.submitArticle&&l.submitArticle(...e)),["prevent"]))},[(0,o.Lk)("div",null,[t[10]||(t[10]=(0,o.Lk)("label",null,"标题：",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.title=e),required:""},null,512),[[s.Jo,n.title]])]),(0,o.Lk)("div",null,[t[11]||(t[11]=(0,o.Lk)("label",null,"内容：",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.content=e),required:""},null,512),[[s.Jo,n.content]])]),(0,o.Lk)("div",null,[t[12]||(t[12]=(0,o.Lk)("label",null,"图片链接：",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>n.imageUrl=e)},null,512),[[s.Jo,n.imageUrl]])]),(0,o.Lk)("div",null,[t[13]||(t[13]=(0,o.Lk)("label",null,"或上传图片：",-1)),(0,o.Lk)("input",{type:"file",ref:"fileInput",onChange:t[3]||(t[3]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e))},null,544)]),(0,o.Lk)("div",null,[t[15]||(t[15]=(0,o.Lk)("label",null,"选择发布位置：",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.category=e),required:""},t[14]||(t[14]=[(0,o.Lk)("option",{value:"carousel"},"轮播图",-1),(0,o.Lk)("option",{value:"hotNews"},"热门新闻",-1),(0,o.Lk)("option",{value:"newsList"},"新闻列表",-1)]),512),[[s.u1,n.category]])]),(0,o.Lk)("button",Jt,(0,r.v_)(n.editingArticleId?"保存修改":"发布文章"),1),n.editingArticleId?((0,o.uX)(),(0,o.CE)("button",{key:0,type:"button",onClick:t[5]||(t[5]=(...e)=>l.cancelEdit&&l.cancelEdit(...e))},"取消编辑")):(0,o.Q3)("",!0)],32),(0,o.Lk)("div",Ht,[(0,o.Lk)("div",Zt,[(0,o.Lk)("button",{onClick:t[7]||(t[7]=e=>l.loadArticles("carousel"))},"轮播图"),(0,o.Lk)("button",{onClick:t[8]||(t[8]=e=>l.loadArticles("hotNews"))},"热门新闻"),(0,o.Lk)("button",{onClick:t[9]||(t[9]=e=>l.loadArticles("newsList"))},"新闻列表")]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.articles,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"article"},[(0,o.Lk)("h3",null,(0,r.v_)(e.title),1),e.image_url?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.blobUrl||"",onError:t=>l.loadImage(e),alt:e.title,class:"article-image"},null,40,Yt)):(0,o.Q3)("",!0),(0,o.Lk)("p",null,(0,r.v_)(e.content),1),(0,o.Lk)("div",Gt,[(0,o.Lk)("button",{class:"edit",onClick:t=>l.editArticle(e)},"修改",8,ea),(0,o.Lk)("button",{onClick:t=>l.deleteArticle(e.id)},"删除",8,ta)])])))),128))])])}const sa={methods:{checkAdminAuth(){const e=localStorage.getItem("userRole");return"admin"===e||"super_admin"===e||(this.$router.push("/"),!1)}},beforeMount(){this.checkAdminAuth()},beforeRouteEnter(e,t,a){const s=localStorage.getItem("userRole");"admin"!==s&&"super_admin"!==s?a("/"):a()}},oa="https://api.26ywzm.icu/api/auth";var ra={name:"ArticleEditor",mixins:[sa],data(){return{title:"",content:"",imageUrl:"",category:"newsList",imageFile:null,editingArticleId:null,articles:[],imageCache:new Map}},methods:{async fetchArticles(e){if(this.checkAdminAuth())try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=await y.A.get(`${oa}/articles${e?`?category=${e}`:""}`,{headers:a});this.articles=s.data;for(const e of this.articles)await this.loadImage(e)}catch(t){console.error("获取文章失败:",t)}},async loadArticles(e){this.category=e,await this.fetchArticles(e)},handleFileUpload(e){this.imageFile=e.target.files[0]},async submitArticle(){if(this.checkAdminAuth())try{const e=new FormData;e.append("title",this.title),e.append("content",this.content),e.append("category",this.category),e.append("image_url",this.imageUrl),this.imageFile&&e.append("image",this.imageFile);const t=localStorage.getItem("authToken"),a={"Content-Type":"multipart/form-data",Authorization:`Bearer ${t}`};this.editingArticleId?(await y.A.put(`${oa}/articles/${this.editingArticleId}`,e,{headers:a}),alert("文章修改成功")):(await y.A.post(`${oa}/articles`,e,{headers:a}),alert("文章发布成功")),this.resetForm(),this.fetchArticles()}catch(e){console.error("提交文章失败:",e),alert("提交失败，请重试。")}},editArticle(e){this.checkAdminAuth()&&(this.title=e.title,this.content=e.content,this.imageUrl=e.image_url,this.category=e.category,this.editingArticleId=e.id)},async deleteArticle(e){if(this.checkAdminAuth()&&confirm("确定要删除这篇文章吗？"))try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`};await y.A.delete(`${oa}/articles/${e}`,{headers:a}),this.fetchArticles()}catch(t){console.error("删除文章失败:",t),alert("删除失败，请重试。")}},resetForm(){this.title="",this.content="",this.imageUrl="",this.imageFile=null,this.category="newsList",this.editingArticleId=null,this.$refs.fileInput.value=""},cancelEdit(){this.resetForm()},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=e.startsWith("/uploads/")?e:`/uploads/${e}`,o="https://api.26ywzm.icu",r=await fetch(`${o}${s}`,{headers:a}),i=await r.blob(),n=URL.createObjectURL(i);return this.imageCache.set(e,n),n}catch(t){return console.error("加载图片失败:",t),""}},async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))}},mounted(){this.checkAdminAuth()?this.fetchArticles():this.$router.push("/")}};const ia=(0,d.A)(ra,[["render",aa],["__scopeId","data-v-edaed63c"]]);var na=ia;const la={class:"canteen-order"},ca={key:0,class:"menu-list"},da=["src","onError"],ua={class:"menu-item-info"},ha={class:"description"},ma={class:"price"},pa={class:"quantity-controls"},ga=["onClick"],ka=["onClick"],va=["onClick"],fa={key:1},La={key:2,class:"cart"},wa=["onClick"],ba={class:"cart-footer"},ya={key:3};function Ia(e,t,a,s,i,n){return(0,o.uX)(),(0,o.CE)("div",la,[t[4]||(t[4]=(0,o.Lk)("h2",null,"社区食堂",-1)),i.menuItems.length>0?((0,o.uX)(),(0,o.CE)("div",ca,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.menuItems,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"menu-item"},[e.image_url?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.blobUrl||"",onError:t=>n.loadImage(e),alt:"菜品图片"},null,40,da)):(0,o.Q3)("",!0),(0,o.Lk)("div",ua,[(0,o.Lk)("h3",null,(0,r.v_)(e.name),1),(0,o.Lk)("p",ha,(0,r.v_)(e.description),1),(0,o.Lk)("p",ma,"¥"+(0,r.v_)(e.price),1),(0,o.Lk)("div",pa,[(0,o.Lk)("button",{onClick:t=>n.decrementQuantity(e)},"-",8,ga),(0,o.Lk)("span",null,(0,r.v_)(e.quantity),1),(0,o.Lk)("button",{onClick:t=>n.incrementQuantity(e)},"+",8,ka)]),(0,o.Lk)("button",{onClick:t=>n.addToCart(e),class:"add-to-cart"},"加入购物车",8,va)])])))),128))])):((0,o.uX)(),(0,o.CE)("div",fa,t[1]||(t[1]=[(0,o.Lk)("p",null,"目前没有可用的菜品。",-1)]))),i.cart.length>0?((0,o.uX)(),(0,o.CE)("div",La,[t[2]||(t[2]=(0,o.Lk)("h3",null,"购物车",-1)),(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.cart,((e,t)=>((0,o.uX)(),(0,o.CE)("li",{key:e.id,class:"cart-item"},[(0,o.Lk)("span",null,(0,r.v_)(e.name)+" ("+(0,r.v_)(e.quantity)+"): "+(0,r.v_)(e.price*e.quantity)+" 元",1),(0,o.Lk)("button",{onClick:e=>n.removeFromCart(t),class:"remove-btn"},"删除",8,wa)])))),128))]),(0,o.Lk)("div",ba,[(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.checkout&&n.checkout(...e)),class:"checkout-btn"},"结账")])])):((0,o.uX)(),(0,o.CE)("div",ya,t[3]||(t[3]=[(0,o.Lk)("p",null,"购物车为空。",-1)])))])}const Ca="https://api.26ywzm.icu";var _a={data(){return{menuItems:[],cart:[],imageCache:new Map}},async mounted(){await this.fetchMenuItems()},methods:{async fetchMenuItems(){try{const e=await y.A.get(`${Ca}/api/auth/canteen/menu`);this.menuItems=e.data.map((e=>({...e,quantity:1})));for(const t of this.menuItems)await this.loadImage(t)}catch(e){console.error("获取菜单失败:",e)}},async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},addToCart(e){const t=this.cart.find((t=>t.id===e.id));t?t.quantity+=e.quantity:this.cart.push({...e}),e.quantity=1,alert(`${e.name} 已加入购物车！`)},removeFromCart(e){this.cart.splice(e,1),alert("菜品已从购物车中删除！")},async checkout(){const e=this.cart.map((e=>({menuItemId:e.id,quantity:e.quantity,price:e.price})));if(0!==e.length)try{console.log("Orders being sent:",e);const t=await y.A.post(`${Ca}/api/auth/canteen/order`,{items:e},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});alert(t.data.message||"结账成功！"),this.$router.push(`/order/${t.data.orderId}`)}catch(t){console.error("结账失败:",t),alert("结账失败，请重试。")}else alert("请至少选择一项菜品！")},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=e.startsWith("/uploads/")?e:`/uploads/${e}`,o="https://api.26ywzm.icu",r=await fetch(`${o}${s}`,{headers:a}),i=await r.blob(),n=URL.createObjectURL(i);return this.imageCache.set(e,n),n}catch(t){return console.error("加载图片失败:",t),""}},decrementQuantity(e){e.quantity>1&&e.quantity--},incrementQuantity(e){e.quantity++}}};const Aa=(0,d.A)(_a,[["render",Ia],["__scopeId","data-v-66968b6e"]]);var Ea=Aa;const Sa={class:"canteen-admin"},$a={class:"form-container"},Xa={class:"form-group"},Ua={class:"form-group"},Fa={class:"form-group"},Ta={class:"form-group"},Ma={class:"form-group"},Va={class:"form-actions"},Da={type:"submit",class:"submit-btn"},za={key:0,class:"menu-list"},Pa=["src","onError"],Ra={class:"menu-item-info"},Wa={class:"price"},xa={class:"description"},Oa={class:"menu-item-actions"},Ba=["onClick"],Qa=["onClick"],Na={key:1};function qa(e,t,a,i,n,l){return(0,o.uX)(),(0,o.CE)("div",Sa,[t[13]||(t[13]=(0,o.Lk)("h2",null,"食堂管理",-1)),(0,o.Lk)("div",$a,[(0,o.Lk)("h3",null,(0,r.v_)(n.isEditing?"编辑菜品":"添加新菜品"),1),(0,o.Lk)("form",{onSubmit:t[6]||(t[6]=(0,s.D$)((e=>n.isEditing?l.updateMenuItem():l.addMenuItem()),["prevent"])),class:"form"},[(0,o.Lk)("div",Xa,[t[7]||(t[7]=(0,o.Lk)("label",{for:"name"},"菜品名称",-1)),(0,o.bo)((0,o.Lk)("input",{id:"name",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.newItem.name=e),required:"",placeholder:"输入菜品名称"},null,512),[[s.Jo,n.newItem.name]])]),(0,o.Lk)("div",Ua,[t[8]||(t[8]=(0,o.Lk)("label",{for:"price"},"价格",-1)),(0,o.bo)((0,o.Lk)("input",{id:"price",type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>n.newItem.price=e),required:"",placeholder:"输入菜品价格"},null,512),[[s.Jo,n.newItem.price]])]),(0,o.Lk)("div",Fa,[t[9]||(t[9]=(0,o.Lk)("label",{for:"image-url"},"图片链接",-1)),(0,o.bo)((0,o.Lk)("input",{id:"image-url",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>n.newItem.image_url=e),placeholder:"输入图片URL"},null,512),[[s.Jo,n.newItem.image_url]])]),(0,o.Lk)("div",Ta,[t[10]||(t[10]=(0,o.Lk)("label",null,"或上传图片",-1)),(0,o.Lk)("input",{type:"file",onChange:t[3]||(t[3]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e)),ref:"fileInput"},null,544)]),(0,o.Lk)("div",Ma,[t[11]||(t[11]=(0,o.Lk)("label",{for:"description"},"描述",-1)),(0,o.bo)((0,o.Lk)("textarea",{id:"description","onUpdate:modelValue":t[4]||(t[4]=e=>n.newItem.description=e),placeholder:"输入菜品描述"},null,512),[[s.Jo,n.newItem.description]])]),(0,o.Lk)("div",Va,[(0,o.Lk)("button",Da,(0,r.v_)(n.isEditing?"更新菜品":"添加菜品"),1),n.isEditing?((0,o.uX)(),(0,o.CE)("button",{key:0,type:"button",onClick:t[5]||(t[5]=(...e)=>l.cancelEdit&&l.cancelEdit(...e)),class:"cancel-btn"},"取消")):(0,o.Q3)("",!0)])],32)]),t[14]||(t[14]=(0,o.Lk)("h3",null,"菜品列表",-1)),n.menuItems.length>0?((0,o.uX)(),(0,o.CE)("div",za,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.menuItems,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"menu-item"},[e.image_url?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.blobUrl||"",onError:t=>l.loadImage(e),alt:"菜品图片"},null,40,Pa)):(0,o.Q3)("",!0),(0,o.Lk)("div",Ra,[(0,o.Lk)("h4",null,(0,r.v_)(e.name),1),(0,o.Lk)("p",Wa,"价格: "+(0,r.v_)(e.price)+" 元",1),(0,o.Lk)("p",xa,(0,r.v_)(e.description),1)]),(0,o.Lk)("div",Oa,[(0,o.Lk)("button",{onClick:t=>l.deleteMenuItem(e.id),class:"delete-btn"},"删除",8,Ba),(0,o.Lk)("button",{onClick:t=>l.editMenuItem(e),class:"edit-btn"},"编辑",8,Qa)])])))),128))])):((0,o.uX)(),(0,o.CE)("div",Na,t[12]||(t[12]=[(0,o.Lk)("p",null,"目前没有可用的菜品。",-1)])))])}const ja="https://api.26ywzm.icu/api/auth";var Ka={data(){return{menuItems:[],newItem:{name:"",price:"",image_url:"",description:""},imageFile:null,isEditing:!1,imageCache:new Map}},mounted(){this.fetchMenuItems()},methods:{handleFileUpload(e){const t=e.target.files[0];if(t)return t.type.startsWith("image/")?void(this.imageFile=t):(alert("请上传图片文件"),void(this.$refs.fileInput.value=""))},async fetchMenuItems(){try{const e=await y.A.get(`${ja}/canteen/menu`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});this.menuItems=e.data;for(const t of this.menuItems)await this.loadImage(t)}catch(e){ne(e)}},async addMenuItem(){const e=new FormData;e.append("name",this.newItem.name),e.append("price",this.newItem.price),e.append("image_url",this.newItem.image_url),e.append("description",this.newItem.description),this.imageFile&&e.append("image",this.imageFile);try{await y.A.post(`${ja}/canteen/menu`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"multipart/form-data"},withCredentials:!0}),this.fetchMenuItems(),this.resetForm()}catch(t){console.error("添加菜品失败:",t),alert("添加菜品失败，请重试")}},async deleteMenuItem(e){try{await y.A.delete(`${ja}/canteen/menu/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),this.fetchMenuItems()}catch(t){ne(t,{suppressAuthError:!0,customErrorHandler:()=>{alert("删除菜品失败，请重试")}})}},editMenuItem(e){this.newItem={...e},this.isEditing=!0},async updateMenuItem(){const e=new FormData;e.append("name",this.newItem.name),e.append("price",this.newItem.price),e.append("image_url",this.newItem.image_url),e.append("description",this.newItem.description),this.imageFile&&e.append("image",this.imageFile);try{await y.A.put(`${ja}/canteen/menu/${this.newItem.id}`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"multipart/form-data"}}),this.fetchMenuItems(),this.resetForm()}catch(t){ne(t,{suppressAuthError:!0,customErrorHandler:()=>{alert("更新菜品失败，请重试")}})}},cancelEdit(){this.resetForm()},resetForm(){this.isEditing=!1,this.newItem={name:"",price:"",image_url:"",description:""},this.imageFile=null,this.$refs.fileInput.value=""},async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=e.startsWith("/uploads/")?e:`/uploads/${e}`,o="https://api.26ywzm.icu",r=await fetch(`${o}${s}`,{headers:a}),i=await r.blob(),n=URL.createObjectURL(i);return this.imageCache.set(e,n),n}catch(t){return console.error("加载图片失败:",t),""}}}};const Ja=(0,d.A)(Ka,[["render",qa],["__scopeId","data-v-5fef34c2"]]);var Ha=Ja;const Za={class:"order-detail"},Ya={class:"card-header"},Ga={key:0,class:"order-content"},es={class:"info-list"},ts={class:"info-item"},as={class:"info-item"},ss={class:"info-item"},os={class:"info-item"},rs={class:"info-item"},is={class:"price"},ns={key:0,class:"order-items"},ls={class:"items-list"},cs={class:"item-name"},ds={class:"item-info"},us={class:"subtotal"},hs={key:1,class:"loading-wrapper"};function ms(e,t,a,s,i,n){const l=(0,o.g2)("el-page-header"),c=(0,o.g2)("el-tag"),d=(0,o.g2)("el-empty"),u=(0,o.g2)("el-card");return(0,o.uX)(),(0,o.CE)("div",Za,[(0,o.bF)(u,null,{header:(0,o.k6)((()=>[(0,o.Lk)("div",Ya,[(0,o.bF)(l,{onBack:n.goBack,title:"返回",content:"订单详情"},null,8,["onBack"])])])),default:(0,o.k6)((()=>[i.order?((0,o.uX)(),(0,o.CE)("div",Ga,[(0,o.Lk)("div",es,[(0,o.Lk)("div",ts,"订单编号："+(0,r.v_)(i.order.id),1),(0,o.Lk)("div",as,"用户名："+(0,r.v_)(i.order.username),1),(0,o.Lk)("div",ss,"邮箱："+(0,r.v_)(i.order.email),1),(0,o.Lk)("div",os,[t[0]||(t[0]=(0,o.eW)(" 订单状态： ")),(0,o.bF)(c,{type:n.getStatusType(i.order.status)},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(i.statusText[i.order.status]||"未知状态"),1)])),_:1},8,["type"])]),(0,o.Lk)("div",rs,[t[1]||(t[1]=(0,o.eW)("总价格：")),(0,o.Lk)("span",is,"¥"+(0,r.v_)(i.order.total_price),1)])]),i.order.items&&i.order.items.length?((0,o.uX)(),(0,o.CE)("div",ns,[t[2]||(t[2]=(0,o.Lk)("h3",null,"订单商品",-1)),(0,o.Lk)("div",ls,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.order.items,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.menu_item_id,class:"item"},[(0,o.Lk)("div",cs,(0,r.v_)(e.name),1),(0,o.Lk)("div",ds,[(0,o.Lk)("span",null,"数量："+(0,r.v_)(e.quantity),1),(0,o.Lk)("span",null,"单价：¥"+(0,r.v_)(e.price),1),(0,o.Lk)("span",us,"小计：¥"+(0,r.v_)((e.quantity*e.price).toFixed(2)),1)])])))),128))])])):(0,o.Q3)("",!0)])):i.loading?((0,o.uX)(),(0,o.CE)("div",hs,[(0,o.bF)(d,{description:"正在加载订单信息..."})])):(0,o.Q3)("",!0)])),_:1})])}const ps="https://api.26ywzm.icu/api/auth";var gs={name:"OrderDetail",data(){return{order:null,loading:!0,statusText:{0:"待处理",1:"处理中",2:"已完成",3:"已取消"}}},async created(){await this.fetchOrderDetails()},methods:{getStatusType(e){const t={0:"info",1:"warning",2:"success",3:"danger"};return t[e]||"info"},async fetchOrderDetails(){const e=this.$route.params.orderId;try{const t=await y.A.get(`${ps}/canteen/order/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),a=t.data;a&&a.user?this.order={...a,email:a.user.email,username:a.user.username}:this.order=a,this.loading=!1}catch(t){console.error("获取订单详情失败:",t),ne(t)}},formatDate(e){if(!e)return"暂无日期";try{const t=new Date(e);if(isNaN(t.getTime()))return"无效日期";const a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1};return t.toLocaleString("zh-CN",a).replace(/\//g,"-")}catch(t){return console.error("日期格式化错误:",t),"日期格式错误"}},goBack(){this.$router.push("/discover")}}};const ks=(0,d.A)(gs,[["render",ms],["__scopeId","data-v-7725f797"]]);var vs=ks;const fs={class:"order-management"},Ls={key:0,class:"loading"},ws={key:1},bs={class:"order-cards"},ys={class:"order-info"},Is={class:"user-info"},Cs={class:"email"},_s={class:"order-items"},As={class:"item-name"},Es={class:"item-details"},Ss={class:"price"},$s={class:"status"},Xs={class:"time-info"},Us={class:"time"},Fs={class:"order-actions"},Ts=["onClick"],Ms=["onClick"],Vs=["onClick"],Ds={key:2},zs={key:3,class:"dialog-overlay"},Ps={class:"dialog"};function Rs(e,t,a,s,i,n){return(0,o.uX)(),(0,o.CE)("div",fs,[t[2]||(t[2]=(0,o.Lk)("h2",null,"订单管理",-1)),i.loading?((0,o.uX)(),(0,o.CE)("div",Ls,"加载中...")):((0,o.uX)(),(0,o.CE)("div",ws,[(0,o.Lk)("div",bs,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.orders,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"order-card"},[(0,o.Lk)("h3",null,"订单ID: "+(0,r.v_)(e.id),1),(0,o.Lk)("div",ys,[(0,o.Lk)("div",Is,[(0,o.Lk)("div",null,(0,r.v_)(e.username),1),(0,o.Lk)("div",Cs,(0,r.v_)(e.email),1)]),(0,o.Lk)("div",_s,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.items,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.menu_item_id,class:"order-item"},[(0,o.Lk)("span",As,(0,r.v_)(e.name),1),(0,o.Lk)("div",Es,[(0,o.Lk)("span",null,"数量: "+(0,r.v_)(e.quantity),1),(0,o.Lk)("span",null,"单价: ¥"+(0,r.v_)(e.price),1),(0,o.Lk)("span",null,"小计: ¥"+(0,r.v_)(e.quantity*e.price),1)])])))),128))]),(0,o.Lk)("div",Ss,"总价: ¥"+(0,r.v_)(e.total_price),1),(0,o.Lk)("div",$s,[(0,o.Lk)("span",{class:(0,r.C4)(["status-tag","status-"+e.status])},(0,r.v_)(i.statusText[e.status]),3)]),(0,o.Lk)("div",Xs,[(0,o.Lk)("div",null,(0,r.v_)(n.formatDate(e.created_at).date),1),(0,o.Lk)("div",Us,(0,r.v_)(n.formatDate(e.created_at).time),1)]),(0,o.Lk)("div",Fs,[0===parseInt(e.status)?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn-confirm",onClick:t=>n.handleButtonClick(e)},"开始处理",8,Ts)):(0,o.Q3)("",!0),1===parseInt(e.status)?((0,o.uX)(),(0,o.CE)("button",{key:1,class:"btn-complete",onClick:t=>n.handleButtonClick(e)},"完成订单",8,Ms)):(0,o.Q3)("",!0),2===parseInt(e.status)?((0,o.uX)(),(0,o.CE)("button",{key:2,class:"btn-delete",onClick:t=>n.handleDeleteOrder(e)},"删除订单",8,Vs)):(0,o.Q3)("",!0)])])])))),128))])])),0!==i.orders.length||i.loading?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",Ds,t[1]||(t[1]=[(0,o.Lk)("p",{class:"empty-message"},"没有找到订单。",-1)]))),i.showDialog?((0,o.uX)(),(0,o.CE)("div",zs,[(0,o.Lk)("div",Ps,[(0,o.Lk)("p",null,(0,r.v_)(i.dialogMessage),1),(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.closeDialog&&n.closeDialog(...e))},"确定")])])):(0,o.Q3)("",!0)])}const Ws="https://api.26ywzm.icu/api/auth";console.log("Current API_URL:",Ws);var xs={created(){window.caches&&caches.keys().then((e=>{e.forEach((e=>{caches.delete(e)}))}))},data(){return{orders:[],showDialog:!1,dialogMessage:"",lastActionTime:0,loading:!1,statusText:{0:"待处理",1:"处理中",2:"已完成",3:"已取消"}}},async mounted(){await this.fetchOrders()},methods:{async fetchOrders(){try{this.loading=!0;const e=localStorage.getItem("authToken");if(!e)return void Ze.nk.error("请先登录");const t=(new Date).getTime(),a=await y.A.get(`${Ws}/canteen/orders?_t=${t}`,{headers:{Authorization:`Bearer ${e}`,"Cache-Control":"no-cache",Pragma:"no-cache"}});a.data.orders&&(this.orders=a.data.orders.map((e=>({...e,lastActionTime:0,items:e.items||[]}))))}catch(e){console.error("获取订单列表失败:",e),403===e.response?.status?Ze.nk.error("没有权限访问订单列表"):Ze.nk.error(e.response?.data?.message||"获取订单列表失败")}finally{this.loading=!1}},async handleButtonClick(e){if(this.canPerformAction(e))try{let t;const a=parseInt(e.status);switch(a){case 0:t=1;break;case 1:t=2;break;default:return void Ze.nk.error(`当前状态 ${this.statusText[e.status]} 无法进行操作`)}await this.updateOrderStatus(e,t),await this.fetchOrders()}catch(t){console.error("操作失败:",t),Ze.nk.error("操作失败，请重试")}else Ze.nk.warning("操作太频繁，请稍后再试")},canPerformAction(e){const t=Date.now();return!e.lastActionTime||t-e.lastActionTime>3e3},async updateOrderStatus(e,t){try{console.log("Updating order status:",{orderId:e.id,status:t}),await y.A.put(`${Ws}/canteen/orders/${e.id}`,{status:t},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}}),Ze.nk.success(`订单状态已更新为${this.statusText[t]}`),e.lastActionTime=Date.now(),e.status=t}catch(a){throw console.error("更新订单状态失败:",a),Ze.nk.error(a.response?.data?.message||"更新订单状态失败，请重试"),a}},async handleDeleteOrder(e){try{if(!confirm("确定要删除这个订单吗？此操作不可撤销。"))return;await y.A.delete(`${Ws}/canteen/orders/${e.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("订单已删除"),this.orders=this.orders.filter((t=>t.id!==e.id))}catch(t){console.error("删除订单失败:",t),Ze.nk.error(t.response?.data?.message||"删除订单失败，请重试")}},closeDialog(){this.showDialog=!1,this.dialogMessage=""},formatDate(e){const t=new Date(e);return{date:t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),time:t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}}}};const Os=(0,d.A)(xs,[["render",Rs],["__scopeId","data-v-3eb61b42"]]);var Bs=Os;const Qs={class:"submit-feedback"},Ns={key:0,class:"feedback-history"},qs={class:"feedback-header"},js={class:"feedback-time"},Ks=["onClick"],Js={class:"feedback-content"},Hs={key:0,class:"admin-reply"},Zs={key:1,class:"submit-success"};function Ys(e,t,a,i,n,l){return(0,o.uX)(),(0,o.CE)("div",Qs,[t[6]||(t[6]=(0,o.Lk)("h2",null,"提交您的建议或留言",-1)),n.feedbacks.length>0?((0,o.uX)(),(0,o.CE)("div",Ns,[t[4]||(t[4]=(0,o.Lk)("h3",null,"我的留言历史",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.feedbacks,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"feedback-item"},[(0,o.Lk)("div",qs,[(0,o.Lk)("span",js,(0,r.v_)(l.formatTime(e.created_at)),1),(0,o.Lk)("button",{class:"delete-btn",onClick:t=>l.deleteFeedback(e)},"删除",8,Ks)]),(0,o.Lk)("div",Js,[(0,o.Lk)("p",null,[t[2]||(t[2]=(0,o.Lk)("strong",null,"留言：",-1)),(0,o.eW)((0,r.v_)(e.message),1)]),e.admin_reply?((0,o.uX)(),(0,o.CE)("p",Hs,[t[3]||(t[3]=(0,o.Lk)("strong",null,"管理员回复：",-1)),(0,o.eW)((0,r.v_)(e.admin_reply),1)])):(0,o.Q3)("",!0)])])))),128))])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.feedbackMessage=e),placeholder:"请填写您的留言",rows:"4",required:""},null,512),[[s.Jo,n.feedbackMessage]]),(0,o.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.submitFeedback&&l.submitFeedback(...e))},"提交留言"),n.feedbackSubmitted?((0,o.uX)(),(0,o.CE)("div",Zs,t[5]||(t[5]=[(0,o.Lk)("p",null,"留言提交成功！",-1)]))):(0,o.Q3)("",!0)])}const Gs="https://api.26ywzm.icu";var eo={data(){return{feedbackMessage:"",feedbacks:[],feedbackSubmitted:!1,message:{show:!1,content:"",type:""}}},mounted(){this.loadFeedbacks()},methods:{getAuthHeaders(){const e=localStorage.getItem("authToken");return e?{Authorization:`Bearer ${e}`}:{}},async loadFeedbacks(){const e=localStorage.getItem("userId"),t=localStorage.getItem("authToken");if(e&&t)try{const t=await y.A.get(`${Gs}/api/canteen/feedbacks`,{params:{user_id:e},headers:this.getAuthHeaders()});this.feedbacks=t.data.feedbacks}catch(a){console.error("加载留言历史失败:",a),this.showMessage("加载留言历史失败，请稍后重试","error")}else this.showMessage("请先登录","error")},async submitFeedback(){const e=localStorage.getItem("userId"),t=localStorage.getItem("authToken");if(e&&t)if(this.feedbackMessage.trim())try{await y.A.post(`${Gs}/api/canteen/feedback`,{user_id:e,message:this.feedbackMessage},{headers:this.getAuthHeaders()}),this.showMessage("留言提交成功"),this.feedbackMessage="",this.feedbackSubmitted=!0,setTimeout((()=>{this.feedbackSubmitted=!1}),2e3),await this.loadFeedbacks()}catch(a){console.error("提交留言失败:",a),this.showMessage("提交留言失败，请稍后重试","error")}else this.showMessage("留言内容不能为空","error");else this.showMessage("请先登录","error")},async deleteFeedback(e){if(!confirm("确定要删除这条留言吗？"))return;const t=localStorage.getItem("userId"),a=localStorage.getItem("authToken");if(t&&a)try{await y.A.delete(`${Gs}/api/canteen/feedback/${e.id}`,{headers:this.getAuthHeaders(),data:{user_id:t,is_admin:"admin"===localStorage.getItem("userRole")}}),this.showMessage("留言已删除"),await this.loadFeedbacks()}catch(s){console.error("删除留言失败:",s),this.showMessage(s.response?.data?.message||"删除失败，请稍后重试","error")}else this.showMessage("请先登录","error")},showMessage(e,t="success"){this.message={show:!0,content:e,type:t},setTimeout((()=>{this.message.show=!1}),3e3)},formatTime(e){return new Date(e).toLocaleString()}}};const to=(0,d.A)(eo,[["render",Ys],["__scopeId","data-v-c6c4b518"]]);var ao=to;const so={class:"chat-container"},oo={class:"user-list"},ro={key:0,class:"loading"},io={key:1,class:"no-users"},no={key:2},lo=["onClick"],co={class:"username"},uo={key:0,class:"message-count"},ho={class:"chat-box"},mo={key:0,class:"no-selection"},po={class:"messages"},go={key:0,class:"loading"},ko={key:1,class:"no-messages"},vo={class:"message-header"},fo={class:"username"},Lo={class:"message-actions"},wo=["onClick"],bo=["onClick"],yo={class:"message-content"},Io={key:0,class:"message-reply"},Co={class:"timestamp"},_o={class:"reply-area"},Ao={key:0,class:"selected-message"},Eo={class:"input-area"},So=["placeholder"],$o=["disabled"];function Xo(e,t,a,i,n,l){return(0,o.uX)(),(0,o.CE)("div",so,[(0,o.Lk)("div",oo,[t[3]||(t[3]=(0,o.Lk)("h3",null,"用户列表",-1)),n.loading?((0,o.uX)(),(0,o.CE)("div",ro,"加载中...")):0===n.users.length?((0,o.uX)(),(0,o.CE)("div",io,"暂无用户数据")):((0,o.uX)(),(0,o.CE)("ul",no,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.users,(e=>((0,o.uX)(),(0,o.CE)("li",{key:e.id,onClick:t=>l.selectUser(e),class:(0,r.C4)({active:n.selectedUser&&n.selectedUser.id===e.id})},[(0,o.Lk)("span",co,(0,r.v_)(e.username||e.email||"未命名用户"),1),e.messageCount?((0,o.uX)(),(0,o.CE)("span",uo,(0,r.v_)(e.messageCount),1)):(0,o.Q3)("",!0)],10,lo)))),128))]))]),(0,o.Lk)("div",ho,[n.selectedUser?((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.Lk)("h3",null,"与 "+(0,r.v_)(n.selectedUser.username||n.selectedUser.email||"未命名用户")+" 的留言记录",1),(0,o.Lk)("div",po,[n.loading?((0,o.uX)(),(0,o.CE)("div",go,"加载中...")):0===n.chatMessages.length?((0,o.uX)(),(0,o.CE)("div",ko,"暂无留言记录")):((0,o.uX)(!0),(0,o.CE)(o.FK,{key:2},(0,o.pI)(n.chatMessages,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:(0,r.C4)(["message",e.isAdmin?"admin":"user"])},[(0,o.Lk)("div",vo,[(0,o.Lk)("span",fo,(0,r.v_)(e.username),1),(0,o.Lk)("div",Lo,[(0,o.Lk)("button",{class:"action-btn delete",onClick:t=>l.deleteMessage(e)},"删除",8,wo),e.admin_reply?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"action-btn reply",onClick:t=>l.selectMessage(e)},"回复",8,bo))])]),(0,o.Lk)("div",yo,(0,r.v_)(e.message),1),e.admin_reply?((0,o.uX)(),(0,o.CE)("div",Io,[t[4]||(t[4]=(0,o.Lk)("strong",null,"管理员回复：",-1)),(0,o.eW)(" "+(0,r.v_)(e.admin_reply),1)])):(0,o.Q3)("",!0),(0,o.Lk)("div",Co,(0,r.v_)(l.formatTimestamp(e.created_at)),1)],2)))),128))]),(0,o.Lk)("div",_o,[n.selectedMessage?((0,o.uX)(),(0,o.CE)("div",Ao,[(0,o.eW)(" 正在回复: "+(0,r.v_)(n.selectedMessage.message)+" ",1),(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.cancelReply&&l.cancelReply(...e)),class:"cancel-btn"},"取消回复")])):(0,o.Q3)("",!0),(0,o.Lk)("div",Eo,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.adminReply=e),placeholder:n.selectedMessage?"输入回复...":"发送新消息给该用户...",rows:"3"},null,8,So),[[s.Jo,n.adminReply]]),(0,o.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>l.sendMessage&&l.sendMessage(...e)),class:"send-btn",disabled:n.loading||!n.adminReply.trim()},(0,r.v_)(n.selectedMessage?"发送回复":"发送消息"),9,$o)])])],64)):((0,o.uX)(),(0,o.CE)("div",mo,"请选择一个用户查看留言记录"))])])}const Uo="https://api.26ywzm.icu";var Fo={data(){return{users:[],selectedUser:null,chatMessages:[],selectedMessage:null,adminReply:"",loading:!1,message:{show:!1,content:"",type:""}}},methods:{async fetchUsers(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("userRole");if("admin"!==t&&"super_admin"!==t)return void this.$router.push("/");const a={Authorization:`Bearer ${e}`},s=await y.A.get(`${Uo}/api/canteen/users`,{headers:a});this.users=s.data||[]}catch(e){console.error("获取用户列表失败:",e),alert("获取用户列表失败："+(e.response?.data?.message||e.message))}},selectUser(e){this.selectedUser=e,this.selectedMessage=null,this.adminReply="",e?this.fetchUserMessages(e.id):this.chatMessages=[]},async fetchUserMessages(e){try{const t=localStorage.getItem("authToken"),a=localStorage.getItem("userRole");if("admin"!==a&&"super_admin"!==a)return void this.$router.push("/");const s={Authorization:`Bearer ${t}`},o=await y.A.get(`${Uo}/api/canteen/feedback/${e}`,{headers:s});this.chatMessages=o.data.map((e=>({...e,isAdmin:null!==e.admin_reply})))}catch(t){console.error("获取留言记录失败:",t),alert("获取留言记录失败："+(t.response?.data?.message||t.message))}},selectMessage(e){this.selectedMessage=e,this.adminReply=""},async sendMessage(){if(this.adminReply.trim())if(this.selectedUser||this.selectedMessage)try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("userRole");if("admin"!==t&&"super_admin"!==t)return void this.$router.push("/");const a={Authorization:`Bearer ${e}`};if(this.selectedMessage){const e=await y.A.put(`${Uo}/api/canteen/feedback/${this.selectedMessage.id}/reply`,{admin_reply:this.adminReply},{headers:a});if("回复成功"!==e.data.message)throw new Error(e.data.message||"回复失败");alert("回复成功"),await this.fetchUserMessages(this.selectedUser.id),this.adminReply="",this.selectedMessage=null}else if(this.selectedUser){const e=await y.A.post(`${Uo}/api/canteen/feedback/admin-message`,{user_id:this.selectedUser.id,message:this.adminReply},{headers:a});if(!e.data.message)throw new Error("发送失败");alert(e.data.message),await this.fetchUserMessages(this.selectedUser.id),this.adminReply=""}}catch(e){console.error("发送消息失败:",e),alert("发送消息失败："+(e.response?.data?.message||e.message))}else alert("请选择一个用户或留言进行回复");else alert("请输入回复内容")},cancelReply(){this.selectedMessage=null,this.adminReply=""},async deleteMessage(e){if(confirm("确定要删除这条留言吗？"))try{const t=localStorage.getItem("authToken"),a=localStorage.getItem("userRole");if("admin"!==a&&"super_admin"!==a)return void this.$router.push("/");const s={Authorization:`Bearer ${t}`};await y.A.delete(`${Uo}/api/canteen/feedback/${e.id}`,{headers:s}),alert("留言已删除"),await this.fetchUserMessages(this.selectedUser.id)}catch(t){alert("删除留言失败："+(t.response?.data?.message||t.message))}},formatTimestamp(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}},async mounted(){const e=localStorage.getItem("userRole");"admin"===e||"super_admin"===e?this.fetchUsers():this.$router.push("/")}};const To=(0,d.A)(Fo,[["render",Xo],["__scopeId","data-v-62e10767"]]);var Mo=To;const Vo={key:0,class:"loading"},Do={key:1},zo={key:0,class:"create-vote-section"},Po={class:"form-group"},Ro={class:"form-group"},Wo={class:"form-group"},xo=["onUpdate:modelValue","placeholder"],Oo=["onClick"],Bo={class:"form-actions"},Qo={key:1,class:"vote-list"},No={class:"vote-info"},qo={class:"vote-options"},jo={class:"options-list"},Ko={class:"option-label"},Jo={class:"vote-count"},Ho={class:"result-bar-container"},Zo={class:"result-count"},Yo={class:"total-votes"},Go={class:"vote-actions"},er=["onClick"],tr={class:"action-bar"};function ar(e,t,a,i,n,l){return(0,o.uX)(),(0,o.CE)("div",null,[t[12]||(t[12]=(0,o.Lk)("h2",null,"管理投票",-1)),n.loading?((0,o.uX)(),(0,o.CE)("div",Vo,t[6]||(t[6]=[(0,o.Lk)("span",null,"加载中...",-1)]))):((0,o.uX)(),(0,o.CE)("div",Do,[n.showCreateForm?((0,o.uX)(),(0,o.CE)("div",zo,[t[10]||(t[10]=(0,o.Lk)("h3",null,"创建新投票",-1)),(0,o.Lk)("div",Po,[t[7]||(t[7]=(0,o.Lk)("label",null,"标题：",-1)),(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.newVote.title=e),class:"form-input",placeholder:"请输入投票标题"},null,512),[[s.Jo,n.newVote.title]])]),(0,o.Lk)("div",Ro,[t[8]||(t[8]=(0,o.Lk)("label",null,"描述：",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.newVote.description=e),class:"form-input",placeholder:"请输入投票描述"},null,512),[[s.Jo,n.newVote.description]])]),(0,o.Lk)("div",Wo,[t[9]||(t[9]=(0,o.Lk)("label",null,"选项：",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.newVote.options,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"option-input"},[(0,o.bo)((0,o.Lk)("input",{"onUpdate:modelValue":e=>n.newVote.options[t]=e,class:"form-input",placeholder:"选项 "+(t+1)},null,8,xo),[[s.Jo,n.newVote.options[t]]]),(0,o.Lk)("button",{onClick:e=>l.removeOption(t),class:"remove-option-btn"},"删除",8,Oo)])))),128)),(0,o.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>l.addOption&&l.addOption(...e)),class:"add-option-btn"},"添加选项")]),(0,o.Lk)("div",Bo,[(0,o.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.submitNewVote&&l.submitNewVote(...e)),class:"submit-btn"},"创建投票"),(0,o.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.cancelCreate&&l.cancelCreate(...e)),class:"cancel-btn"},"取消")])])):((0,o.uX)(),(0,o.CE)("div",Qo,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.votes,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"vote-item"},[(0,o.Lk)("div",No,[(0,o.Lk)("h3",null,(0,r.v_)(e.title),1),(0,o.Lk)("p",null,(0,r.v_)(e.description),1),(0,o.Lk)("div",qo,[t[11]||(t[11]=(0,o.Lk)("h4",null,"投票选项：",-1)),(0,o.Lk)("div",jo,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.options,((t,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"option-result"},[(0,o.Lk)("div",Ko,[(0,o.eW)((0,r.v_)(t)+" ",1),(0,o.Lk)("span",Jo,"("+(0,r.v_)(e.results[t]||0)+"票)",1)]),(0,o.Lk)("div",Ho,[(0,o.Lk)("div",{class:"result-bar",style:(0,r.Tr)({width:l.getPercentage(e.results[t],e.totalVotes)+"%",backgroundColor:l.getBarColor(a)})},null,4),(0,o.Lk)("span",Zo,(0,r.v_)(((e.results[t]||0)/(e.totalVotes||1)*100).toFixed(1))+"% ",1)])])))),128))]),(0,o.Lk)("p",Yo,"总投票数："+(0,r.v_)(e.totalVotes||0),1)])]),(0,o.Lk)("div",Go,[(0,o.Lk)("button",{class:"delete-btn",onClick:t=>l.deleteVote(e.id)},"删除投票",8,er)])])))),128))])),(0,o.Lk)("div",tr,[n.showCreateForm?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=e=>n.showCreateForm=!0)},"创建新投票"))])]))])}const sr="https://api.26ywzm.icu";var or={name:"AdminManageVotes",mixins:[sa],data(){return{votes:[],loading:!1,showCreateForm:!1,newVote:{title:"",description:"",options:["",""]}}},mounted(){this.checkAdminAuth()&&this.fetchVotes()},methods:{async fetchVotes(){this.loading=!0;try{console.log("开始获取投票列表");const e=await y.A.get(`${sr}/api/canteen/votes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("获取到的投票数据:",e.data),this.votes=e.data.map((e=>({...e,options:Array.isArray(e.options)?e.options:[]}))),console.log("处理后的投票数据:",this.votes)}catch(e){console.error("获取投票失败:",e),console.error("错误详情:",e.response?.data||e.message),Ze.nk.error("获取投票列表失败")}finally{this.loading=!1}},async deleteVote(e){if(confirm("确定要删除这个投票吗？此操作不可恢复，所有投票记录都将被删除。"))try{console.log(`开始删除投票 ID: ${e}`),await y.A.delete(`${sr}/api/canteen/votes/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("投票删除成功"),this.votes=this.votes.filter((t=>t.id!==e))}catch(t){console.error("删除投票失败:",t),console.error("错误详情:",t.response?.data||t.message),401===t.response?.status?Ze.nk.error("权限不足，请确保您已登录并具有管理员权限"):t.response?.data?.message?Ze.nk.error(t.response.data.message):Ze.nk.error("删除投票失败，请稍后重试")}},addOption(){this.newVote.options.push("")},removeOption(e){this.newVote.options.length>2?this.newVote.options.splice(e,1):Ze.nk.warning("至少需要两个选项")},async submitNewVote(){if(this.validateForm())try{console.log("准备提交的投票数据:",this.newVote);const e=await y.A.post(`${sr}/api/canteen/votes`,{...this.newVote,options:this.newVote.options.filter((e=>e.trim()))},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("创建投票响应:",e.data),Ze.nk.success("投票创建成功"),this.showCreateForm=!1,this.resetForm(),this.fetchVotes()}catch(e){console.error("创建投票失败:",e),console.error("错误详情:",e.response?.data||e.message),Ze.nk.error(e.response?.data?.message||"创建投票失败")}},validateForm(){return this.newVote.title.trim()?this.newVote.description.trim()?!this.newVote.options.some((e=>!e.trim()))||(Ze.nk.warning("请填写所有选项"),!1):(Ze.nk.warning("请输入投票描述"),!1):(Ze.nk.warning("请输入投票标题"),!1)},resetForm(){this.newVote={title:"",description:"",options:["",""]}},cancelCreate(){this.showCreateForm=!1,this.resetForm()},getPercentage(e,t){return t?e/t*100:0},getBarColor(e){const t=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399"];return t[e%t.length]}}};const rr=(0,d.A)(or,[["render",ar],["__scopeId","data-v-b206f670"]]);var ir=rr;const nr={class:"vote-detail"},lr={key:0,class:"loading"},cr={key:1,class:"vote-content"},dr={class:"vote-header"},ur={class:"description"},hr={key:0,class:"vote-options"},mr={class:"options-list"},pr=["onClick"],gr={key:1,class:"vote-result"},kr={class:"vote-stats"},vr={class:"stats-list"},fr={class:"stat-label"},Lr={class:"stat-bar-container"},wr={class:"stat-value"},br={class:"vote-actions"};function yr(e,t,a,s,i,n){const l=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",nr,[i.loading?((0,o.uX)(),(0,o.CE)("div",lr,t[0]||(t[0]=[(0,o.Lk)("span",null,"加载中...",-1)]))):((0,o.uX)(),(0,o.CE)("div",cr,[(0,o.Lk)("div",dr,[(0,o.Lk)("h2",null,(0,r.v_)(i.vote.title),1),(0,o.Lk)("p",ur,(0,r.v_)(i.vote.description),1)]),i.hasVoted?((0,o.uX)(),(0,o.CE)("div",gr,[t[3]||(t[3]=(0,o.Lk)("div",{class:"result-message"},[(0,o.Lk)("i",{class:"el-icon-check"}),(0,o.Lk)("span",null,"您已完成投票")],-1)),(0,o.Lk)("div",kr,[t[2]||(t[2]=(0,o.Lk)("h3",null,"当前投票结果：",-1)),(0,o.Lk)("div",vr,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.vote.results,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"stat-item"},[(0,o.Lk)("div",fr,(0,r.v_)(t),1),(0,o.Lk)("div",Lr,[(0,o.Lk)("div",{class:"stat-bar",style:(0,r.Tr)({width:e/i.vote.totalVotes*100+"%"})},null,4),(0,o.Lk)("span",wr,(0,r.v_)(e)+"票 ("+(0,r.v_)((e/i.vote.totalVotes*100).toFixed(1))+"%)",1)])])))),128))])])])):((0,o.uX)(),(0,o.CE)("div",hr,[t[1]||(t[1]=(0,o.Lk)("h3",null,"请选择您的选项：",-1)),(0,o.Lk)("div",mr,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.vote.options,((e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:"option-item"},[(0,o.Lk)("button",{onClick:t=>n.submitVote(e),class:"option-button"},(0,r.v_)(e),9,pr)])))),128))])])),(0,o.Lk)("div",br,[(0,o.bF)(l,{to:"/votelist",class:"back-button"},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.eW)(" 返回投票列表 ")]))),_:1})])]))])}const Ir="https://api.26ywzm.icu";var Cr={name:"VoteDetail",data(){return{vote:{title:"",description:"",options:[],results:{},totalVotes:0},hasVoted:!1,loading:!0}},mounted(){this.fetchVoteDetails()},methods:{async fetchVoteDetails(){const e=this.$route.params.id;try{const t=await y.A.get(`${Ir}/api/canteen/votes/${e}`);this.vote={...t.data,results:t.data.results||{},totalVotes:t.data.totalVotes||0};const a=localStorage.getItem("userId"),s=await y.A.get(`${Ir}/api/canteen/votes/${e}/user/${a}`);this.hasVoted=s.data.hasVoted}catch(t){console.error("获取投票详情失败:",t),Ze.nk.error("获取投票详情失败")}finally{this.loading=!1}},async submitVote(e){const t=this.$route.params.id;try{await y.A.post(`${Ir}/api/canteen/votes/${t}/vote`,{option:e},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("投票成功"),this.hasVoted=!0,await this.fetchVoteDetails()}catch(a){console.error("投票失败:",a),401===a.response?.status?Ze.nk.error("请先登录后再投票"):a.response?.data?.message?Ze.nk.error(a.response.data.message):Ze.nk.error("投票失败，请稍后重试")}}}};const _r=(0,d.A)(Cr,[["render",yr],["__scopeId","data-v-028eb128"]]);var Ar=_r;const Er={class:"vote-list-container"},Sr={key:0,class:"loading"},$r={key:1,class:"empty-state"},Xr={key:2,class:"vote-list"},Ur={class:"vote-title"},Fr={class:"vote-description"},Tr={class:"vote-status"},Mr={class:"vote-count"};function Vr(e,t,a,s,i,n){const l=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",Er,[t[2]||(t[2]=(0,o.Lk)("h2",null,"投票列表",-1)),i.loading?((0,o.uX)(),(0,o.CE)("div",Sr,t[0]||(t[0]=[(0,o.Lk)("span",null,"加载中...",-1)]))):0===i.votes.length?((0,o.uX)(),(0,o.CE)("div",$r," 暂无投票 ")):((0,o.uX)(),(0,o.CE)("div",Xr,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.votes,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"vote-card"},[(0,o.Lk)("h3",Ur,(0,r.v_)(e.title),1),(0,o.Lk)("p",Fr,(0,r.v_)(e.description),1),(0,o.Lk)("div",Tr,[(0,o.Lk)("span",Mr,(0,r.v_)(e.totalVotes||0)+" 人已投票",1)]),(0,o.bF)(l,{to:{name:"VoteDetail",params:{id:e.id}},class:"vote-link"},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)(" 参与投票 ")]))),_:2},1032,["to"])])))),128))]))])}const Dr="https://api.26ywzm.icu";var zr={name:"VoteList",data(){return{votes:[],loading:!1}},mounted(){this.fetchVotes()},methods:{async fetchVotes(){this.loading=!0;try{const e=await y.A.get(`${Dr}/api/canteen/votes`);this.votes=e.data}catch(e){console.error("获取投票失败:",e)}finally{this.loading=!1}}}};const Pr=(0,d.A)(zr,[["render",Vr],["__scopeId","data-v-8dafb1e8"]]);var Rr=Pr;const Wr=[{path:"/",name:"CommunityHome",component:E},{path:"/login",name:"UserLogin",component:O},{path:"/register",name:"UserRegister",component:ue},{path:"/profile",name:"Profile",component:Ft},{path:"/discover",name:"Discover",component:tt},{path:"/news/:id",name:"NewsDetail",component:jt},{path:"/articles/new",name:"ArticleEditor",component:na},{path:"/canteenorder",name:"CanteenOrder",component:Ea},{path:"/canteenadmin",name:"CanteenAdmin",component:Ha},{path:"/order/:orderId",name:"OrderDetail",component:vs},{path:"/canteen/orders",name:"OrderManagement",component:Bs},{path:"/feedback",name:"SubmitFeedback",component:ao},{path:"/managefeedback",name:"ManageeFedback",component:Mo},{path:"/adminvotes",name:"AdminManageVotes",component:ir},{path:"/votedetail/:id",name:"VoteDetail",component:Ar},{path:"/votelist",name:"VoteList",component:Rr}],xr=(0,m.aE)({history:(0,m.LA)(),routes:Wr});var Or=xr,Br=a(2261),Qr=a(122),Nr=a(3274),qr=a(311),jr=a(9990),Kr=a(7144),Jr=a(7652),Hr=a(1384),Zr=a(3788),Yr=(a(2241),a(6832)),Gr=a(8519),ei=a(1656);a(4188);const ti=()=>{const e=(0,s.Ef)(h),t=(0,Br.Ey)();return e.use(Or),e.use(Qr.$n),e.use(Nr.B8),e.use(qr.HF),e.use(jr.gq),e.use(Kr.lG),e.use(Yr.lj),e.use(Yr.ct),e.use(Gr.S2),e.use(ei.kZ),e.use(Ze.nk),e.use(Jr.lV),e.use(Hr.D0),e.use(Zr.Qh),e.use(t),e},ai=ti();ai.mount("#app")}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,s,o,r){if(!s){var i=1/0;for(d=0;d<e.length;d++){s=e[d][0],o=e[d][1],r=e[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&r||i>=r)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(n=!1,r<i&&(i=r));if(n){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,o,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,r,i=s[0],n=s[1],l=s[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(o in n)a.o(n,o)&&(a.m[o]=n[o]);if(l)var d=l(a)}for(t&&t(s);c<i.length;c++)r=i[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},s=self["webpackChunkcommunity_service"]=self["webpackChunkcommunity_service"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(8313)}));s=a.O(s)})();
//# sourceMappingURL=app.156cd2ba.js.map