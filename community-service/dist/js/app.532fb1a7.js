(function(){"use strict";var e={5817:function(e,t,a){var s=a(5130),r=a(6768),o=a(4232);const i={id:"app"},n={class:"menu-right"};function l(e,t,a,s,l,c){const d=(0,r.g2)("router-link"),u=(0,r.g2)("el-menu-item"),h=(0,r.g2)("el-menu"),m=(0,r.g2)("router-view"),p=(0,r.g2)("van-tabbar-item"),g=(0,r.g2)("van-tabbar");return(0,r.uX)(),(0,r.CE)("div",i,[l.isMobile?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(h,{key:0,"default-active":l.activeIndex,class:(0,o.C4)([{"nav-hidden":l.isNavHidden},"top-menu"]),mode:"horizontal","background-color":"#444","text-color":"#fff","active-text-color":"#1e90ff"},{default:(0,r.k6)((()=>[t[3]||(t[3]=(0,r.Lk)("div",{class:"logo"},"Á§æÂå∫ÊúçÂä°",-1)),(0,r.Lk)("div",n,[(0,r.bF)(u,{index:"1"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{to:"/"},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)("È¶ñÈ°µ")]))),_:1})])),_:1}),(0,r.bF)(u,{index:"2"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{to:"/discover"},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)("ÂèëÁé∞")]))),_:1})])),_:1}),(0,r.bF)(u,{index:"3"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{to:"/profile"},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)("ÊàëÁöÑ")]))),_:1})])),_:1})])])),_:1},8,["default-active","class"])),(0,r.Lk)("div",{class:(0,o.C4)({"content-padding":!l.isNavHidden&&!l.isMobile}),style:{"margin-bottom":"60px"}},[(0,r.bF)(m)],2),l.isMobile?((0,r.uX)(),(0,r.Wv)(g,{key:1,route:""},{default:(0,r.k6)((()=>[(0,r.bF)(p,{replace:"",to:"/",icon:"home-o"},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" È¶ñÈ°µ ")]))),_:1}),(0,r.bF)(p,{replace:"",to:"/discover",icon:"apps-o"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)(" ÂèëÁé∞ ")]))),_:1}),(0,r.bF)(p,{to:c.profilePath,icon:"user-o",onClick:c.handleProfileClick},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)(" ÊàëÁöÑ ")]))),_:1},8,["to","onClick"])])),_:1})):(0,r.Q3)("",!0)])}a(4114);var c={data(){return{isMobile:!1,isNavHidden:!1,lastScrollTop:0,activeIndex:"1"}},computed:{profilePath(){localStorage.getItem("authToken");return"/profile"}},mounted(){this.checkDevice(),window.addEventListener("resize",this.checkDevice),window.addEventListener("scroll",this.handleScroll)},methods:{checkDevice(){this.isMobile=window.innerWidth<=768},handleScroll(){const e=window.pageYOffset||document.documentElement.scrollTop;this.isNavHidden=e>this.lastScrollTop&&e>100,this.lastScrollTop=e},handleProfileClick(){const e=localStorage.getItem("authToken");e||this.$router.push("/profile")}}},d=a(1241);const u=(0,d.A)(c,[["render",l],["__scopeId","data-v-34c96f02"]]);var h=u,m=a(1387);const p={class:"home-container"},g=["src"],k={class:"hot-news"},v={class:"hot-news-grid"},f=["src"],L={class:"news-list"},w={class:"news-date"};function b(e,t,a,s,i,n){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",p,[(0,r.Lk)("div",{class:"carousel",onMouseenter:t[2]||(t[2]=(...e)=>n.pauseCarousel&&n.pauseCarousel(...e)),onMouseleave:t[3]||(t[3]=(...e)=>n.startCarousel&&n.startCarousel(...e))},[i.carouselImages.length>0?((0,r.uX)(),(0,r.Wv)(l,{key:0,to:{name:"NewsDetail",params:{id:i.carouselImages[i.currentImage].id}}},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:i.carouselImages[i.currentImage].blobUrl,alt:"ËΩÆÊí≠Âõæ",class:"carousel-image"},null,8,g)])),_:1},8,["to"])):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.prevImage&&n.prevImage(...e))},"‚Äπ"),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.nextImage&&n.nextImage(...e))},"‚Ä∫")],32),(0,r.Lk)("section",k,[t[4]||(t[4]=(0,r.Lk)("h2",null,"ÁÉ≠Èó®Êñ∞Èóª",-1)),(0,r.Lk)("div",v,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.hotNews,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"news-item"},[(0,r.bF)(l,{to:{name:"NewsDetail",params:{id:e.id}}},{default:(0,r.k6)((()=>[(0,r.Lk)("img",{src:e.blobUrl,alt:"Êñ∞ÈóªÂõæÁâá",class:"news-image"},null,8,f)])),_:2},1032,["to"]),(0,r.Lk)("p",null,(0,o.v_)(e.title),1)])))),128))])]),(0,r.Lk)("section",L,[t[5]||(t[5]=(0,r.Lk)("h2",null,"Êñ∞ÈóªÂàóË°®",-1)),(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.newsList,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id},[(0,r.bF)(l,{to:{name:"NewsDetail",params:{id:e.id}}},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(e.title)+" ",1),(0,r.Lk)("span",w,(0,o.v_)(n.formatDate(e.created_at)),1)])),_:2},1032,["to"])])))),128))])])])}a(4603),a(7566),a(8721);var y=a(4373),I={data(){return{isMobile:!1,isNavHidden:!1,carouselImages:["carousel1.jpg","carousel2.jpg","carousel3.jpg"],currentImage:0,hotNews:[{id:1,title:"Á§æÂå∫Ê¥ªÂä®‰∏Ä",image:"hot1.jpg"},{id:2,title:"Á§æÂå∫Ê¥ªÂä®‰∫å",image:"hot2.jpg"},{id:3,title:"Á§æÂå∫Ê¥ªÂä®‰∏â",image:"hot3.jpg"}],newsList:[{id:1,title:"Êñ∞ÈóªÊù°ÁõÆ1"},{id:2,title:"Êñ∞ÈóªÊù°ÁõÆ2"},{id:3,title:"Êñ∞ÈóªÊù°ÁõÆ3"}]}},mounted(){this.checkDevice(),window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.checkDevice)},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.checkDevice)},methods:{checkDevice(){this.isMobile=window.innerWidth<=768},handleScroll(){this.isNavHidden=window.scrollY>100},toggleNav(){this.isNavHidden=!this.isNavHidden},prevImage(){this.currentImage=(this.currentImage+this.carouselImages.length-1)%this.carouselImages.length},nextImage(){this.currentImage=(this.currentImage+1)%this.carouselImages.length}}};const C="https://api.26ywzm.icu/api/auth";var _={...I,data(){return{...I.data(),carouselImages:[],hotNews:[],newsList:[],currentImage:0,intervalId:null,imageCache:new Map}},mounted(){this.checkDevice(),window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.checkDevice),this.fetchData(),this.startCarousel()},beforeUnmount(){clearInterval(this.intervalId)},methods:{...I.methods,async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=e.startsWith("/uploads/")?e:`/uploads/${e}`,a=C.replace("/api/auth",""),s=await fetch(`${a}${t}`),r=await s.blob(),o=URL.createObjectURL(r);return this.imageCache.set(e,o),o}catch(t){return console.error("Âä†ËΩΩÂõæÁâáÂ§±Ë¥•:",t),""}},async fetchData(){try{const e=await y.A.get(`${C}/articles?category=carousel`);this.carouselImages=e.data;for(const s of this.carouselImages)await this.loadImage(s);const t=await y.A.get(`${C}/articles?category=hotNews`);this.hotNews=t.data;for(const s of this.hotNews)await this.loadImage(s);const a=await y.A.get(`${C}/articles?category=newsList`);this.newsList=a.data}catch(e){console.error("Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•:",e)}},startCarousel(){this.intervalId=setInterval((()=>{this.nextImage()}),3e3)},pauseCarousel(){clearInterval(this.intervalId)},nextImage(){this.carouselImages.length>0&&(this.currentImage=(this.currentImage+1)%this.carouselImages.length)},prevImage(){this.carouselImages.length>0&&(this.currentImage=(this.currentImage+this.carouselImages.length-1)%this.carouselImages.length)},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}}};const A=(0,d.A)(_,[["render",b],["__scopeId","data-v-4b5d05a2"]]);var E=A;const S={class:"login-page"},$={class:"login-container"},X={class:"form-group"},U={class:"form-group"},F={class:"password-input"},T=["type"],M={class:"form-footer"},V=["disabled"],D={class:"button-icon"},z={class:"register-link"};function P(e,t,a,i,n,l){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",S,[(0,r.Lk)("div",$,[t[8]||(t[8]=(0,r.Lk)("div",{class:"login-header"},[(0,r.Lk)("div",{class:"logo-container"},[(0,r.Lk)("span",{class:"logo-icon"},"üè†")]),(0,r.Lk)("h2",null,"Ê¨¢ËøéÂõûÊù•"),(0,r.Lk)("p",{class:"subtitle"},"ËØ∑ÁôªÂΩïÊÇ®ÁöÑË¥¶Êà∑")],-1)),(0,r.Lk)("form",{onSubmit:t[3]||(t[3]=(0,s.D$)(((...e)=>l.login&&l.login(...e)),["prevent"])),class:"login-form"},[(0,r.Lk)("div",X,[t[4]||(t[4]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üìß"),(0,r.eW)(" ÈÇÆÁÆ± ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":t[0]||(t[0]=e=>n.email=e),required:"",placeholder:"ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÈÇÆÁÆ±Âú∞ÂùÄ"},null,512),[[s.Jo,n.email]])]),(0,r.Lk)("div",U,[t[5]||(t[5]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üîí"),(0,r.eW)(" ÂØÜÁ†Å ")],-1)),(0,r.Lk)("div",F,[(0,r.bo)((0,r.Lk)("input",{type:n.showPassword?"text":"password","onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),required:"",placeholder:"ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂØÜÁ†Å"},null,8,T),[[s.hp,n.password]]),(0,r.Lk)("button",{type:"button",class:"toggle-password",onClick:t[2]||(t[2]=e=>n.showPassword=!n.showPassword)},(0,o.v_)(n.showPassword?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"),1)])]),(0,r.Lk)("div",M,[(0,r.Lk)("button",{type:"submit",class:"login-button",disabled:n.loading},[(0,r.Lk)("span",D,(0,o.v_)(n.loading?"‚åõ":"üîë"),1),(0,r.eW)(" "+(0,o.v_)(n.loading?"ÁôªÂΩï‰∏≠...":"ÁôªÂΩï"),1)],8,V),(0,r.Lk)("p",z,[t[7]||(t[7]=(0,r.eW)(" ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü ")),(0,r.bF)(c,{to:"/register"},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)("Á´ãÂç≥Ê≥®ÂÜå")]))),_:1})])])],32)])])}const R="https://api.26ywzm.icu/api/auth";var W={name:"UserLogin",data(){return{email:"",password:"",loading:!1,showPassword:!1}},methods:{async login(){this.loading=!0;try{const e=await y.A.post(`${R}/login`,{email:this.email,password:this.password}),{token:t,user:a}=e.data;switch(localStorage.setItem("authToken",t),localStorage.setItem("userRole",a.role),localStorage.setItem("username",a.username),localStorage.setItem("userId",a.id),localStorage.setItem("email",a.email),a.role){case"super_admin":await this.$router.push("/profile");break;case"admin":await this.$router.push("/profile");break;default:await this.$router.push("/profile")}}catch(e){let t="ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï";e.response?.data?.message&&(t=e.response.data.message),alert(t)}finally{this.loading=!1}}}};const x=(0,d.A)(W,[["render",P],["__scopeId","data-v-4c711710"]]);var O=x;const B={class:"register-page"},Q={class:"register-container"},N={class:"form-group"},q={class:"form-group"},j={class:"form-group"},K={class:"password-input"},J=["type"],H={class:"form-group"},Z={class:"password-input"},Y=["type"],G={key:0,class:"password-strength"},ee={class:"strength-meter"},te={class:"form-footer"},ae=["disabled"],se={class:"button-icon"},re={class:"login-link"};function oe(e,t,a,i,n,l){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",B,[(0,r.Lk)("div",Q,[t[14]||(t[14]=(0,r.Lk)("div",{class:"register-header"},[(0,r.Lk)("div",{class:"logo-container"},[(0,r.Lk)("span",{class:"logo-icon"},"‚ú®")]),(0,r.Lk)("h2",null,"ÂàõÂª∫Ë¥¶Êà∑"),(0,r.Lk)("p",{class:"subtitle"},"Âä†ÂÖ•Êàë‰ª¨ÁöÑÁ§æÂå∫")],-1)),(0,r.Lk)("form",{onSubmit:t[6]||(t[6]=(0,s.D$)(((...e)=>l.register&&l.register(...e)),["prevent"])),class:"register-form"},[(0,r.Lk)("div",N,[t[7]||(t[7]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üë§"),(0,r.eW)(" Áî®Êà∑Âêç ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),required:"",placeholder:"ËØ∑ËæìÂÖ•Áî®Êà∑Âêç"},null,512),[[s.Jo,n.username]])]),(0,r.Lk)("div",q,[t[8]||(t[8]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üìß"),(0,r.eW)(" ÈÇÆÁÆ± ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":t[1]||(t[1]=e=>n.email=e),required:"",placeholder:"ËØ∑ËæìÂÖ•ÈÇÆÁÆ±Âú∞ÂùÄ"},null,512),[[s.Jo,n.email]])]),(0,r.Lk)("div",j,[t[9]||(t[9]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üîí"),(0,r.eW)(" ÂØÜÁ†Å ")],-1)),(0,r.Lk)("div",K,[(0,r.bo)((0,r.Lk)("input",{type:n.showPassword?"text":"password","onUpdate:modelValue":t[2]||(t[2]=e=>n.password=e),required:"",placeholder:"ËØ∑ËæìÂÖ•ÂØÜÁ†Å"},null,8,J),[[s.hp,n.password]]),(0,r.Lk)("button",{type:"button",class:"toggle-password",onClick:t[3]||(t[3]=e=>n.showPassword=!n.showPassword)},(0,o.v_)(n.showPassword?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"),1)])]),(0,r.Lk)("div",H,[t[10]||(t[10]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üîê"),(0,r.eW)(" Á°ÆËÆ§ÂØÜÁ†Å ")],-1)),(0,r.Lk)("div",Z,[(0,r.bo)((0,r.Lk)("input",{type:n.showConfirmPassword?"text":"password","onUpdate:modelValue":t[4]||(t[4]=e=>n.confirmPassword=e),required:"",placeholder:"ËØ∑ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å"},null,8,Y),[[s.hp,n.confirmPassword]]),(0,r.Lk)("button",{type:"button",class:"toggle-password",onClick:t[5]||(t[5]=e=>n.showConfirmPassword=!n.showConfirmPassword)},(0,o.v_)(n.showConfirmPassword?"üëÅÔ∏è":"üëÅÔ∏è‚Äçüó®Ô∏è"),1)])]),n.password?((0,r.uX)(),(0,r.CE)("div",G,[t[11]||(t[11]=(0,r.Lk)("div",{class:"strength-label"},"ÂØÜÁ†ÅÂº∫Â∫¶Ôºö",-1)),(0,r.Lk)("div",ee,[(0,r.Lk)("div",{class:(0,o.C4)(["strength-bar",l.strengthClass]),style:(0,o.Tr)({width:l.passwordStrength+"%"})},null,6)]),(0,r.Lk)("div",{class:(0,o.C4)(["strength-text",l.strengthClass])},(0,o.v_)(l.strengthText),3)])):(0,r.Q3)("",!0),(0,r.Lk)("div",te,[(0,r.Lk)("button",{type:"submit",class:"register-button",disabled:n.loading||!l.isPasswordMatch},[(0,r.Lk)("span",se,(0,o.v_)(n.loading?"‚åõ":"‚ú®"),1),(0,r.eW)(" "+(0,o.v_)(n.loading?"Ê≥®ÂÜå‰∏≠...":"Ê≥®ÂÜå"),1)],8,ae),(0,r.Lk)("p",re,[t[13]||(t[13]=(0,r.eW)(" Â∑≤ÊúâË¥¶Âè∑Ôºü ")),(0,r.bF)(c,{to:"/login"},{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.eW)("Á´ãÂç≥ÁôªÂΩï")]))),_:1})])])],32)])])}const ie=(e=!0)=>{localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),e&&Oo.push("/login")},ne=(e,t={})=>{const{customErrorHandler:a=null,suppressAuthError:s=!1,showAlert:r=!0}=t;if(console.error("APIËØ∑Ê±ÇÂ§±Ë¥•:",e),e.response){const t=e.response.status,o=e.response.data?.message||"Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ",i=localStorage.getItem("userRole");if((401===t||403===t)&&"admin"===i)return r&&alert(403===t?"ÊÇ®Ê≤°ÊúâÊùÉÈôêÊâßË°åÊ≠§Êìç‰Ωú":"ÊÇ®ÁöÑÊìç‰ΩúÊú™Ë¢´ÊéàÊùÉÔºåËØ∑ËÅîÁ≥ªË∂ÖÁ∫ßÁÆ°ÁêÜÂëò"),Promise.reject(e);switch(t){case 403:case 401:s?r&&(alert("ÊÇ®ÁöÑÁôªÂΩïÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞ÁôªÂΩï"),Oo.push("/login")):ie();break;default:a?a(e):r&&alert(o)}}else e.request?r&&alert("ÁΩëÁªúÈîôËØØÔºåËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÁΩëÁªúËøûÊé•„ÄÇ"):r&&alert("ËØ∑Ê±ÇÈîôËØØÔºåËØ∑ÈáçËØï„ÄÇ");return Promise.reject(e)},le="https://api.26ywzm.icu/api/auth";var ce={name:"UserRegister",data(){return{username:"",email:"",password:"",confirmPassword:"",loading:!1,showPassword:!1,showConfirmPassword:!1}},computed:{isPasswordMatch(){return this.password===this.confirmPassword},passwordStrength(){if(!this.password)return 0;let e=0;return this.password.length>=8&&(e+=25),/\d/.test(this.password)&&(e+=25),/[a-z]/.test(this.password)&&(e+=25),(/[A-Z]/.test(this.password)||/[^A-Za-z0-9]/.test(this.password))&&(e+=25),e},strengthClass(){return this.passwordStrength<=25?"weak":this.passwordStrength<=50?"medium":this.passwordStrength<=75?"good":"strong"},strengthText(){return this.passwordStrength<=25?"Âº±":this.passwordStrength<=50?"‰∏≠":this.passwordStrength<=75?"ËâØÂ•Ω":"Âº∫"}},methods:{async register(){if(this.password===this.confirmPassword){this.loading=!0;try{await y.A.post(`${le}/register`,{username:this.username,email:this.email,password:this.password}),alert("Ê≥®ÂÜåÊàêÂäüÔºÅËØ∑ÁôªÂΩï"),this.$router.push("/login")}catch(e){ne(e,(()=>{e.response?.data?.message?alert(e.response.data.message):alert("Ê≥®ÂÜåÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}))}finally{this.loading=!1}}else alert("‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥")}}};const de=(0,d.A)(ce,[["render",oe],["__scopeId","data-v-22d222ac"]]);var ue=de;const he={class:"discover-container"},me={class:"discover"},pe={key:0,class:"content-wrapper"},ge={key:0,class:"feature-grid"},ke={key:1,class:"orders-section"},ve={class:"order-list"},fe={class:"order-header"},Le={class:"order-number"},we={class:"order-body"},be={class:"order-info"},ye={class:"price"},Ie={class:"date"},Ce=["onClick"],_e={key:2,class:"admin-section"},Ae={class:"feature-grid"},Ee={class:"admin-panel"},Se={class:"panel-header"},$e={key:0,class:"role-info"},Xe={class:"panel-content"},Ue={key:0,class:"error-message"},Fe={class:"user-section"},Te={class:"user-list"},Me={class:"user-info"},Ve={class:"username"},De={key:0,class:"user-actions"},ze=["onClick"],Pe=["onClick"],Re={class:"user-section"},We={class:"user-list"},xe={class:"user-info"},Oe={class:"username"},Be={key:0,class:"user-actions"},Qe=["onClick"],Ne=["onClick"],qe={class:"dialog-footer"},je={key:1,class:"login-prompt"};function Ke(e,t,a,s,i,n){const l=(0,r.g2)("router-link"),c=(0,r.g2)("el-alert"),d=(0,r.g2)("el-button"),u=(0,r.g2)("el-dialog"),h=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",he,[(0,r.Lk)("div",me,[t[22]||(t[22]=(0,r.Lk)("header",{class:"page-header"},[(0,r.Lk)("h1",null,"ÂèëÁé∞")],-1)),n.isLoggedIn?((0,r.uX)(),(0,r.CE)("div",pe,[n.isAdmin||n.isSuperAdmin?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",ge,[(0,r.bF)(l,{to:"/CanteenOrder",class:"feature-card"},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.Lk)("div",{class:"card-icon"},"üçΩÔ∏è",-1),(0,r.Lk)("span",{class:"card-title"},"Á§æÂå∫È£üÂ†Ç",-1)]))),_:1}),(0,r.Lk)("div",{class:"feature-card",onClick:t[0]||(t[0]=(...e)=>n.fetchUserOrders&&n.fetchUserOrders(...e))},t[4]||(t[4]=[(0,r.Lk)("div",{class:"card-icon"},"üìã",-1),(0,r.Lk)("span",{class:"card-title"},"ÊàëÁöÑËÆ¢Âçï",-1)])),(0,r.bF)(l,{to:"/feedback",class:"feature-card"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.Lk)("div",{class:"card-icon"},"üí≠",-1),(0,r.Lk)("span",{class:"card-title"},"ÊÑèËßÅÂèçÈ¶à",-1)]))),_:1}),(0,r.bF)(l,{to:"/votelist",class:"feature-card"},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.Lk)("div",{class:"card-icon"},"üìä",-1),(0,r.Lk)("span",{class:"card-title"},"ÁÆ°ÁêÜÊäïÁ•®",-1)]))),_:1})])),i.orders.length>0?((0,r.uX)(),(0,r.CE)("div",ke,[t[7]||(t[7]=(0,r.Lk)("h2",{class:"section-title"},"ÊàëÁöÑËÆ¢Âçï",-1)),(0,r.Lk)("div",ve,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.orders,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"order-card"},[(0,r.Lk)("div",fe,[(0,r.Lk)("span",Le,"ËÆ¢ÂçïÂè∑: "+(0,o.v_)(e.id),1),(0,r.Lk)("span",{class:(0,o.C4)(["order-status",e.status])},(0,o.v_)(n.getOrderStatusText(e.status)),3)]),(0,r.Lk)("div",we,[(0,r.Lk)("div",be,[(0,r.Lk)("div",ye,"¬•"+(0,o.v_)(e.total_price),1),(0,r.Lk)("div",Ie,(0,o.v_)(n.formatDate(e.created_at)),1)]),(0,r.Lk)("button",{onClick:t=>n.viewOrderDetails(e.id),class:"view-details-btn"}," Êü•ÁúãËØ¶ÊÉÖ ",8,Ce)])])))),128))])])):(0,r.Q3)("",!0),n.isAdmin||n.isSuperAdmin?((0,r.uX)(),(0,r.CE)("div",_e,[(0,r.Lk)("div",Ae,[(0,r.bF)(l,{to:"/articles/new",class:"feature-card admin"},{default:(0,r.k6)((()=>t[8]||(t[8]=[(0,r.Lk)("div",{class:"card-icon"},"üìù",-1),(0,r.Lk)("span",{class:"card-title"},"ÊñáÁ´†ÁºñÂÜô",-1)]))),_:1}),(0,r.Lk)("div",{class:"feature-card admin",onClick:t[1]||(t[1]=(...e)=>n.openAdminPanel&&n.openAdminPanel(...e))},t[9]||(t[9]=[(0,r.Lk)("div",{class:"card-icon"},"‚öôÔ∏è",-1),(0,r.Lk)("span",{class:"card-title"},"ÁÆ°ÁêÜÊ®°Âùó",-1)])),(0,r.bF)(l,{to:"/canteenadmin",class:"feature-card admin"},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.Lk)("div",{class:"card-icon"},"üè™",-1),(0,r.Lk)("span",{class:"card-title"},"È£üÂ†ÇÁÆ°ÁêÜ",-1)]))),_:1}),(0,r.bF)(l,{to:"/canteen/orders",class:"feature-card admin"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.Lk)("div",{class:"card-icon"},"üì¶",-1),(0,r.Lk)("span",{class:"card-title"},"ËÆ¢ÂçïÁÆ°ÁêÜ",-1)]))),_:1}),(0,r.bF)(l,{to:"/managefeedback",class:"feature-card admin"},{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.Lk)("div",{class:"card-icon"},"üì¢",-1),(0,r.Lk)("span",{class:"card-title"},"ÊÑèËßÅÂèçÈ¶à",-1)]))),_:1}),(0,r.bF)(l,{to:"/adminvotes",class:"feature-card admin"},{default:(0,r.k6)((()=>t[13]||(t[13]=[(0,r.Lk)("div",{class:"card-icon"},"üó≥Ô∏è",-1),(0,r.Lk)("span",{class:"card-title"},"ÁÆ°ÁêÜÊäïÁ•®",-1)]))),_:1})])])):(0,r.Q3)("",!0),(0,r.bF)(u,{modelValue:i.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>i.dialogVisible=e),title:"ÁÆ°ÁêÜÊ®°Âùó",width:"90%",fullscreen:i.isMobile,"before-close":n.handleClose,"close-on-click-modal":!1,class:"admin-dialog"},{footer:(0,r.k6)((()=>[(0,r.Lk)("div",qe,[(0,r.bF)(d,{onClick:n.closeDialog,type:"primary"},{default:(0,r.k6)((()=>t[18]||(t[18]=[(0,r.eW)("ÂÖ≥Èó≠")]))),_:1},8,["onClick"])])])),default:(0,r.k6)((()=>[(0,r.Lk)("div",Ee,[(0,r.Lk)("div",Se,[t[14]||(t[14]=(0,r.Lk)("h3",null,"ÁÆ°ÁêÜÂëòÂíåÁî®Êà∑ÂàóË°®",-1)),n.isAdmin&&!n.isSuperAdmin?((0,r.uX)(),(0,r.CE)("div",$e,[(0,r.bF)(c,{title:"ÊèêÁ§∫ÔºöÊÇ®ÂèØ‰ª•Êü•ÁúãÁî®Êà∑ÂàóË°®Ôºå‰ΩÜÂè™ÊúâË∂ÖÁ∫ßÁÆ°ÁêÜÂëòÂèØ‰ª•‰øÆÊîπÊùÉÈôê",type:"info",closable:!1,"show-icon":""})])):(0,r.Q3)("",!0)]),(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",Xe,[i.error?((0,r.uX)(),(0,r.CE)("div",Ue,(0,o.v_)(i.error),1)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("div",Fe,[t[15]||(t[15]=(0,r.Lk)("h4",null,"ÁÆ°ÁêÜÂëòÂàóË°®",-1)),(0,r.Lk)("div",Te,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.admins,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"user-card"},[(0,r.Lk)("div",Me,[(0,r.Lk)("span",Ve,(0,o.v_)(e.username),1),(0,r.Lk)("span",{class:(0,o.C4)(["role-badge",{super:"super_admin"===e.role}])},(0,o.v_)("super_admin"===e.role?"Ë∂ÖÁ∫ßÁÆ°ÁêÜÂëò":"ÁÆ°ÁêÜÂëò"),3)]),n.isSuperAdmin&&"super_admin"!==e.role?((0,r.uX)(),(0,r.CE)("div",De,[(0,r.Lk)("button",{onClick:t=>n.demoteUser(e.id),class:"action-btn demote"},"Èôç‰∏∫Áî®Êà∑",8,ze),(0,r.Lk)("button",{onClick:t=>n.deleteUser(e.id),class:"action-btn delete"},"Âà†Èô§",8,Pe)])):(0,r.Q3)("",!0)])))),128))])]),(0,r.Lk)("div",Re,[t[17]||(t[17]=(0,r.Lk)("h4",null,"Áî®Êà∑ÂàóË°®",-1)),(0,r.Lk)("div",We,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.users,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"user-card"},[(0,r.Lk)("div",xe,[(0,r.Lk)("span",Oe,(0,o.v_)(e.username),1),t[16]||(t[16]=(0,r.Lk)("span",{class:"role-badge"},"Áî®Êà∑",-1))]),n.isSuperAdmin?((0,r.uX)(),(0,r.CE)("div",Be,[(0,r.Lk)("button",{onClick:t=>n.promoteUser(e.id),class:"action-btn promote"},"Âçá‰∏∫ÁÆ°ÁêÜÂëò",8,Qe),(0,r.Lk)("button",{onClick:t=>n.deleteUser(e.id),class:"action-btn delete"},"Âà†Èô§",8,Ne)])):(0,r.Q3)("",!0)])))),128))])])],64))])),[[h,i.loading]])])])),_:1},8,["modelValue","fullscreen","before-close"])])):((0,r.uX)(),(0,r.CE)("div",je,[t[20]||(t[20]=(0,r.Lk)("div",{class:"prompt-icon"},"üîí",-1)),t[21]||(t[21]=(0,r.Lk)("p",null,"ËØ∑ÁôªÂΩï‰ª•Êü•ÁúãÂÜÖÂÆπ",-1)),(0,r.bF)(l,{to:"/login",class:"login-btn"},{default:(0,r.k6)((()=>t[19]||(t[19]=[(0,r.eW)("Á´ãÂç≥ÁôªÂΩï")]))),_:1})]))])])}const Je="https://api.26ywzm.icu/api/auth",He=async()=>{try{const e=localStorage.getItem("authToken");if(!e)return{valid:!1,reason:"no-token"};const t=await y.A.get(`${Je}/verify`,{headers:{Authorization:`Bearer ${e}`}});return t.data.valid?{valid:!0,role:t.data.role}:t.data.correctRole?(localStorage.setItem("userRole",t.data.correctRole),{valid:!1,reason:"role-mismatch",newRole:t.data.correctRole}):(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),{valid:!1,reason:"invalid-token"})}catch(e){return console.error("È™åËØÅÂ§±Ë¥•:",e),e.response&&401===e.response.status?(localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),{valid:!1,reason:"unauthorized"}):{valid:!0}}};var Ze=a(167);const Ye="https://api.26ywzm.icu/api/auth";var Ge={data(){return{dialogVisible:!1,showAdminPanel:!1,users:[],admins:[],orders:[],verificationInterval:null,loading:!1,error:null,isMobile:window.innerWidth<=768}},computed:{isLoggedIn(){return!!localStorage.getItem("authToken")},isAdmin(){const e=localStorage.getItem("userRole");return"admin"===e},isSuperAdmin(){const e=localStorage.getItem("userRole");return"super_admin"===e}},created(){this.isLoggedIn&&this.startVerification(),window.addEventListener("resize",this.handleResize)},beforeUnmount(){this.verificationInterval&&clearInterval(this.verificationInterval),window.removeEventListener("resize",this.handleResize)},methods:{handleResize(){this.isMobile=window.innerWidth<=768},startVerification(){this.verificationInterval&&clearInterval(this.verificationInterval),this.verifyAndUpdate(),this.verificationInterval=setInterval(this.verifyAndUpdate,3e5)},async verifyAndUpdate(){if(!this.isLoggedIn)return;const e=await He();e.valid||this.handleAuthError(e.reason)},handleAuthError(e){["no-token","invalid-token","unauthorized"].includes(e)&&(localStorage.clear(),this.verificationInterval&&clearInterval(this.verificationInterval),this.$router.push("/login"))},async fetchUserOrders(){try{const e=await y.A.get(`${Ye}/orders/user`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});this.orders=e.data.orders||e.data||[],0===this.orders.length&&Ze.nk.info("ÊöÇÊó†ËÆ¢ÂçïËÆ∞ÂΩï")}catch(e){console.error("Ëé∑ÂèñËÆ¢ÂçïÂ§±Ë¥•:",e),Ze.nk.error("Ëé∑ÂèñËÆ¢ÂçïÂàóË°®Â§±Ë¥•ÔºåËØ∑ÈáçËØï")}},async fetchUsers(){try{const e=await y.A.get(`${Ye}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});this.users=e.data.users||e.data}catch(e){console.error("Ëé∑ÂèñÁî®Êà∑ÂàóË°®Â§±Ë¥•:",e),403===e.response?.status?Ze.nk.warning("ÊÇ®Âè™ÊúâÊü•ÁúãÊùÉÈôê"):Ze.nk.error("Ëé∑ÂèñÁî®Êà∑ÂàóË°®Â§±Ë¥•ÔºåËØ∑ÈáçËØï")}},async fetchAdmins(){try{const e=await y.A.get(`${Ye}/users`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},params:{role:"admin"}}),t=e.data.users||e.data;this.admins=t.filter((e=>"admin"===e.role||"super_admin"===e.role))}catch(e){console.error("Ëé∑ÂèñÁÆ°ÁêÜÂëòÂàóË°®Â§±Ë¥•:",e),403===e.response?.status?Ze.nk.warning("ÊÇ®Âè™ÊúâÊü•ÁúãÊùÉÈôê"):Ze.nk.error("Ëé∑ÂèñÁÆ°ÁêÜÂëòÂàóË°®Â§±Ë¥•ÔºåËØ∑ÈáçËØï")}},async openAdminPanel(){this.dialogVisible=!0,await this.loadAdminData()},async loadAdminData(){this.loading=!0,this.error=null;try{const e=await Promise.allSettled([this.fetchUsers(),this.fetchAdmins()]),t=e.every((e=>"rejected"===e.status));t&&(this.error="Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}catch(e){console.error("Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:",e),this.error="Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑ÈáçËØï"}finally{this.loading=!1}},closeDialog(){this.dialogVisible=!1,this.error=null},handleClose(e){this.error=null,e()},async promoteUser(e){if(this.isSuperAdmin)try{await y.A.post(`${Ye}/promote/${e}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("Áî®Êà∑Â∑≤ÊàêÂäüÂçáÁ∫ß‰∏∫ÁÆ°ÁêÜÂëò"),await this.loadAdminData()}catch(t){ne(t),Ze.nk.error("ÂçáÁ∫ßÁÆ°ÁêÜÂëòÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}},async demoteUser(e){if(this.isSuperAdmin)try{await y.A.post(`${Ye}/demote/${e}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("ÁÆ°ÁêÜÂëòÂ∑≤ÊàêÂäüÈôçÁ∫ß‰∏∫ÊôÆÈÄöÁî®Êà∑"),await this.loadAdminData()}catch(t){ne(t),Ze.nk.error("ÈôçÁ∫ßÁÆ°ÁêÜÂëòÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}},async deleteUser(e){if(this.isSuperAdmin)try{await y.A.delete(`${Ye}/users/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),await this.loadAdminData()}catch(t){ne(t)}},viewOrderDetails(e){this.$router.push({name:"OrderDetail",params:{orderId:e}})},formatDate(e){if(!e)return"ÊÑüË∞¢‰ΩøÁî®";try{const t=new Date(e);if(isNaN(t.getTime()))return"--";const a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1};return t.toLocaleString("zh-CN",a).replace(/\//g,"-")}catch(t){return console.error("Êó•ÊúüÊ†ºÂºèÂåñÈîôËØØ:",t),"--"}},getOrderStatusText(e){const t={0:"ÂæÖÂ§ÑÁêÜ",1:"Â§ÑÁêÜ‰∏≠",2:"Â∑≤ÂÆåÊàê",3:"Â∑≤ÂèñÊ∂à"};return t[e]||"Êú™Áü•Áä∂ÊÄÅ"}},mounted(){this.isSuperAdmin&&(this.fetchUsers(),this.fetchAdmins())}};const et=(0,d.A)(Ge,[["render",Ke],["__scopeId","data-v-1e79242f"]]);var tt=et;const at={class:"profile-container"},st={class:"profile-card"},rt={key:0,class:"not-logged-in"},ot={class:"auth-buttons"},it={key:1,class:"loading-section"},nt={key:2,class:"profile-content"},lt={key:0,class:"message error"},ct={key:1,class:"message success"},dt={key:2,class:"user-info"},ut={class:"avatar-section"},ht={class:"avatar-overlay"},mt={class:"info-section"},pt={class:"info-item"},gt={class:"info-value"},kt={class:"info-item"},vt={class:"info-value"},ft={class:"action-buttons"},Lt={class:"form-group"},wt={class:"form-group"},bt={class:"form-group"},yt={class:"form-group"},It={class:"form-group"},Ct={class:"file-upload"},_t={key:0,class:"file-name"},At={class:"form-actions"},Et=["disabled"];function St(e,t,a,i,n,l){const c=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",at,[(0,r.Lk)("div",st,[n.isLoggedIn?n.loading?((0,r.uX)(),(0,r.CE)("div",it,t[14]||(t[14]=[(0,r.Lk)("div",{class:"loading-spinner"},null,-1),(0,r.Lk)("p",null,"Ê≠£Âú®Âä†ËΩΩÊÇ®ÁöÑ‰∏™‰∫∫‰ø°ÊÅØ...",-1)]))):((0,r.uX)(),(0,r.CE)("div",nt,[n.loadError?((0,r.uX)(),(0,r.CE)("div",lt,[t[15]||(t[15]=(0,r.Lk)("span",{class:"message-icon"},"‚ö†Ô∏è",-1)),(0,r.Lk)("span",null,(0,o.v_)(n.loadError),1),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.retryLoad&&l.retryLoad(...e)),class:"btn small"},"ÈáçËØï")])):(0,r.Q3)("",!0),n.updateSuccess?((0,r.uX)(),(0,r.CE)("div",ct,[t[16]||(t[16]=(0,r.Lk)("span",{class:"message-icon"},"‚úÖ",-1)),(0,r.Lk)("span",null,(0,o.v_)(n.updateSuccess),1)])):(0,r.Q3)("",!0),n.editMode?((0,r.uX)(),(0,r.CE)("form",{key:3,class:"edit-form",onSubmit:t[9]||(t[9]=(0,s.D$)(((...e)=>l.updateProfile&&l.updateProfile(...e)),["prevent"]))},[t[31]||(t[31]=(0,r.Lk)("h3",null,"ÁºñËæë‰∏™‰∫∫‰ø°ÊÅØ",-1)),(0,r.Lk)("div",Lt,[t[23]||(t[23]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üë§"),(0,r.eW)(" Áî®Êà∑Âêç ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>n.userInfo.username=e),placeholder:"ËØ∑ËæìÂÖ•Áî®Êà∑Âêç",required:""},null,512),[[s.Jo,n.userInfo.username]])]),(0,r.Lk)("div",wt,[t[24]||(t[24]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üìß"),(0,r.eW)(" ÈÇÆÁÆ± ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>n.userInfo.email=e),placeholder:"ËØ∑ËæìÂÖ•ÈÇÆÁÆ±",required:""},null,512),[[s.Jo,n.userInfo.email]])]),(0,r.Lk)("div",bt,[t[25]||(t[25]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üîí"),(0,r.eW)(" ÂΩìÂâçÂØÜÁ†Å ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"password","onUpdate:modelValue":t[5]||(t[5]=e=>n.currentPassword=e),placeholder:"ËØ∑ËæìÂÖ•ÂΩìÂâçÂØÜÁ†Å",required:""},null,512),[[s.Jo,n.currentPassword]])]),(0,r.Lk)("div",yt,[t[26]||(t[26]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üîë"),(0,r.eW)(" Êñ∞ÂØÜÁ†Å ")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"password","onUpdate:modelValue":t[6]||(t[6]=e=>n.newPassword=e),placeholder:"Â¶ÇÈúÄ‰øÆÊîπÂØÜÁ†ÅËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å"},null,512),[[s.Jo,n.newPassword]])]),(0,r.Lk)("div",It,[t[28]||(t[28]=(0,r.Lk)("label",null,[(0,r.Lk)("span",{class:"label-icon"},"üñºÔ∏è"),(0,r.eW)(" Â§¥ÂÉè ")],-1)),(0,r.Lk)("div",Ct,[(0,r.Lk)("input",{type:"file",onChange:t[7]||(t[7]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e)),accept:"image/*",id:"avatar-upload"},null,32),t[27]||(t[27]=(0,r.Lk)("label",{for:"avatar-upload",class:"file-upload-label"},[(0,r.Lk)("span",{class:"btn-icon"},"üì§"),(0,r.eW)(" ÈÄâÊã©ÂõæÁâá ")],-1)),n.file?((0,r.uX)(),(0,r.CE)("span",_t,(0,o.v_)(n.file.name),1)):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",At,[(0,r.Lk)("button",{type:"submit",class:"btn primary",disabled:n.loading},[t[29]||(t[29]=(0,r.Lk)("span",{class:"btn-icon"},"üíæ",-1)),(0,r.eW)(" "+(0,o.v_)(n.loading?"‰øùÂ≠ò‰∏≠...":"‰øùÂ≠ò‰øÆÊîπ"),1)],8,Et),(0,r.Lk)("button",{type:"button",class:"btn secondary",onClick:t[8]||(t[8]=(...e)=>l.cancelEdit&&l.cancelEdit(...e))},t[30]||(t[30]=[(0,r.Lk)("span",{class:"btn-icon"},"‚úñÔ∏è",-1),(0,r.eW)(" ÂèñÊ∂à ")]))])],32)):((0,r.uX)(),(0,r.CE)("div",dt,[(0,r.Lk)("div",ut,[(0,r.Lk)("div",{class:"avatar",style:(0,o.Tr)({backgroundImage:`url(${n.userInfo.avatar||"/default-avatar.png"})`})},[(0,r.Lk)("div",ht,[(0,r.Lk)("span",{class:(0,o.C4)(["role-badge",n.userInfo.role])},(0,o.v_)(l.formatRole(n.userInfo.role)),3)])],4)]),(0,r.Lk)("div",mt,[(0,r.Lk)("h2",null,(0,o.v_)(n.userInfo.username),1),(0,r.Lk)("div",pt,[t[17]||(t[17]=(0,r.Lk)("span",{class:"info-icon"},"üìß",-1)),t[18]||(t[18]=(0,r.Lk)("span",{class:"info-label"},"ÈÇÆÁÆ±Ôºö",-1)),(0,r.Lk)("span",gt,(0,o.v_)(n.userInfo.email),1)]),(0,r.Lk)("div",kt,[t[19]||(t[19]=(0,r.Lk)("span",{class:"info-icon"},"üëë",-1)),t[20]||(t[20]=(0,r.Lk)("span",{class:"info-label"},"ËßíËâ≤Ôºö",-1)),(0,r.Lk)("span",vt,(0,o.v_)(l.formatRole(n.userInfo.role)),1)])]),(0,r.Lk)("div",ft,[(0,r.Lk)("button",{class:"btn primary",onClick:t[1]||(t[1]=e=>n.editMode=!0)},t[21]||(t[21]=[(0,r.Lk)("span",{class:"btn-icon"},"‚úèÔ∏è",-1),(0,r.eW)(" ÁºñËæëËµÑÊñô ")])),(0,r.Lk)("button",{class:"btn outline-danger",onClick:t[2]||(t[2]=(...e)=>l.logout&&l.logout(...e))},t[22]||(t[22]=[(0,r.Lk)("span",{class:"btn-icon"},"üö™",-1),(0,r.eW)(" ÈÄÄÂá∫ÁôªÂΩï ")]))])]))])):((0,r.uX)(),(0,r.CE)("div",rt,[t[12]||(t[12]=(0,r.Lk)("h2",null,"Ê¨¢ËøéÊù•Âà∞Á§æÂå∫",-1)),t[13]||(t[13]=(0,r.Lk)("p",null,"ÁôªÂΩïÊàñÊ≥®ÂÜå‰ª•ÂºÄÂßãÊÇ®ÁöÑÁ§æÂå∫‰πãÊóÖ",-1)),(0,r.Lk)("div",ot,[(0,r.bF)(c,{to:"/login",class:"auth-button login-btn"},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.Lk)("span",{class:"button-icon"},"üîë",-1),(0,r.eW)(" ÁôªÂΩï ")]))),_:1}),(0,r.bF)(c,{to:"/register",class:"auth-button login-btn"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.Lk)("span",{class:"button-icon"},"‚ú®",-1),(0,r.eW)(" Ê≥®ÂÜå ")]))),_:1})])]))])])}const $t="https://api.26ywzm.icu/api/auth";var Xt={name:"UserProfile",data(){return{isLoggedIn:!!localStorage.getItem("authToken"),userInfo:{username:"",email:"",role:"",balance:0},editMode:!1,currentPassword:"",newPassword:"",file:null,loading:!1,loadError:"",updateSuccess:""}},async created(){const e=localStorage.getItem("authToken"),t=localStorage.getItem("userRole"),a=localStorage.getItem("username"),s=localStorage.getItem("email");if(e){this.userInfo={username:a||"",email:s||"",role:t||""};try{await this.fetchUserProfile()}catch(r){console.error("Failed to fetch user profile:",r),r.response&&401===r.response.status&&this.handleUnauthorized()}}else this.isLoggedIn=!1},methods:{formatRole(e){const t={super_admin:"Ë∂ÖÁ∫ßÁÆ°ÁêÜÂëò",admin:"ÁÆ°ÁêÜÂëò",user:"ÊôÆÈÄöÁî®Êà∑"};return t[e]||e},async retryLoad(){this.loadError="",await this.fetchUserProfile()},async fetchUserProfile(){this.loading=!0,this.loadError="";try{const e=localStorage.getItem("authToken");if(!e)return console.warn("No auth token found, using local storage data"),void this.useLocalStorageData();const t={method:"get",url:`${$t}/me`,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}},a=await(0,y.A)(t);if(a.data&&a.data.user)this.userInfo=a.data.user;else{if(!a.data)throw new Error("Invalid response format");this.userInfo=a.data}}catch(e){if(console.error("Error fetching user profile:",e),e.response){if(401===e.response.status)return void this.handleUnauthorized();this.loadError=`Âä†ËΩΩÂ§±Ë¥•: ${e.response.data.message||"ÊúçÂä°Âô®ÈîôËØØ"}`}else this.loadError="ÁΩëÁªúÈîôËØØÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•";this.useLocalStorageData()}finally{this.loading=!1}},useLocalStorageData(){this.userInfo={username:localStorage.getItem("username")||"",email:localStorage.getItem("email")||"",role:localStorage.getItem("userRole")||""}},handleUnauthorized(){localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),this.isLoggedIn=!1},async updateProfile(){this.loading=!0,this.updateSuccess="";try{const e=new FormData;e.append("username",this.userInfo.username),e.append("email",this.userInfo.email),this.currentPassword&&(e.append("currentPassword",this.currentPassword),this.newPassword&&e.append("newPassword",this.newPassword)),this.file&&e.append("avatar",this.file),await y.A.put(`${$t}/me`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"multipart/form-data"}}),this.updateSuccess="‰∏™‰∫∫‰ø°ÊÅØÊõ¥Êñ∞ÊàêÂäüÔºÅ",this.editMode=!1,this.currentPassword="",this.newPassword="",this.file=null,await this.fetchUserProfile()}catch(e){ne(e)}finally{this.loading=!1}},handleFileUpload(e){this.file=e.target.files[0]},goToLogin(){this.$router.push("/login")},goToRegister(){this.$router.push("/register")},async logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("email"),await this.$router.push("/login"),alert("Â∑≤ÊàêÂäüÈÄÄÂá∫ÁôªÂΩï")},cancelEdit(){this.editMode=!1,this.currentPassword="",this.newPassword="",this.file=null,this.fetchUserProfile()}}};const Ut=(0,d.A)(Xt,[["render",St],["__scopeId","data-v-36b95f51"]]);var Ft=Ut;const Tt={class:"news-detail-container"},Mt={class:"news-detail"},Vt={class:"news-content"},Dt={key:0,class:"meta-info"},zt={class:"date"},Pt={class:"views"},Rt={key:0,class:"featured-image"},Wt=["src"],xt={key:1,class:"content"};function Ot(e,t,a,s,i,n){return(0,r.uX)(),(0,r.CE)("div",Tt,[(0,r.Lk)("div",Mt,[(0,r.Lk)("div",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>n.goBack&&n.goBack(...e))},t[1]||(t[1]=[(0,r.Lk)("i",{class:"back-icon"},"‚Üê",-1),(0,r.Lk)("span",null,"ËøîÂõû",-1)])),(0,r.Lk)("article",Vt,[(0,r.Lk)("header",null,[(0,r.Lk)("h1",null,(0,o.v_)(i.news.title),1),i.news.created_at?((0,r.uX)(),(0,r.CE)("div",Dt,[(0,r.Lk)("span",zt,(0,o.v_)(n.formatDate(i.news.created_at)),1),t[2]||(t[2]=(0,r.Lk)("span",{class:"divider"},"|",-1)),(0,r.Lk)("span",Pt,"ÈòÖËØª "+(0,o.v_)(i.news.views||0),1)])):(0,r.Q3)("",!0)]),i.news.blobUrl?((0,r.uX)(),(0,r.CE)("div",Rt,[(0,r.Lk)("img",{src:i.news.blobUrl,alt:"Êñ∞ÈóªÂõæÁâá"},null,8,Wt)])):(0,r.Q3)("",!0),i.news.content?((0,r.uX)(),(0,r.CE)("div",xt,[(0,r.Lk)("p",null,(0,o.v_)(i.news.content),1)])):(0,r.Q3)("",!0)])])])}const Bt="https://api.26ywzm.icu",Qt=`${Bt}/api/auth`;var Nt={data(){return{news:{},imageCache:new Map}},mounted(){this.fetchNews()},methods:{async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=e.startsWith("/uploads/")?e:`/uploads/${e}`,a=Qt.replace("/api/auth",""),s=await fetch(`${a}${t}`),r=await s.blob(),o=URL.createObjectURL(r);return this.imageCache.set(e,o),o}catch(t){return console.error("Âä†ËΩΩÂõæÁâáÂ§±Ë¥•:",t),""}},async fetchNews(){try{const e=await y.A.get(`${Qt}/articles/${this.$route.params.id}`);this.news=e.data,await this.loadImage(this.news)}catch(e){console.error("Ëé∑ÂèñÊñ∞ÈóªËØ¶ÊÉÖÂ§±Ë¥•:",e)}},goBack(){this.$router.push("/")},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}}};const qt=(0,d.A)(Nt,[["render",Ot],["__scopeId","data-v-1654ac4c"]]);var jt=qt;const Kt={class:"article-editor"},Jt={type:"submit"},Ht={class:"articles-area"},Zt={class:"category-buttons"},Yt=["src","onError","alt"],Gt={class:"action-buttons"},ea=["onClick"],ta=["onClick"];function aa(e,t,a,i,n,l){return(0,r.uX)(),(0,r.CE)("div",Kt,[(0,r.Lk)("h2",null,(0,o.v_)(n.editingArticleId?"ÁºñËæëÊñáÁ´†":"ÁºñÂÜôÊñáÁ´†"),1),(0,r.Lk)("form",{onSubmit:t[6]||(t[6]=(0,s.D$)(((...e)=>l.submitArticle&&l.submitArticle(...e)),["prevent"]))},[(0,r.Lk)("div",null,[t[10]||(t[10]=(0,r.Lk)("label",null,"Ê†áÈ¢òÔºö",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.title=e),required:""},null,512),[[s.Jo,n.title]])]),(0,r.Lk)("div",null,[t[11]||(t[11]=(0,r.Lk)("label",null,"ÂÜÖÂÆπÔºö",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.content=e),required:""},null,512),[[s.Jo,n.content]])]),(0,r.Lk)("div",null,[t[12]||(t[12]=(0,r.Lk)("label",null,"ÂõæÁâáÈìæÊé•Ôºö",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>n.imageUrl=e)},null,512),[[s.Jo,n.imageUrl]])]),(0,r.Lk)("div",null,[t[13]||(t[13]=(0,r.Lk)("label",null,"Êàñ‰∏ä‰º†ÂõæÁâáÔºö",-1)),(0,r.Lk)("input",{type:"file",ref:"fileInput",onChange:t[3]||(t[3]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e))},null,544)]),(0,r.Lk)("div",null,[t[15]||(t[15]=(0,r.Lk)("label",null,"ÈÄâÊã©ÂèëÂ∏É‰ΩçÁΩÆÔºö",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>n.category=e),required:""},t[14]||(t[14]=[(0,r.Lk)("option",{value:"carousel"},"ËΩÆÊí≠Âõæ",-1),(0,r.Lk)("option",{value:"hotNews"},"ÁÉ≠Èó®Êñ∞Èóª",-1),(0,r.Lk)("option",{value:"newsList"},"Êñ∞ÈóªÂàóË°®",-1)]),512),[[s.u1,n.category]])]),(0,r.Lk)("button",Jt,(0,o.v_)(n.editingArticleId?"‰øùÂ≠ò‰øÆÊîπ":"ÂèëÂ∏ÉÊñáÁ´†"),1),n.editingArticleId?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"button",onClick:t[5]||(t[5]=(...e)=>l.cancelEdit&&l.cancelEdit(...e))},"ÂèñÊ∂àÁºñËæë")):(0,r.Q3)("",!0)],32),(0,r.Lk)("div",Ht,[(0,r.Lk)("div",Zt,[(0,r.Lk)("button",{onClick:t[7]||(t[7]=e=>l.loadArticles("carousel"))},"ËΩÆÊí≠Âõæ"),(0,r.Lk)("button",{onClick:t[8]||(t[8]=e=>l.loadArticles("hotNews"))},"ÁÉ≠Èó®Êñ∞Èóª"),(0,r.Lk)("button",{onClick:t[9]||(t[9]=e=>l.loadArticles("newsList"))},"Êñ∞ÈóªÂàóË°®")]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.articles,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"article"},[(0,r.Lk)("h3",null,(0,o.v_)(e.title),1),e.image_url?((0,r.uX)(),(0,r.CE)("img",{key:0,src:e.blobUrl||"",onError:t=>l.loadImage(e),alt:e.title,class:"article-image"},null,40,Yt)):(0,r.Q3)("",!0),(0,r.Lk)("p",null,(0,o.v_)(e.content),1),(0,r.Lk)("div",Gt,[(0,r.Lk)("button",{class:"edit",onClick:t=>l.editArticle(e)},"‰øÆÊîπ",8,ea),(0,r.Lk)("button",{onClick:t=>l.deleteArticle(e.id)},"Âà†Èô§",8,ta)])])))),128))])])}const sa={methods:{checkAdminAuth(){const e=localStorage.getItem("userRole");return"admin"===e||"super_admin"===e||(this.$router.push("/"),!1)}},beforeMount(){this.checkAdminAuth()},beforeRouteEnter(e,t,a){const s=localStorage.getItem("userRole");"admin"!==s&&"super_admin"!==s?a("/"):a()}},ra="https://api.26ywzm.icu/api/auth";var oa={name:"ArticleEditor",mixins:[sa],data(){return{title:"",content:"",imageUrl:"",category:"newsList",imageFile:null,editingArticleId:null,articles:[],imageCache:new Map}},methods:{async fetchArticles(e){if(this.checkAdminAuth())try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=await y.A.get(`${ra}/articles${e?`?category=${e}`:""}`,{headers:a});this.articles=s.data;for(const e of this.articles)await this.loadImage(e)}catch(t){console.error("Ëé∑ÂèñÊñáÁ´†Â§±Ë¥•:",t)}},async loadArticles(e){this.category=e,await this.fetchArticles(e)},handleFileUpload(e){this.imageFile=e.target.files[0]},async submitArticle(){if(this.checkAdminAuth())try{const e=new FormData;e.append("title",this.title),e.append("content",this.content),e.append("category",this.category),e.append("image_url",this.imageUrl),this.imageFile&&e.append("image",this.imageFile);const t=localStorage.getItem("authToken"),a={"Content-Type":"multipart/form-data",Authorization:`Bearer ${t}`};this.editingArticleId?(await y.A.put(`${ra}/articles/${this.editingArticleId}`,e,{headers:a}),alert("ÊñáÁ´†‰øÆÊîπÊàêÂäü")):(await y.A.post(`${ra}/articles`,e,{headers:a}),alert("ÊñáÁ´†ÂèëÂ∏ÉÊàêÂäü")),this.resetForm(),this.fetchArticles()}catch(e){console.error("Êèê‰∫§ÊñáÁ´†Â§±Ë¥•:",e),alert("Êèê‰∫§Â§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ")}},editArticle(e){this.checkAdminAuth()&&(this.title=e.title,this.content=e.content,this.imageUrl=e.image_url,this.category=e.category,this.editingArticleId=e.id)},async deleteArticle(e){if(this.checkAdminAuth()&&confirm("Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÁØáÊñáÁ´†ÂêóÔºü"))try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`};await y.A.delete(`${ra}/articles/${e}`,{headers:a}),this.fetchArticles()}catch(t){console.error("Âà†Èô§ÊñáÁ´†Â§±Ë¥•:",t),alert("Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ")}},resetForm(){this.title="",this.content="",this.imageUrl="",this.imageFile=null,this.category="newsList",this.editingArticleId=null,this.$refs.fileInput.value=""},cancelEdit(){this.resetForm()},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=e.startsWith("/uploads/")?e:`/uploads/${e}`,r="https://api.26ywzm.icu",o=await fetch(`${r}${s}`,{headers:a}),i=await o.blob(),n=URL.createObjectURL(i);return this.imageCache.set(e,n),n}catch(t){return console.error("Âä†ËΩΩÂõæÁâáÂ§±Ë¥•:",t),""}},async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))}},mounted(){this.checkAdminAuth()?this.fetchArticles():this.$router.push("/")}};const ia=(0,d.A)(oa,[["render",aa],["__scopeId","data-v-edaed63c"]]);var na=ia;const la={class:"canteen-order"},ca={key:0,class:"menu-list"},da=["src","onError"],ua={class:"menu-item-info"},ha={class:"description"},ma={class:"price"},pa={class:"quantity-controls"},ga=["onClick"],ka=["onClick"],va=["onClick"],fa={key:1},La={key:2,class:"cart"},wa=["onClick"],ba={class:"cart-footer"},ya={key:3};function Ia(e,t,a,s,i,n){return(0,r.uX)(),(0,r.CE)("div",la,[t[4]||(t[4]=(0,r.Lk)("h2",null,"Á§æÂå∫È£üÂ†Ç",-1)),i.menuItems.length>0?((0,r.uX)(),(0,r.CE)("div",ca,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.menuItems,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"menu-item"},[e.image_url?((0,r.uX)(),(0,r.CE)("img",{key:0,src:e.blobUrl||"",onError:t=>n.loadImage(e),alt:"ËèúÂìÅÂõæÁâá"},null,40,da)):(0,r.Q3)("",!0),(0,r.Lk)("div",ua,[(0,r.Lk)("h3",null,(0,o.v_)(e.name),1),(0,r.Lk)("p",ha,(0,o.v_)(e.description),1),(0,r.Lk)("p",ma,"¬•"+(0,o.v_)(e.price),1),(0,r.Lk)("div",pa,[(0,r.Lk)("button",{onClick:t=>n.decrementQuantity(e)},"-",8,ga),(0,r.Lk)("span",null,(0,o.v_)(e.quantity),1),(0,r.Lk)("button",{onClick:t=>n.incrementQuantity(e)},"+",8,ka)]),(0,r.Lk)("button",{onClick:t=>n.addToCart(e),class:"add-to-cart"},"Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶",8,va)])])))),128))])):((0,r.uX)(),(0,r.CE)("div",fa,t[1]||(t[1]=[(0,r.Lk)("p",null,"ÁõÆÂâçÊ≤°ÊúâÂèØÁî®ÁöÑËèúÂìÅ„ÄÇ",-1)]))),i.cart.length>0?((0,r.uX)(),(0,r.CE)("div",La,[t[2]||(t[2]=(0,r.Lk)("h3",null,"Ë¥≠Áâ©ËΩ¶",-1)),(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.cart,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"cart-item"},[(0,r.Lk)("span",null,(0,o.v_)(e.name)+" ("+(0,o.v_)(e.quantity)+"): "+(0,o.v_)(e.price*e.quantity)+" ÂÖÉ",1),(0,r.Lk)("button",{onClick:e=>n.removeFromCart(t),class:"remove-btn"},"Âà†Èô§",8,wa)])))),128))]),(0,r.Lk)("div",ba,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.checkout&&n.checkout(...e)),class:"checkout-btn"},"ÁªìË¥¶")])])):((0,r.uX)(),(0,r.CE)("div",ya,t[3]||(t[3]=[(0,r.Lk)("p",null,"Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫„ÄÇ",-1)])))])}const Ca="https://api.26ywzm.icu";var _a={data(){return{menuItems:[],cart:[],imageCache:new Map}},async mounted(){await this.fetchMenuItems()},methods:{async fetchMenuItems(){try{const e=await y.A.get(`${Ca}/api/auth/canteen/menu`);this.menuItems=e.data.map((e=>({...e,quantity:1})));for(const t of this.menuItems)await this.loadImage(t)}catch(e){console.error("Ëé∑ÂèñËèúÂçïÂ§±Ë¥•:",e)}},async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},addToCart(e){const t=this.cart.find((t=>t.id===e.id));t?t.quantity+=e.quantity:this.cart.push({...e}),e.quantity=1,alert(`${e.name} Â∑≤Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶ÔºÅ`)},removeFromCart(e){this.cart.splice(e,1),alert("ËèúÂìÅÂ∑≤‰ªéË¥≠Áâ©ËΩ¶‰∏≠Âà†Èô§ÔºÅ")},async checkout(){const e=this.cart.map((e=>({menuItemId:e.id,quantity:e.quantity,price:e.price})));if(0!==e.length)try{console.log("Orders being sent:",e);const t=await y.A.post(`${Ca}/api/auth/canteen/order`,{items:e},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});alert(t.data.message||"ÁªìË¥¶ÊàêÂäüÔºÅ"),this.$router.push(`/order/${t.data.orderId}`)}catch(t){console.error("ÁªìË¥¶Â§±Ë¥•:",t),alert("ÁªìË¥¶Â§±Ë¥•ÔºåËØ∑ÈáçËØï„ÄÇ")}else alert("ËØ∑Ëá≥Â∞ëÈÄâÊã©‰∏ÄÈ°πËèúÂìÅÔºÅ")},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=e.startsWith("/uploads/")?e:`/uploads/${e}`,r="https://api.26ywzm.icu",o=await fetch(`${r}${s}`,{headers:a}),i=await o.blob(),n=URL.createObjectURL(i);return this.imageCache.set(e,n),n}catch(t){return console.error("Âä†ËΩΩÂõæÁâáÂ§±Ë¥•:",t),""}},decrementQuantity(e){e.quantity>1&&e.quantity--},incrementQuantity(e){e.quantity++}}};const Aa=(0,d.A)(_a,[["render",Ia],["__scopeId","data-v-66968b6e"]]);var Ea=Aa;const Sa={class:"canteen-admin"},$a={class:"form-container"},Xa={class:"form-group"},Ua={class:"form-group"},Fa={class:"form-group"},Ta={class:"form-group"},Ma={class:"form-group"},Va={class:"form-actions"},Da={type:"submit",class:"submit-btn"},za={key:0,class:"menu-list"},Pa=["src","onError"],Ra={class:"menu-item-info"},Wa={class:"price"},xa={class:"description"},Oa={class:"menu-item-actions"},Ba=["onClick"],Qa=["onClick"],Na={key:1};function qa(e,t,a,i,n,l){return(0,r.uX)(),(0,r.CE)("div",Sa,[t[13]||(t[13]=(0,r.Lk)("h2",null,"È£üÂ†ÇÁÆ°ÁêÜ",-1)),(0,r.Lk)("div",$a,[(0,r.Lk)("h3",null,(0,o.v_)(n.isEditing?"ÁºñËæëËèúÂìÅ":"Ê∑ªÂä†Êñ∞ËèúÂìÅ"),1),(0,r.Lk)("form",{onSubmit:t[6]||(t[6]=(0,s.D$)((e=>n.isEditing?l.updateMenuItem():l.addMenuItem()),["prevent"])),class:"form"},[(0,r.Lk)("div",Xa,[t[7]||(t[7]=(0,r.Lk)("label",{for:"name"},"ËèúÂìÅÂêçÁß∞",-1)),(0,r.bo)((0,r.Lk)("input",{id:"name",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>n.newItem.name=e),required:"",placeholder:"ËæìÂÖ•ËèúÂìÅÂêçÁß∞"},null,512),[[s.Jo,n.newItem.name]])]),(0,r.Lk)("div",Ua,[t[8]||(t[8]=(0,r.Lk)("label",{for:"price"},"‰ª∑Ê†º",-1)),(0,r.bo)((0,r.Lk)("input",{id:"price",type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>n.newItem.price=e),required:"",placeholder:"ËæìÂÖ•ËèúÂìÅ‰ª∑Ê†º"},null,512),[[s.Jo,n.newItem.price]])]),(0,r.Lk)("div",Fa,[t[9]||(t[9]=(0,r.Lk)("label",{for:"image-url"},"ÂõæÁâáÈìæÊé•",-1)),(0,r.bo)((0,r.Lk)("input",{id:"image-url",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>n.newItem.image_url=e),placeholder:"ËæìÂÖ•ÂõæÁâáURL"},null,512),[[s.Jo,n.newItem.image_url]])]),(0,r.Lk)("div",Ta,[t[10]||(t[10]=(0,r.Lk)("label",null,"Êàñ‰∏ä‰º†ÂõæÁâá",-1)),(0,r.Lk)("input",{type:"file",onChange:t[3]||(t[3]=(...e)=>l.handleFileUpload&&l.handleFileUpload(...e)),ref:"fileInput"},null,544)]),(0,r.Lk)("div",Ma,[t[11]||(t[11]=(0,r.Lk)("label",{for:"description"},"ÊèèËø∞",-1)),(0,r.bo)((0,r.Lk)("textarea",{id:"description","onUpdate:modelValue":t[4]||(t[4]=e=>n.newItem.description=e),placeholder:"ËæìÂÖ•ËèúÂìÅÊèèËø∞"},null,512),[[s.Jo,n.newItem.description]])]),(0,r.Lk)("div",Va,[(0,r.Lk)("button",Da,(0,o.v_)(n.isEditing?"Êõ¥Êñ∞ËèúÂìÅ":"Ê∑ªÂä†ËèúÂìÅ"),1),n.isEditing?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"button",onClick:t[5]||(t[5]=(...e)=>l.cancelEdit&&l.cancelEdit(...e)),class:"cancel-btn"},"ÂèñÊ∂à")):(0,r.Q3)("",!0)])],32)]),t[14]||(t[14]=(0,r.Lk)("h3",null,"ËèúÂìÅÂàóË°®",-1)),n.menuItems.length>0?((0,r.uX)(),(0,r.CE)("div",za,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.menuItems,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"menu-item"},[e.image_url?((0,r.uX)(),(0,r.CE)("img",{key:0,src:e.blobUrl||"",onError:t=>l.loadImage(e),alt:"ËèúÂìÅÂõæÁâá"},null,40,Pa)):(0,r.Q3)("",!0),(0,r.Lk)("div",Ra,[(0,r.Lk)("h4",null,(0,o.v_)(e.name),1),(0,r.Lk)("p",Wa,"‰ª∑Ê†º: "+(0,o.v_)(e.price)+" ÂÖÉ",1),(0,r.Lk)("p",xa,(0,o.v_)(e.description),1)]),(0,r.Lk)("div",Oa,[(0,r.Lk)("button",{onClick:t=>l.deleteMenuItem(e.id),class:"delete-btn"},"Âà†Èô§",8,Ba),(0,r.Lk)("button",{onClick:t=>l.editMenuItem(e),class:"edit-btn"},"ÁºñËæë",8,Qa)])])))),128))])):((0,r.uX)(),(0,r.CE)("div",Na,t[12]||(t[12]=[(0,r.Lk)("p",null,"ÁõÆÂâçÊ≤°ÊúâÂèØÁî®ÁöÑËèúÂìÅ„ÄÇ",-1)])))])}const ja="https://api.26ywzm.icu/api/auth";var Ka={data(){return{menuItems:[],newItem:{name:"",price:"",image_url:"",description:""},imageFile:null,isEditing:!1,imageCache:new Map}},mounted(){this.fetchMenuItems()},methods:{handleFileUpload(e){const t=e.target.files[0];if(t)return t.type.startsWith("image/")?void(this.imageFile=t):(alert("ËØ∑‰∏ä‰º†ÂõæÁâáÊñá‰ª∂"),void(this.$refs.fileInput.value=""))},async fetchMenuItems(){try{const e=await y.A.get(`${ja}/canteen/menu`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});this.menuItems=e.data;for(const t of this.menuItems)await this.loadImage(t)}catch(e){ne(e)}},async addMenuItem(){const e=new FormData;e.append("name",this.newItem.name),e.append("price",this.newItem.price),e.append("image_url",this.newItem.image_url),e.append("description",this.newItem.description),this.imageFile&&e.append("image",this.imageFile);try{await y.A.post(`${ja}/canteen/menu`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"multipart/form-data"},withCredentials:!0}),this.fetchMenuItems(),this.resetForm()}catch(t){console.error("Ê∑ªÂä†ËèúÂìÅÂ§±Ë¥•:",t),alert("Ê∑ªÂä†ËèúÂìÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}},async deleteMenuItem(e){try{await y.A.delete(`${ja}/canteen/menu/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),this.fetchMenuItems()}catch(t){ne(t,{suppressAuthError:!0,customErrorHandler:()=>{alert("Âà†Èô§ËèúÂìÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}})}},editMenuItem(e){this.newItem={...e},this.isEditing=!0},async updateMenuItem(){const e=new FormData;e.append("name",this.newItem.name),e.append("price",this.newItem.price),e.append("image_url",this.newItem.image_url),e.append("description",this.newItem.description),this.imageFile&&e.append("image",this.imageFile);try{await y.A.put(`${ja}/canteen/menu/${this.newItem.id}`,e,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"multipart/form-data"}}),this.fetchMenuItems(),this.resetForm()}catch(t){ne(t,{suppressAuthError:!0,customErrorHandler:()=>{alert("Êõ¥Êñ∞ËèúÂìÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}})}},cancelEdit(){this.resetForm()},resetForm(){this.isEditing=!1,this.newItem={name:"",price:"",image_url:"",description:""},this.imageFile=null,this.$refs.fileInput.value=""},async loadImage(e){e.image_url&&(e.blobUrl=await this.getImageUrl(e.image_url))},async getImageUrl(e){if(!e)return"";if(e.startsWith("http"))return e;if(this.imageCache.has(e))return this.imageCache.get(e);try{const t=localStorage.getItem("authToken"),a={Authorization:`Bearer ${t}`},s=e.startsWith("/uploads/")?e:`/uploads/${e}`,r="https://api.26ywzm.icu",o=await fetch(`${r}${s}`,{headers:a}),i=await o.blob(),n=URL.createObjectURL(i);return this.imageCache.set(e,n),n}catch(t){return console.error("Âä†ËΩΩÂõæÁâáÂ§±Ë¥•:",t),""}}}};const Ja=(0,d.A)(Ka,[["render",qa],["__scopeId","data-v-5fef34c2"]]);var Ha=Ja;const Za={class:"order-detail"},Ya={class:"card-header"},Ga={key:0,class:"order-content"},es={class:"info-list"},ts={class:"info-item"},as={class:"info-item"},ss={class:"info-item"},rs={class:"info-item"},os={class:"info-item"},is={class:"price"},ns={key:0,class:"order-items"},ls={class:"items-list"},cs={class:"item-name"},ds={class:"item-info"},us={class:"subtotal"},hs={key:1,class:"loading-wrapper"};function ms(e,t,a,s,i,n){const l=(0,r.g2)("el-page-header"),c=(0,r.g2)("el-tag"),d=(0,r.g2)("el-empty"),u=(0,r.g2)("el-card");return(0,r.uX)(),(0,r.CE)("div",Za,[(0,r.bF)(u,null,{header:(0,r.k6)((()=>[(0,r.Lk)("div",Ya,[(0,r.bF)(l,{onBack:n.goBack,title:"ËøîÂõû",content:"ËÆ¢ÂçïËØ¶ÊÉÖ"},null,8,["onBack"])])])),default:(0,r.k6)((()=>[i.order?((0,r.uX)(),(0,r.CE)("div",Ga,[(0,r.Lk)("div",es,[(0,r.Lk)("div",ts,"ËÆ¢ÂçïÁºñÂè∑Ôºö"+(0,o.v_)(i.order.id),1),(0,r.Lk)("div",as,"Áî®Êà∑ÂêçÔºö"+(0,o.v_)(i.order.username),1),(0,r.Lk)("div",ss,"ÈÇÆÁÆ±Ôºö"+(0,o.v_)(i.order.email),1),(0,r.Lk)("div",rs,[t[0]||(t[0]=(0,r.eW)(" ËÆ¢ÂçïÁä∂ÊÄÅÔºö ")),(0,r.bF)(c,{type:n.getStatusType(i.order.status)},{default:(0,r.k6)((()=>[(0,r.eW)((0,o.v_)(i.statusText[i.order.status]||"Êú™Áü•Áä∂ÊÄÅ"),1)])),_:1},8,["type"])]),(0,r.Lk)("div",os,[t[1]||(t[1]=(0,r.eW)("ÊÄª‰ª∑Ê†ºÔºö")),(0,r.Lk)("span",is,"¬•"+(0,o.v_)(i.order.total_price),1)])]),i.order.items&&i.order.items.length?((0,r.uX)(),(0,r.CE)("div",ns,[t[2]||(t[2]=(0,r.Lk)("h3",null,"ËÆ¢ÂçïÂïÜÂìÅ",-1)),(0,r.Lk)("div",ls,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.order.items,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.menu_item_id,class:"item"},[(0,r.Lk)("div",cs,(0,o.v_)(e.name),1),(0,r.Lk)("div",ds,[(0,r.Lk)("span",null,"Êï∞ÈáèÔºö"+(0,o.v_)(e.quantity),1),(0,r.Lk)("span",null,"Âçï‰ª∑Ôºö¬•"+(0,o.v_)(e.price),1),(0,r.Lk)("span",us,"Â∞èËÆ°Ôºö¬•"+(0,o.v_)((e.quantity*e.price).toFixed(2)),1)])])))),128))])])):(0,r.Q3)("",!0)])):i.loading?((0,r.uX)(),(0,r.CE)("div",hs,[(0,r.bF)(d,{description:"Ê≠£Âú®Âä†ËΩΩËÆ¢Âçï‰ø°ÊÅØ..."})])):(0,r.Q3)("",!0)])),_:1})])}const ps="https://api.26ywzm.icu/api/auth";var gs={name:"OrderDetail",data(){return{order:null,loading:!0,statusText:{0:"ÂæÖÂ§ÑÁêÜ",1:"Â§ÑÁêÜ‰∏≠",2:"Â∑≤ÂÆåÊàê",3:"Â∑≤ÂèñÊ∂à"}}},async created(){await this.fetchOrderDetails()},methods:{getStatusType(e){const t={0:"info",1:"warning",2:"success",3:"danger"};return t[e]||"info"},async fetchOrderDetails(){const e=this.$route.params.orderId;try{const t=await y.A.get(`${ps}/canteen/order/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),a=t.data;a&&a.user?this.order={...a,email:a.user.email,username:a.user.username}:this.order=a,this.loading=!1}catch(t){console.error("Ëé∑ÂèñËÆ¢ÂçïËØ¶ÊÉÖÂ§±Ë¥•:",t),ne(t)}},formatDate(e){if(!e)return"ÊöÇÊó†Êó•Êúü";try{const t=new Date(e);if(isNaN(t.getTime()))return"Êó†ÊïàÊó•Êúü";const a={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1};return t.toLocaleString("zh-CN",a).replace(/\//g,"-")}catch(t){return console.error("Êó•ÊúüÊ†ºÂºèÂåñÈîôËØØ:",t),"Êó•ÊúüÊ†ºÂºèÈîôËØØ"}},goBack(){this.$router.push("/discover")}}};const ks=(0,d.A)(gs,[["render",ms],["__scopeId","data-v-7725f797"]]);var vs=ks;const fs={class:"order-management"},Ls={key:0,class:"loading"},ws={key:1},bs={class:"order-cards"},ys={class:"order-info"},Is={class:"user-info"},Cs={class:"email"},_s={class:"order-items"},As={class:"item-name"},Es={class:"item-details"},Ss={class:"price"},$s={class:"status"},Xs={class:"time-info"},Us={class:"time"},Fs={class:"order-actions"},Ts=["onClick"],Ms=["onClick"],Vs=["onClick"],Ds={key:2},zs={key:3,class:"dialog-overlay"},Ps={class:"dialog"};function Rs(e,t,a,s,i,n){return(0,r.uX)(),(0,r.CE)("div",fs,[t[2]||(t[2]=(0,r.Lk)("h2",null,"ËÆ¢ÂçïÁÆ°ÁêÜ",-1)),i.loading?((0,r.uX)(),(0,r.CE)("div",Ls,"Âä†ËΩΩ‰∏≠...")):((0,r.uX)(),(0,r.CE)("div",ws,[(0,r.Lk)("div",bs,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.orders,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"order-card"},[(0,r.Lk)("h3",null,"ËÆ¢ÂçïID: "+(0,o.v_)(e.id),1),(0,r.Lk)("div",ys,[(0,r.Lk)("div",Is,[(0,r.Lk)("div",null,(0,o.v_)(e.username),1),(0,r.Lk)("div",Cs,(0,o.v_)(e.email),1)]),(0,r.Lk)("div",_s,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.items,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.menu_item_id,class:"order-item"},[(0,r.Lk)("span",As,(0,o.v_)(e.name),1),(0,r.Lk)("div",Es,[(0,r.Lk)("span",null,"Êï∞Èáè: "+(0,o.v_)(e.quantity),1),(0,r.Lk)("span",null,"Âçï‰ª∑: ¬•"+(0,o.v_)(e.price),1),(0,r.Lk)("span",null,"Â∞èËÆ°: ¬•"+(0,o.v_)(e.quantity*e.price),1)])])))),128))]),(0,r.Lk)("div",Ss,"ÊÄª‰ª∑: ¬•"+(0,o.v_)(e.total_price),1),(0,r.Lk)("div",$s,[(0,r.Lk)("span",{class:(0,o.C4)(["status-tag","status-"+e.status])},(0,o.v_)(i.statusText[e.status]),3)]),(0,r.Lk)("div",Xs,[(0,r.Lk)("div",null,(0,o.v_)(n.formatDate(e.created_at).date),1),(0,r.Lk)("div",Us,(0,o.v_)(n.formatDate(e.created_at).time),1)]),(0,r.Lk)("div",Fs,[0===parseInt(e.status)?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn-confirm",onClick:t=>n.handleButtonClick(e)},"ÂºÄÂßãÂ§ÑÁêÜ",8,Ts)):(0,r.Q3)("",!0),1===parseInt(e.status)?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn-complete",onClick:t=>n.handleButtonClick(e)},"ÂÆåÊàêËÆ¢Âçï",8,Ms)):(0,r.Q3)("",!0),2===parseInt(e.status)?((0,r.uX)(),(0,r.CE)("button",{key:2,class:"btn-delete",onClick:t=>n.handleDeleteOrder(e)},"Âà†Èô§ËÆ¢Âçï",8,Vs)):(0,r.Q3)("",!0)])])])))),128))])])),0!==i.orders.length||i.loading?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Ds,t[1]||(t[1]=[(0,r.Lk)("p",{class:"empty-message"},"Ê≤°ÊúâÊâæÂà∞ËÆ¢Âçï„ÄÇ",-1)]))),i.showDialog?((0,r.uX)(),(0,r.CE)("div",zs,[(0,r.Lk)("div",Ps,[(0,r.Lk)("p",null,(0,o.v_)(i.dialogMessage),1),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.closeDialog&&n.closeDialog(...e))},"Á°ÆÂÆö")])])):(0,r.Q3)("",!0)])}const Ws="https://api.26ywzm.icu/api/auth";console.log("Current API_URL:",Ws);var xs={created(){window.caches&&caches.keys().then((e=>{e.forEach((e=>{caches.delete(e)}))}))},data(){return{orders:[],showDialog:!1,dialogMessage:"",lastActionTime:0,loading:!1,statusText:{0:"ÂæÖÂ§ÑÁêÜ",1:"Â§ÑÁêÜ‰∏≠",2:"Â∑≤ÂÆåÊàê",3:"Â∑≤ÂèñÊ∂à"}}},async mounted(){await this.fetchOrders()},methods:{async fetchOrders(){try{this.loading=!0;const e=localStorage.getItem("authToken");if(!e)return void Ze.nk.error("ËØ∑ÂÖàÁôªÂΩï");const t=(new Date).getTime(),a=await y.A.get(`${Ws}/canteen/orders?_t=${t}`,{headers:{Authorization:`Bearer ${e}`}});a.data.orders&&(this.orders=a.data.orders.map((e=>({...e,lastActionTime:0,items:e.items||[]}))))}catch(e){console.error("Ëé∑ÂèñËÆ¢ÂçïÂàóË°®Â§±Ë¥•:",e),403===e.response?.status?Ze.nk.error("Ê≤°ÊúâÊùÉÈôêËÆøÈóÆËÆ¢ÂçïÂàóË°®"):Ze.nk.error(e.response?.data?.message||"Ëé∑ÂèñËÆ¢ÂçïÂàóË°®Â§±Ë¥•")}finally{this.loading=!1}},async handleButtonClick(e){if(this.canPerformAction(e))try{let t;const a=parseInt(e.status);switch(a){case 0:t=1;break;case 1:t=2;break;default:return void Ze.nk.error(`ÂΩìÂâçÁä∂ÊÄÅ ${this.statusText[e.status]} Êó†Ê≥ïËøõË°åÊìç‰Ωú`)}await this.updateOrderStatus(e,t),await this.fetchOrders()}catch(t){console.error("Êìç‰ΩúÂ§±Ë¥•:",t),Ze.nk.error("Êìç‰ΩúÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}else Ze.nk.warning("Êìç‰ΩúÂ§™È¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï")},canPerformAction(e){const t=Date.now();return!e.lastActionTime||t-e.lastActionTime>3e3},async updateOrderStatus(e,t){try{console.log("Updating order status:",{orderId:e.id,status:t}),await y.A.put(`${Ws}/canteen/orders/${e.id}`,{status:t},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}}),Ze.nk.success(`ËÆ¢ÂçïÁä∂ÊÄÅÂ∑≤Êõ¥Êñ∞‰∏∫${this.statusText[t]}`),e.lastActionTime=Date.now(),e.status=t}catch(a){throw console.error("Êõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅÂ§±Ë¥•:",a),Ze.nk.error(a.response?.data?.message||"Êõ¥Êñ∞ËÆ¢ÂçïÁä∂ÊÄÅÂ§±Ë¥•ÔºåËØ∑ÈáçËØï"),a}},async handleDeleteOrder(e){try{if(!confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËÆ¢ÂçïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ"))return;await y.A.delete(`${Ws}/canteen/orders/${e.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("ËÆ¢ÂçïÂ∑≤Âà†Èô§"),this.orders=this.orders.filter((t=>t.id!==e.id))}catch(t){console.error("Âà†Èô§ËÆ¢ÂçïÂ§±Ë¥•:",t),Ze.nk.error(t.response?.data?.message||"Âà†Èô§ËÆ¢ÂçïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}},closeDialog(){this.showDialog=!1,this.dialogMessage=""},formatDate(e){const t=new Date(e);return{date:t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),time:t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}}}};const Os=(0,d.A)(xs,[["render",Rs],["__scopeId","data-v-981a3414"]]);var Bs=Os;const Qs={class:"submit-feedback"},Ns={key:0,class:"feedback-history"},qs={class:"feedback-header"},js={class:"feedback-time"},Ks=["onClick"],Js={class:"feedback-content"},Hs={key:0,class:"admin-reply"},Zs={key:1,class:"submit-success"};function Ys(e,t,a,i,n,l){return(0,r.uX)(),(0,r.CE)("div",Qs,[t[6]||(t[6]=(0,r.Lk)("h2",null,"Êèê‰∫§ÊÇ®ÁöÑÂª∫ËÆÆÊàñÁïôË®Ä",-1)),n.feedbacks.length>0?((0,r.uX)(),(0,r.CE)("div",Ns,[t[4]||(t[4]=(0,r.Lk)("h3",null,"ÊàëÁöÑÁïôË®ÄÂéÜÂè≤",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.feedbacks,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"feedback-item"},[(0,r.Lk)("div",qs,[(0,r.Lk)("span",js,(0,o.v_)(l.formatTime(e.created_at)),1),(0,r.Lk)("button",{class:"delete-btn",onClick:t=>l.deleteFeedback(e)},"Âà†Èô§",8,Ks)]),(0,r.Lk)("div",Js,[(0,r.Lk)("p",null,[t[2]||(t[2]=(0,r.Lk)("strong",null,"ÁïôË®ÄÔºö",-1)),(0,r.eW)((0,o.v_)(e.message),1)]),e.admin_reply?((0,r.uX)(),(0,r.CE)("p",Hs,[t[3]||(t[3]=(0,r.Lk)("strong",null,"ÁÆ°ÁêÜÂëòÂõûÂ§çÔºö",-1)),(0,r.eW)((0,o.v_)(e.admin_reply),1)])):(0,r.Q3)("",!0)])])))),128))])):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.feedbackMessage=e),placeholder:"ËØ∑Â°´ÂÜôÊÇ®ÁöÑÁïôË®Ä",rows:"4",required:""},null,512),[[s.Jo,n.feedbackMessage]]),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.submitFeedback&&l.submitFeedback(...e))},"Êèê‰∫§ÁïôË®Ä"),n.feedbackSubmitted?((0,r.uX)(),(0,r.CE)("div",Zs,t[5]||(t[5]=[(0,r.Lk)("p",null,"ÁïôË®ÄÊèê‰∫§ÊàêÂäüÔºÅ",-1)]))):(0,r.Q3)("",!0)])}const Gs="https://api.26ywzm.icu";var er={data(){return{feedbackMessage:"",feedbacks:[],feedbackSubmitted:!1,message:{show:!1,content:"",type:""}}},mounted(){this.loadFeedbacks()},methods:{getAuthHeaders(){const e=localStorage.getItem("authToken");return e?{Authorization:`Bearer ${e}`}:{}},async loadFeedbacks(){const e=localStorage.getItem("userId"),t=localStorage.getItem("authToken");if(e&&t)try{const t=await y.A.get(`${Gs}/api/canteen/feedbacks`,{params:{user_id:e},headers:this.getAuthHeaders()});this.feedbacks=t.data.feedbacks}catch(a){console.error("Âä†ËΩΩÁïôË®ÄÂéÜÂè≤Â§±Ë¥•:",a),this.showMessage("Âä†ËΩΩÁïôË®ÄÂéÜÂè≤Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else this.showMessage("ËØ∑ÂÖàÁôªÂΩï","error")},async submitFeedback(){const e=localStorage.getItem("userId"),t=localStorage.getItem("authToken");if(e&&t)if(this.feedbackMessage.trim())try{await y.A.post(`${Gs}/api/canteen/feedback`,{user_id:e,message:this.feedbackMessage},{headers:this.getAuthHeaders()}),this.showMessage("ÁïôË®ÄÊèê‰∫§ÊàêÂäü"),this.feedbackMessage="",this.feedbackSubmitted=!0,setTimeout((()=>{this.feedbackSubmitted=!1}),2e3),await this.loadFeedbacks()}catch(a){console.error("Êèê‰∫§ÁïôË®ÄÂ§±Ë¥•:",a),this.showMessage("Êèê‰∫§ÁïôË®ÄÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else this.showMessage("ÁïôË®ÄÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫","error");else this.showMessage("ËØ∑ÂÖàÁôªÂΩï","error")},async deleteFeedback(e){if(!confirm("Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ÁïôË®ÄÂêóÔºü"))return;const t=localStorage.getItem("userId"),a=localStorage.getItem("authToken");if(t&&a)try{await y.A.delete(`${Gs}/api/canteen/feedback/${e.id}`,{headers:this.getAuthHeaders(),data:{user_id:t,is_admin:"admin"===localStorage.getItem("userRole")}}),this.showMessage("ÁïôË®ÄÂ∑≤Âà†Èô§"),await this.loadFeedbacks()}catch(s){console.error("Âà†Èô§ÁïôË®ÄÂ§±Ë¥•:",s),this.showMessage(s.response?.data?.message||"Âà†Èô§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï","error")}else this.showMessage("ËØ∑ÂÖàÁôªÂΩï","error")},showMessage(e,t="success"){this.message={show:!0,content:e,type:t},setTimeout((()=>{this.message.show=!1}),3e3)},formatTime(e){return new Date(e).toLocaleString()}}};const tr=(0,d.A)(er,[["render",Ys],["__scopeId","data-v-c6c4b518"]]);var ar=tr;const sr={class:"chat-container"},rr={class:"user-list"},or={key:0,class:"loading"},ir={key:1,class:"no-users"},nr={key:2},lr=["onClick"],cr={class:"username"},dr={key:0,class:"message-count"},ur={class:"chat-box"},hr={key:0,class:"no-selection"},mr={class:"messages"},pr={key:0,class:"loading"},gr={key:1,class:"no-messages"},kr={class:"message-header"},vr={class:"username"},fr={class:"message-actions"},Lr=["onClick"],wr=["onClick"],br={class:"message-content"},yr={key:0,class:"message-reply"},Ir={class:"timestamp"},Cr={class:"reply-area"},_r={key:0,class:"selected-message"},Ar={class:"input-area"},Er=["placeholder"],Sr=["disabled"];function $r(e,t,a,i,n,l){return(0,r.uX)(),(0,r.CE)("div",sr,[(0,r.Lk)("div",rr,[t[3]||(t[3]=(0,r.Lk)("h3",null,"Áî®Êà∑ÂàóË°®",-1)),n.loading?((0,r.uX)(),(0,r.CE)("div",or,"Âä†ËΩΩ‰∏≠...")):0===n.users.length?((0,r.uX)(),(0,r.CE)("div",ir,"ÊöÇÊó†Áî®Êà∑Êï∞ÊçÆ")):((0,r.uX)(),(0,r.CE)("ul",nr,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.users,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,onClick:t=>l.selectUser(e),class:(0,o.C4)({active:n.selectedUser&&n.selectedUser.id===e.id})},[(0,r.Lk)("span",cr,(0,o.v_)(e.username||e.email||"Êú™ÂëΩÂêçÁî®Êà∑"),1),e.messageCount?((0,r.uX)(),(0,r.CE)("span",dr,(0,o.v_)(e.messageCount),1)):(0,r.Q3)("",!0)],10,lr)))),128))]))]),(0,r.Lk)("div",ur,[n.selectedUser?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("h3",null,"‰∏é "+(0,o.v_)(n.selectedUser.username||n.selectedUser.email||"Êú™ÂëΩÂêçÁî®Êà∑")+" ÁöÑÁïôË®ÄËÆ∞ÂΩï",1),(0,r.Lk)("div",mr,[n.loading?((0,r.uX)(),(0,r.CE)("div",pr,"Âä†ËΩΩ‰∏≠...")):0===n.chatMessages.length?((0,r.uX)(),(0,r.CE)("div",gr,"ÊöÇÊó†ÁïôË®ÄËÆ∞ÂΩï")):((0,r.uX)(!0),(0,r.CE)(r.FK,{key:2},(0,r.pI)(n.chatMessages,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,o.C4)(["message",e.isAdmin?"admin":"user"])},[(0,r.Lk)("div",kr,[(0,r.Lk)("span",vr,(0,o.v_)(e.username),1),(0,r.Lk)("div",fr,[(0,r.Lk)("button",{class:"action-btn delete",onClick:t=>l.deleteMessage(e)},"Âà†Èô§",8,Lr),e.admin_reply?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"action-btn reply",onClick:t=>l.selectMessage(e)},"ÂõûÂ§ç",8,wr))])]),(0,r.Lk)("div",br,(0,o.v_)(e.message),1),e.admin_reply?((0,r.uX)(),(0,r.CE)("div",yr,[t[4]||(t[4]=(0,r.Lk)("strong",null,"ÁÆ°ÁêÜÂëòÂõûÂ§çÔºö",-1)),(0,r.eW)(" "+(0,o.v_)(e.admin_reply),1)])):(0,r.Q3)("",!0),(0,r.Lk)("div",Ir,(0,o.v_)(l.formatTimestamp(e.created_at)),1)],2)))),128))]),(0,r.Lk)("div",Cr,[n.selectedMessage?((0,r.uX)(),(0,r.CE)("div",_r,[(0,r.eW)(" Ê≠£Âú®ÂõûÂ§ç: "+(0,o.v_)(n.selectedMessage.message)+" ",1),(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.cancelReply&&l.cancelReply(...e)),class:"cancel-btn"},"ÂèñÊ∂àÂõûÂ§ç")])):(0,r.Q3)("",!0),(0,r.Lk)("div",Ar,[(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.adminReply=e),placeholder:n.selectedMessage?"ËæìÂÖ•ÂõûÂ§ç...":"ÂèëÈÄÅÊñ∞Ê∂àÊÅØÁªôËØ•Áî®Êà∑...",rows:"3"},null,8,Er),[[s.Jo,n.adminReply]]),(0,r.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>l.sendMessage&&l.sendMessage(...e)),class:"send-btn",disabled:n.loading||!n.adminReply.trim()},(0,o.v_)(n.selectedMessage?"ÂèëÈÄÅÂõûÂ§ç":"ÂèëÈÄÅÊ∂àÊÅØ"),9,Sr)])])],64)):((0,r.uX)(),(0,r.CE)("div",hr,"ËØ∑ÈÄâÊã©‰∏Ä‰∏™Áî®Êà∑Êü•ÁúãÁïôË®ÄËÆ∞ÂΩï"))])])}const Xr="https://api.26ywzm.icu";var Ur={data(){return{users:[],selectedUser:null,chatMessages:[],selectedMessage:null,adminReply:"",loading:!1,message:{show:!1,content:"",type:""}}},methods:{async fetchUsers(){try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("userRole");if("admin"!==t&&"super_admin"!==t)return void this.$router.push("/");const a={Authorization:`Bearer ${e}`},s=await y.A.get(`${Xr}/api/canteen/users`,{headers:a});this.users=s.data||[]}catch(e){console.error("Ëé∑ÂèñÁî®Êà∑ÂàóË°®Â§±Ë¥•:",e),alert("Ëé∑ÂèñÁî®Êà∑ÂàóË°®Â§±Ë¥•Ôºö"+(e.response?.data?.message||e.message))}},selectUser(e){this.selectedUser=e,this.selectedMessage=null,this.adminReply="",e?this.fetchUserMessages(e.id):this.chatMessages=[]},async fetchUserMessages(e){try{const t=localStorage.getItem("authToken"),a=localStorage.getItem("userRole");if("admin"!==a&&"super_admin"!==a)return void this.$router.push("/");const s={Authorization:`Bearer ${t}`},r=await y.A.get(`${Xr}/api/canteen/feedback/${e}`,{headers:s});this.chatMessages=r.data.map((e=>({...e,isAdmin:null!==e.admin_reply})))}catch(t){console.error("Ëé∑ÂèñÁïôË®ÄËÆ∞ÂΩïÂ§±Ë¥•:",t),alert("Ëé∑ÂèñÁïôË®ÄËÆ∞ÂΩïÂ§±Ë¥•Ôºö"+(t.response?.data?.message||t.message))}},selectMessage(e){this.selectedMessage=e,this.adminReply=""},async sendMessage(){if(this.adminReply.trim())if(this.selectedUser||this.selectedMessage)try{const e=localStorage.getItem("authToken"),t=localStorage.getItem("userRole");if("admin"!==t&&"super_admin"!==t)return void this.$router.push("/");const a={Authorization:`Bearer ${e}`};if(this.selectedMessage){const e=await y.A.put(`${Xr}/api/canteen/feedback/${this.selectedMessage.id}/reply`,{admin_reply:this.adminReply},{headers:a});if("ÂõûÂ§çÊàêÂäü"!==e.data.message)throw new Error(e.data.message||"ÂõûÂ§çÂ§±Ë¥•");alert("ÂõûÂ§çÊàêÂäü"),await this.fetchUserMessages(this.selectedUser.id),this.adminReply="",this.selectedMessage=null}else if(this.selectedUser){const e=await y.A.post(`${Xr}/api/canteen/feedback/admin-message`,{user_id:this.selectedUser.id,message:this.adminReply},{headers:a});if(!e.data.message)throw new Error("ÂèëÈÄÅÂ§±Ë¥•");alert(e.data.message),await this.fetchUserMessages(this.selectedUser.id),this.adminReply=""}}catch(e){console.error("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•:",e),alert("ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•Ôºö"+(e.response?.data?.message||e.message))}else alert("ËØ∑ÈÄâÊã©‰∏Ä‰∏™Áî®Êà∑ÊàñÁïôË®ÄËøõË°åÂõûÂ§ç");else alert("ËØ∑ËæìÂÖ•ÂõûÂ§çÂÜÖÂÆπ")},cancelReply(){this.selectedMessage=null,this.adminReply=""},async deleteMessage(e){if(confirm("Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ÁïôË®ÄÂêóÔºü"))try{const t=localStorage.getItem("authToken"),a=localStorage.getItem("userRole");if("admin"!==a&&"super_admin"!==a)return void this.$router.push("/");const s={Authorization:`Bearer ${t}`};await y.A.delete(`${Xr}/api/canteen/feedback/${e.id}`,{headers:s}),alert("ÁïôË®ÄÂ∑≤Âà†Èô§"),await this.fetchUserMessages(this.selectedUser.id)}catch(t){alert("Âà†Èô§ÁïôË®ÄÂ§±Ë¥•Ôºö"+(t.response?.data?.message||t.message))}},formatTimestamp(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}},async mounted(){const e=localStorage.getItem("userRole");"admin"===e||"super_admin"===e?this.fetchUsers():this.$router.push("/")}};const Fr=(0,d.A)(Ur,[["render",$r],["__scopeId","data-v-62e10767"]]);var Tr=Fr;const Mr={key:0,class:"loading"},Vr={key:1},Dr={key:0,class:"create-vote-section"},zr={class:"form-group"},Pr={class:"form-group"},Rr={class:"form-group"},Wr=["onUpdate:modelValue","placeholder"],xr=["onClick"],Or={class:"form-actions"},Br={key:1,class:"vote-list"},Qr={class:"vote-info"},Nr={class:"vote-options"},qr={class:"options-list"},jr={class:"option-label"},Kr={class:"vote-count"},Jr={class:"result-bar-container"},Hr={class:"result-count"},Zr={class:"total-votes"},Yr={class:"vote-actions"},Gr=["onClick"],eo={class:"action-bar"};function to(e,t,a,i,n,l){return(0,r.uX)(),(0,r.CE)("div",null,[t[12]||(t[12]=(0,r.Lk)("h2",null,"ÁÆ°ÁêÜÊäïÁ•®",-1)),n.loading?((0,r.uX)(),(0,r.CE)("div",Mr,t[6]||(t[6]=[(0,r.Lk)("span",null,"Âä†ËΩΩ‰∏≠...",-1)]))):((0,r.uX)(),(0,r.CE)("div",Vr,[n.showCreateForm?((0,r.uX)(),(0,r.CE)("div",Dr,[t[10]||(t[10]=(0,r.Lk)("h3",null,"ÂàõÂª∫Êñ∞ÊäïÁ•®",-1)),(0,r.Lk)("div",zr,[t[7]||(t[7]=(0,r.Lk)("label",null,"Ê†áÈ¢òÔºö",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.newVote.title=e),class:"form-input",placeholder:"ËØ∑ËæìÂÖ•ÊäïÁ•®Ê†áÈ¢ò"},null,512),[[s.Jo,n.newVote.title]])]),(0,r.Lk)("div",Pr,[t[8]||(t[8]=(0,r.Lk)("label",null,"ÊèèËø∞Ôºö",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.newVote.description=e),class:"form-input",placeholder:"ËØ∑ËæìÂÖ•ÊäïÁ•®ÊèèËø∞"},null,512),[[s.Jo,n.newVote.description]])]),(0,r.Lk)("div",Rr,[t[9]||(t[9]=(0,r.Lk)("label",null,"ÈÄâÈ°πÔºö",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.newVote.options,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"option-input"},[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e=>n.newVote.options[t]=e,class:"form-input",placeholder:"ÈÄâÈ°π "+(t+1)},null,8,Wr),[[s.Jo,n.newVote.options[t]]]),(0,r.Lk)("button",{onClick:e=>l.removeOption(t),class:"remove-option-btn"},"Âà†Èô§",8,xr)])))),128)),(0,r.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>l.addOption&&l.addOption(...e)),class:"add-option-btn"},"Ê∑ªÂä†ÈÄâÈ°π")]),(0,r.Lk)("div",Or,[(0,r.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>l.submitNewVote&&l.submitNewVote(...e)),class:"submit-btn"},"ÂàõÂª∫ÊäïÁ•®"),(0,r.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>l.cancelCreate&&l.cancelCreate(...e)),class:"cancel-btn"},"ÂèñÊ∂à")])])):((0,r.uX)(),(0,r.CE)("div",Br,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.votes,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"vote-item"},[(0,r.Lk)("div",Qr,[(0,r.Lk)("h3",null,(0,o.v_)(e.title),1),(0,r.Lk)("p",null,(0,o.v_)(e.description),1),(0,r.Lk)("div",Nr,[t[11]||(t[11]=(0,r.Lk)("h4",null,"ÊäïÁ•®ÈÄâÈ°πÔºö",-1)),(0,r.Lk)("div",qr,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.options,((t,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"option-result"},[(0,r.Lk)("div",jr,[(0,r.eW)((0,o.v_)(t)+" ",1),(0,r.Lk)("span",Kr,"("+(0,o.v_)(e.results[t]||0)+"Á•®)",1)]),(0,r.Lk)("div",Jr,[(0,r.Lk)("div",{class:"result-bar",style:(0,o.Tr)({width:l.getPercentage(e.results[t],e.totalVotes)+"%",backgroundColor:l.getBarColor(a)})},null,4),(0,r.Lk)("span",Hr,(0,o.v_)(((e.results[t]||0)/(e.totalVotes||1)*100).toFixed(1))+"% ",1)])])))),128))]),(0,r.Lk)("p",Zr,"ÊÄªÊäïÁ•®Êï∞Ôºö"+(0,o.v_)(e.totalVotes||0),1)])]),(0,r.Lk)("div",Yr,[(0,r.Lk)("button",{class:"delete-btn",onClick:t=>l.deleteVote(e.id)},"Âà†Èô§ÊäïÁ•®",8,Gr)])])))),128))])),(0,r.Lk)("div",eo,[n.showCreateForm?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=e=>n.showCreateForm=!0)},"ÂàõÂª∫Êñ∞ÊäïÁ•®"))])]))])}const ao="https://api.26ywzm.icu";var so={name:"AdminManageVotes",mixins:[sa],data(){return{votes:[],loading:!1,showCreateForm:!1,newVote:{title:"",description:"",options:["",""]}}},mounted(){this.checkAdminAuth()&&this.fetchVotes()},methods:{async fetchVotes(){this.loading=!0;try{console.log("ÂºÄÂßãËé∑ÂèñÊäïÁ•®ÂàóË°®");const e=await y.A.get(`${ao}/api/canteen/votes`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("Ëé∑ÂèñÂà∞ÁöÑÊäïÁ•®Êï∞ÊçÆ:",e.data),this.votes=e.data.map((e=>({...e,options:Array.isArray(e.options)?e.options:[]}))),console.log("Â§ÑÁêÜÂêéÁöÑÊäïÁ•®Êï∞ÊçÆ:",this.votes)}catch(e){console.error("Ëé∑ÂèñÊäïÁ•®Â§±Ë¥•:",e),console.error("ÈîôËØØËØ¶ÊÉÖ:",e.response?.data||e.message),Ze.nk.error("Ëé∑ÂèñÊäïÁ•®ÂàóË°®Â§±Ë¥•")}finally{this.loading=!1}},async deleteVote(e){if(confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊäïÁ•®ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºåÊâÄÊúâÊäïÁ•®ËÆ∞ÂΩïÈÉΩÂ∞ÜË¢´Âà†Èô§„ÄÇ"))try{console.log(`ÂºÄÂßãÂà†Èô§ÊäïÁ•® ID: ${e}`),await y.A.delete(`${ao}/api/canteen/votes/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("ÊäïÁ•®Âà†Èô§ÊàêÂäü"),this.votes=this.votes.filter((t=>t.id!==e))}catch(t){console.error("Âà†Èô§ÊäïÁ•®Â§±Ë¥•:",t),console.error("ÈîôËØØËØ¶ÊÉÖ:",t.response?.data||t.message),401===t.response?.status?Ze.nk.error("ÊùÉÈôê‰∏çË∂≥ÔºåËØ∑Á°Æ‰øùÊÇ®Â∑≤ÁôªÂΩïÂπ∂ÂÖ∑ÊúâÁÆ°ÁêÜÂëòÊùÉÈôê"):t.response?.data?.message?Ze.nk.error(t.response.data.message):Ze.nk.error("Âà†Èô§ÊäïÁ•®Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}},addOption(){this.newVote.options.push("")},removeOption(e){this.newVote.options.length>2?this.newVote.options.splice(e,1):Ze.nk.warning("Ëá≥Â∞ëÈúÄË¶Å‰∏§‰∏™ÈÄâÈ°π")},async submitNewVote(){if(this.validateForm())try{console.log("ÂáÜÂ§áÊèê‰∫§ÁöÑÊäïÁ•®Êï∞ÊçÆ:",this.newVote);const e=await y.A.post(`${ao}/api/canteen/votes`,{...this.newVote,options:this.newVote.options.filter((e=>e.trim()))},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("ÂàõÂª∫ÊäïÁ•®ÂìçÂ∫î:",e.data),Ze.nk.success("ÊäïÁ•®ÂàõÂª∫ÊàêÂäü"),this.showCreateForm=!1,this.resetForm(),this.fetchVotes()}catch(e){console.error("ÂàõÂª∫ÊäïÁ•®Â§±Ë¥•:",e),console.error("ÈîôËØØËØ¶ÊÉÖ:",e.response?.data||e.message),Ze.nk.error(e.response?.data?.message||"ÂàõÂª∫ÊäïÁ•®Â§±Ë¥•")}},validateForm(){return this.newVote.title.trim()?this.newVote.description.trim()?!this.newVote.options.some((e=>!e.trim()))||(Ze.nk.warning("ËØ∑Â°´ÂÜôÊâÄÊúâÈÄâÈ°π"),!1):(Ze.nk.warning("ËØ∑ËæìÂÖ•ÊäïÁ•®ÊèèËø∞"),!1):(Ze.nk.warning("ËØ∑ËæìÂÖ•ÊäïÁ•®Ê†áÈ¢ò"),!1)},resetForm(){this.newVote={title:"",description:"",options:["",""]}},cancelCreate(){this.showCreateForm=!1,this.resetForm()},getPercentage(e,t){return t?e/t*100:0},getBarColor(e){const t=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399"];return t[e%t.length]}}};const ro=(0,d.A)(so,[["render",to],["__scopeId","data-v-b206f670"]]);var oo=ro;const io={class:"vote-detail"},no={key:0,class:"loading"},lo={key:1,class:"vote-content"},co={class:"vote-header"},uo={class:"description"},ho={key:0,class:"vote-options"},mo={class:"options-list"},po=["onClick"],go={key:1,class:"vote-result"},ko={class:"vote-stats"},vo={class:"stats-list"},fo={class:"stat-label"},Lo={class:"stat-bar-container"},wo={class:"stat-value"},bo={class:"vote-actions"};function yo(e,t,a,s,i,n){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",io,[i.loading?((0,r.uX)(),(0,r.CE)("div",no,t[0]||(t[0]=[(0,r.Lk)("span",null,"Âä†ËΩΩ‰∏≠...",-1)]))):((0,r.uX)(),(0,r.CE)("div",lo,[(0,r.Lk)("div",co,[(0,r.Lk)("h2",null,(0,o.v_)(i.vote.title),1),(0,r.Lk)("p",uo,(0,o.v_)(i.vote.description),1)]),i.hasVoted?((0,r.uX)(),(0,r.CE)("div",go,[t[3]||(t[3]=(0,r.Lk)("div",{class:"result-message"},[(0,r.Lk)("i",{class:"el-icon-check"}),(0,r.Lk)("span",null,"ÊÇ®Â∑≤ÂÆåÊàêÊäïÁ•®")],-1)),(0,r.Lk)("div",ko,[t[2]||(t[2]=(0,r.Lk)("h3",null,"ÂΩìÂâçÊäïÁ•®ÁªìÊûúÔºö",-1)),(0,r.Lk)("div",vo,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.vote.results,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"stat-item"},[(0,r.Lk)("div",fo,(0,o.v_)(t),1),(0,r.Lk)("div",Lo,[(0,r.Lk)("div",{class:"stat-bar",style:(0,o.Tr)({width:e/i.vote.totalVotes*100+"%"})},null,4),(0,r.Lk)("span",wo,(0,o.v_)(e)+"Á•® ("+(0,o.v_)((e/i.vote.totalVotes*100).toFixed(1))+"%)",1)])])))),128))])])])):((0,r.uX)(),(0,r.CE)("div",ho,[t[1]||(t[1]=(0,r.Lk)("h3",null,"ËØ∑ÈÄâÊã©ÊÇ®ÁöÑÈÄâÈ°πÔºö",-1)),(0,r.Lk)("div",mo,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.vote.options,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"option-item"},[(0,r.Lk)("button",{onClick:t=>n.submitVote(e),class:"option-button"},(0,o.v_)(e),9,po)])))),128))])])),(0,r.Lk)("div",bo,[(0,r.bF)(l,{to:"/votelist",class:"back-button"},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" ËøîÂõûÊäïÁ•®ÂàóË°® ")]))),_:1})])]))])}const Io="https://api.26ywzm.icu";var Co={name:"VoteDetail",data(){return{vote:{title:"",description:"",options:[],results:{},totalVotes:0},hasVoted:!1,loading:!0}},mounted(){this.fetchVoteDetails()},methods:{async fetchVoteDetails(){const e=this.$route.params.id;try{const t=await y.A.get(`${Io}/api/canteen/votes/${e}`);this.vote={...t.data,results:t.data.results||{},totalVotes:t.data.totalVotes||0};const a=localStorage.getItem("userId"),s=await y.A.get(`${Io}/api/canteen/votes/${e}/user/${a}`);this.hasVoted=s.data.hasVoted}catch(t){console.error("Ëé∑ÂèñÊäïÁ•®ËØ¶ÊÉÖÂ§±Ë¥•:",t),Ze.nk.error("Ëé∑ÂèñÊäïÁ•®ËØ¶ÊÉÖÂ§±Ë¥•")}finally{this.loading=!1}},async submitVote(e){const t=this.$route.params.id;try{await y.A.post(`${Io}/api/canteen/votes/${t}/vote`,{option:e},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),Ze.nk.success("ÊäïÁ•®ÊàêÂäü"),this.hasVoted=!0,await this.fetchVoteDetails()}catch(a){console.error("ÊäïÁ•®Â§±Ë¥•:",a),401===a.response?.status?Ze.nk.error("ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçÊäïÁ•®"):a.response?.data?.message?Ze.nk.error(a.response.data.message):Ze.nk.error("ÊäïÁ•®Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}}}};const _o=(0,d.A)(Co,[["render",yo],["__scopeId","data-v-028eb128"]]);var Ao=_o;const Eo={class:"vote-list-container"},So={key:0,class:"loading"},$o={key:1,class:"empty-state"},Xo={key:2,class:"vote-list"},Uo={class:"vote-title"},Fo={class:"vote-description"},To={class:"vote-status"},Mo={class:"vote-count"};function Vo(e,t,a,s,i,n){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Eo,[t[2]||(t[2]=(0,r.Lk)("h2",null,"ÊäïÁ•®ÂàóË°®",-1)),i.loading?((0,r.uX)(),(0,r.CE)("div",So,t[0]||(t[0]=[(0,r.Lk)("span",null,"Âä†ËΩΩ‰∏≠...",-1)]))):0===i.votes.length?((0,r.uX)(),(0,r.CE)("div",$o," ÊöÇÊó†ÊäïÁ•® ")):((0,r.uX)(),(0,r.CE)("div",Xo,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.votes,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"vote-card"},[(0,r.Lk)("h3",Uo,(0,o.v_)(e.title),1),(0,r.Lk)("p",Fo,(0,o.v_)(e.description),1),(0,r.Lk)("div",To,[(0,r.Lk)("span",Mo,(0,o.v_)(e.totalVotes||0)+" ‰∫∫Â∑≤ÊäïÁ•®",1)]),(0,r.bF)(l,{to:{name:"VoteDetail",params:{id:e.id}},class:"vote-link"},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)(" ÂèÇ‰∏éÊäïÁ•® ")]))),_:2},1032,["to"])])))),128))]))])}const Do="https://api.26ywzm.icu";var zo={name:"VoteList",data(){return{votes:[],loading:!1}},mounted(){this.fetchVotes()},methods:{async fetchVotes(){this.loading=!0;try{const e=await y.A.get(`${Do}/api/canteen/votes`);this.votes=e.data}catch(e){console.error("Ëé∑ÂèñÊäïÁ•®Â§±Ë¥•:",e)}finally{this.loading=!1}}}};const Po=(0,d.A)(zo,[["render",Vo],["__scopeId","data-v-8dafb1e8"]]);var Ro=Po;const Wo=[{path:"/",name:"CommunityHome",component:E},{path:"/login",name:"UserLogin",component:O},{path:"/register",name:"UserRegister",component:ue},{path:"/profile",name:"Profile",component:Ft},{path:"/discover",name:"Discover",component:tt},{path:"/news/:id",name:"NewsDetail",component:jt},{path:"/articles/new",name:"ArticleEditor",component:na},{path:"/canteenorder",name:"CanteenOrder",component:Ea},{path:"/canteenadmin",name:"CanteenAdmin",component:Ha},{path:"/order/:orderId",name:"OrderDetail",component:vs},{path:"/canteen/orders",name:"OrderManagement",component:Bs},{path:"/feedback",name:"SubmitFeedback",component:ar},{path:"/managefeedback",name:"ManageeFedback",component:Tr},{path:"/adminvotes",name:"AdminManageVotes",component:oo},{path:"/votedetail/:id",name:"VoteDetail",component:Ao},{path:"/votelist",name:"VoteList",component:Ro}],xo=(0,m.aE)({history:(0,m.LA)(),routes:Wo});var Oo=xo,Bo=a(2261),Qo=a(122),No=a(3274),qo=a(311),jo=a(9990),Ko=a(7144),Jo=a(7652),Ho=a(1384),Zo=a(3788),Yo=(a(2241),a(6832)),Go=a(8519),ei=a(1656);a(4188);const ti=()=>{const e=(0,s.Ef)(h),t=(0,Bo.Ey)();return e.use(Oo),e.use(Qo.$n),e.use(No.B8),e.use(qo.HF),e.use(jo.gq),e.use(Ko.lG),e.use(Yo.lj),e.use(Yo.ct),e.use(Go.S2),e.use(ei.kZ),e.use(Ze.nk),e.use(Jo.lV),e.use(Ho.D0),e.use(Zo.Qh),e.use(t),e},ai=ti();ai.mount("#app")}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,r,o){if(!s){var i=1/0;for(d=0;d<e.length;d++){s=e[d][0],r=e[d][1],o=e[d][2];for(var n=!0,l=0;l<s.length;l++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(n=!1,o<i&&(i=o));if(n){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,r,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var r,o,i=s[0],n=s[1],l=s[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in n)a.o(n,r)&&(a.m[r]=n[r]);if(l)var d=l(a)}for(t&&t(s);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},s=self["webpackChunkcommunity_service"]=self["webpackChunkcommunity_service"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(5817)}));s=a.O(s)})();