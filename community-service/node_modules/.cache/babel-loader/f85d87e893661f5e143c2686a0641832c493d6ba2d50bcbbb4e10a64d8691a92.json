{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport axios from 'axios';\nconst API = process.env.VUE_APP_API_URL;\nimport communityHome from '@/assets/community-home.js';\nexport default {\n  ...communityHome,\n  data() {\n    return {\n      ...communityHome.data(),\n      carouselImages: [],\n      // 轮播图数据\n      hotNews: [],\n      // 热门新闻数据\n      newsList: [],\n      // 新闻列表数据\n      currentImage: 0,\n      // 当前显示的轮播图索引\n      intervalId: null,\n      // 用于存储定时器 ID\n      imageCache: new Map() // 添加图片缓存\n    };\n  },\n  mounted() {\n    this.checkDevice();\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.checkDevice);\n    this.fetchData();\n    this.startCarousel();\n  },\n  beforeUnmount() {\n    clearInterval(this.intervalId); // 组件销毁时清除定时器\n  },\n  methods: {\n    ...communityHome.methods,\n    async loadImage(item) {\n      if (!item.image_url) return;\n      item.blobUrl = await this.getImageUrl(item.image_url);\n    },\n    async getImageUrl(path) {\n      if (!path) return '';\n      if (path.startsWith('http')) {\n        return path;\n      }\n\n      // 检查缓存\n      if (this.imageCache.has(path)) {\n        return this.imageCache.get(path);\n      }\n      try {\n        const token = localStorage.getItem('authToken');\n        const headers = {\n          'Authorization': `Bearer ${token}`\n        };\n        const uploadPath = path.startsWith('/uploads/') ? path : `/uploads/${path}`;\n        const baseUrl = process.env.VUE_APP_BASE_URL || 'http://localhost:3000';\n        const response = await fetch(`${baseUrl}${uploadPath}`, {\n          headers\n        });\n        const blob = await response.blob();\n        const blobUrl = URL.createObjectURL(blob);\n\n        // 存入缓存\n        this.imageCache.set(path, blobUrl);\n        return blobUrl;\n      } catch (error) {\n        console.error('加载图片失败:', error);\n        return '';\n      }\n    },\n    async fetchData() {\n      try {\n        // 获取轮播图数据\n        const carouselResponse = await axios.get(`${API}/articles?category=carousel`);\n        this.carouselImages = carouselResponse.data;\n        // 预加载轮播图\n        for (const image of this.carouselImages) {\n          await this.loadImage(image);\n        }\n\n        // 获取热门新闻数据\n        const hotNewsResponse = await axios.get(`${API}/articles?category=hotNews`);\n        this.hotNews = hotNewsResponse.data;\n        // 预加载热门新闻图片\n        for (const news of this.hotNews) {\n          await this.loadImage(news);\n        }\n\n        // 获取新闻列表数据\n        const newsListResponse = await axios.get(`${API}/articles?category=newsList`);\n        this.newsList = newsListResponse.data;\n      } catch (error) {\n        console.error('获取数据失败:', error);\n      }\n    },\n    startCarousel() {\n      this.intervalId = setInterval(() => {\n        this.nextImage();\n      }, 3000);\n    },\n    pauseCarousel() {\n      clearInterval(this.intervalId);\n    },\n    nextImage() {\n      if (this.carouselImages.length > 0) {\n        this.currentImage = (this.currentImage + 1) % this.carouselImages.length;\n      }\n    },\n    prevImage() {\n      if (this.carouselImages.length > 0) {\n        this.currentImage = (this.currentImage + this.carouselImages.length - 1) % this.carouselImages.length;\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","API","process","env","VUE_APP_API_URL","communityHome","data","carouselImages","hotNews","newsList","currentImage","intervalId","imageCache","Map","mounted","checkDevice","window","addEventListener","handleScroll","fetchData","startCarousel","beforeUnmount","clearInterval","methods","loadImage","item","image_url","blobUrl","getImageUrl","path","startsWith","has","get","token","localStorage","getItem","headers","uploadPath","baseUrl","VUE_APP_BASE_URL","response","fetch","blob","URL","createObjectURL","set","error","console","carouselResponse","image","hotNewsResponse","news","newsListResponse","setInterval","nextImage","pauseCarousel","length","prevImage"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\CommunityHome.vue"],"sourcesContent":["<template>\n  <div class=\"home-container\">\n    <!-- 轮播图 -->\n    <div class=\"carousel\" @mouseenter=\"pauseCarousel\" @mouseleave=\"startCarousel\">\n      <router-link v-if=\"carouselImages.length > 0\"\n        :to=\"{ name: 'NewsDetail', params: { id: carouselImages[currentImage].id } }\">\n        <img :src=\"carouselImages[currentImage].blobUrl\" alt=\"轮播图\" class=\"carousel-image\" />\n      </router-link>\n      <button @click=\"prevImage\">‹</button>\n      <button @click=\"nextImage\">›</button>\n    </div>\n\n    <!-- 热门新闻 -->\n    <section class=\"hot-news\">\n      <h2>热门新闻</h2>\n      <div class=\"hot-news-grid\">\n        <div v-for=\"news in hotNews\" :key=\"news.id\" class=\"news-item\">\n          <router-link :to=\"{ name: 'NewsDetail', params: { id: news.id } }\">\n            <img :src=\"news.blobUrl\" alt=\"新闻图片\" class=\"news-image\" />\n          </router-link>\n          <p>{{ news.title }}</p>\n        </div>\n      </div>\n    </section>\n\n    <!-- 新闻列表 -->\n    <section class=\"news-list\">\n      <h2>新闻列表</h2>\n      <ul>\n        <li v-for=\"news in newsList\" :key=\"news.id\">\n          <router-link :to=\"{ name: 'NewsDetail', params: { id: news.id } }\">{{ news.title }}</router-link>\n        </li>\n      </ul>\n    </section>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nconst API = process.env.VUE_APP_API_URL;\nimport communityHome from '@/assets/community-home.js';\nexport default {\n  ...communityHome,\n  data() {\n    return {\n      ...communityHome.data(),\n      carouselImages: [], // 轮播图数据\n      hotNews: [],        // 热门新闻数据\n      newsList: [],       // 新闻列表数据\n      currentImage: 0,    // 当前显示的轮播图索引\n      intervalId: null,   // 用于存储定时器 ID\n      imageCache: new Map(), // 添加图片缓存\n    };\n  },\n  mounted() {\n    this.checkDevice();\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.checkDevice);\n    this.fetchData();\n    this.startCarousel();\n  },\n  beforeUnmount() {\n    clearInterval(this.intervalId); // 组件销毁时清除定时器\n  },\n  methods: {\n    ...communityHome.methods,\n\n    async loadImage(item) {\n      if (!item.image_url) return;\n      item.blobUrl = await this.getImageUrl(item.image_url);\n    },\n    async getImageUrl(path) {\n      if (!path) return ''; \n      if (path.startsWith('http')) {\n        return path;\n      }\n      \n      // 检查缓存\n      if (this.imageCache.has(path)) {\n        return this.imageCache.get(path);\n      }\n\n      try {\n        const token = localStorage.getItem('authToken');\n        const headers = { 'Authorization': `Bearer ${token}` };\n        const uploadPath = path.startsWith('/uploads/') ? path : `/uploads/${path}`;\n        const baseUrl = process.env.VUE_APP_BASE_URL || 'http://localhost:3000';\n        const response = await fetch(`${baseUrl}${uploadPath}`, { headers });\n        const blob = await response.blob();\n        const blobUrl = URL.createObjectURL(blob);\n        \n        // 存入缓存\n        this.imageCache.set(path, blobUrl);\n        \n        return blobUrl;\n      } catch (error) {\n        console.error('加载图片失败:', error);\n        return '';\n      }\n    },\n    async fetchData() {\n      try {\n        // 获取轮播图数据\n        const carouselResponse = await axios.get(`${API}/articles?category=carousel`);\n        this.carouselImages = carouselResponse.data;\n        // 预加载轮播图\n        for (const image of this.carouselImages) {\n          await this.loadImage(image);\n        }\n\n        // 获取热门新闻数据\n        const hotNewsResponse = await axios.get(`${API}/articles?category=hotNews`);\n        this.hotNews = hotNewsResponse.data;\n        // 预加载热门新闻图片\n        for (const news of this.hotNews) {\n          await this.loadImage(news);\n        }\n\n        // 获取新闻列表数据\n        const newsListResponse = await axios.get(`${API}/articles?category=newsList`);\n        this.newsList = newsListResponse.data;\n      } catch (error) {\n        console.error('获取数据失败:', error);\n      }\n    },\n\n    startCarousel() {\n      this.intervalId = setInterval(() => {\n        this.nextImage(); \n      }, 3000); \n    },\n\n    pauseCarousel() {\n      clearInterval(this.intervalId); \n    },\n\n    nextImage() {\n      if (this.carouselImages.length > 0) {\n        this.currentImage = (this.currentImage + 1) % this.carouselImages.length;\n      }\n    },\n\n    prevImage() {\n      if (this.carouselImages.length > 0) {\n        this.currentImage = (this.currentImage + this.carouselImages.length - 1) % this.carouselImages.length;\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n@import '@/assets/community-home.css';\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}