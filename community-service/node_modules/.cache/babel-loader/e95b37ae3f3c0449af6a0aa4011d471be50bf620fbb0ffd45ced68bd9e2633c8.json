{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, renderList as _renderList, Fragment as _Fragment, normalizeStyle as _normalizeStyle, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"vote-detail\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_3 = {\n  key: 1,\n  class: \"vote-content\"\n};\nconst _hoisted_4 = {\n  class: \"vote-header\"\n};\nconst _hoisted_5 = {\n  class: \"description\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"vote-options\"\n};\nconst _hoisted_7 = {\n  class: \"options-list\"\n};\nconst _hoisted_8 = [\"onClick\"];\nconst _hoisted_9 = {\n  key: 1,\n  class: \"vote-result\"\n};\nconst _hoisted_10 = {\n  class: \"vote-stats\"\n};\nconst _hoisted_11 = {\n  class: \"stats-list\"\n};\nconst _hoisted_12 = {\n  class: \"stat-label\"\n};\nconst _hoisted_13 = {\n  class: \"stat-bar-container\"\n};\nconst _hoisted_14 = {\n  class: \"stat-value\"\n};\nconst _hoisted_15 = {\n  class: \"vote-actions\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, _cache[0] || (_cache[0] = [_createElementVNode(\"span\", null, \"加载中...\", -1 /* HOISTED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"h2\", null, _toDisplayString($data.vote.title), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_5, _toDisplayString($data.vote.description), 1 /* TEXT */)]), !$data.hasVoted ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, [_cache[1] || (_cache[1] = _createElementVNode(\"h3\", null, \"请选择您的选项：\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_7, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.vote.options, (option, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"option-item\"\n    }, [_createElementVNode(\"button\", {\n      onClick: $event => $options.submitVote(option),\n      class: \"option-button\"\n    }, _toDisplayString(option), 9 /* TEXT, PROPS */, _hoisted_8)]);\n  }), 128 /* KEYED_FRAGMENT */))])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_cache[3] || (_cache[3] = _createElementVNode(\"div\", {\n    class: \"result-message\"\n  }, [_createElementVNode(\"i\", {\n    class: \"el-icon-check\"\n  }), _createElementVNode(\"span\", null, \"您已完成投票\")], -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_10, [_cache[2] || (_cache[2] = _createElementVNode(\"h3\", null, \"当前投票结果：\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_11, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.vote.results, (count, option) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: option,\n      class: \"stat-item\"\n    }, [_createElementVNode(\"div\", _hoisted_12, _toDisplayString(option), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"div\", {\n      class: \"stat-bar\",\n      style: _normalizeStyle({\n        width: count / $data.vote.totalVotes * 100 + '%'\n      })\n    }, null, 4 /* STYLE */), _createElementVNode(\"span\", _hoisted_14, _toDisplayString(count) + \"票 (\" + _toDisplayString((count / $data.vote.totalVotes * 100).toFixed(1)) + \"%)\", 1 /* TEXT */)])]);\n  }), 128 /* KEYED_FRAGMENT */))])])])), _createElementVNode(\"div\", _hoisted_15, [_createVNode(_component_router_link, {\n    to: \"/votelist\",\n    class: \"back-button\"\n  }, {\n    default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\" 返回投票列表 \")])),\n    _: 1 /* STABLE */\n  })])]))]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","$data","loading","_hoisted_2","_cache","_createElementVNode","_hoisted_3","_hoisted_4","_toDisplayString","vote","title","_hoisted_5","description","hasVoted","_hoisted_6","_hoisted_7","_Fragment","_renderList","options","option","index","onClick","$event","$options","submitVote","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","results","count","_hoisted_12","_hoisted_13","style","_normalizeStyle","width","totalVotes","_hoisted_14","toFixed","_hoisted_15","_createVNode","_component_router_link","to","default","_withCtx","_createTextVNode","_"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\VoteDetail.vue"],"sourcesContent":["<template>\n  <div class=\"vote-detail\">\n    <div v-if=\"loading\" class=\"loading\">\n      <span>加载中...</span>\n    </div>\n    <div v-else class=\"vote-content\">\n      <div class=\"vote-header\">\n        <h2>{{ vote.title }}</h2>\n        <p class=\"description\">{{ vote.description }}</p>\n      </div>\n\n      <div v-if=\"!hasVoted\" class=\"vote-options\">\n        <h3>请选择您的选项：</h3>\n        <div class=\"options-list\">\n          <div \n            v-for=\"(option, index) in vote.options\" \n            :key=\"index\"\n            class=\"option-item\"\n          >\n            <button \n              @click=\"submitVote(option)\"\n              class=\"option-button\"\n            >\n              {{ option }}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div v-else class=\"vote-result\">\n        <div class=\"result-message\">\n          <i class=\"el-icon-check\"></i>\n          <span>您已完成投票</span>\n        </div>\n        <div class=\"vote-stats\">\n          <h3>当前投票结果：</h3>\n          <div class=\"stats-list\">\n            <div \n              v-for=\"(count, option) in vote.results\" \n              :key=\"option\" \n              class=\"stat-item\"\n            >\n              <div class=\"stat-label\">{{ option }}</div>\n              <div class=\"stat-bar-container\">\n                <div \n                  class=\"stat-bar\" \n                  :style=\"{ width: ((count / vote.totalVotes) * 100) + '%' }\"\n                ></div>\n                <span class=\"stat-value\">{{ count }}票 ({{ ((count / vote.totalVotes) * 100).toFixed(1) }}%)</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"vote-actions\">\n        <router-link to=\"/votelist\" class=\"back-button\">\n          返回投票列表\n        </router-link>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport { ElMessage } from 'element-plus';\nconst API = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  name: 'VoteDetail',\n  data() {\n    return {\n      vote: {\n        title: '',\n        description: '',\n        options: [],\n        results: {},\n        totalVotes: 0\n      },\n      hasVoted: false,\n      loading: true\n    };\n  },\n  mounted() {\n    this.fetchVoteDetails();\n  },\n  methods: {\n    async fetchVoteDetails() {\n      const voteId = this.$route.params.id;\n      try {\n        const response = await axios.get(`${API}/api/canteen/votes/${voteId}`);\n        this.vote = {\n          ...response.data,\n          results: response.data.results || {},\n          totalVotes: response.data.totalVotes || 0\n        };\n        \n        // 检查用户是否已投票\n        const userId = localStorage.getItem('userId');\n        const voteResponse = await axios.get(`${API}/api/canteen/votes/${voteId}/user/${userId}`);\n        this.hasVoted = voteResponse.data.hasVoted;\n      } catch (error) {\n        console.error('获取投票详情失败:', error);\n        ElMessage.error('获取投票详情失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async submitVote(option) {\n      const voteId = this.$route.params.id;\n      const userId = localStorage.getItem('userId');\n      \n      try {\n        await axios.post(`${API}/api/canteen/votes/${voteId}/vote`, {\n          user_id: userId,\n          option\n        });\n        ElMessage.success('投票成功');\n        this.hasVoted = true;\n        await this.fetchVoteDetails(); // 刷新投票结果\n      } catch (error) {\n        console.error('投票失败:', error);\n        ElMessage.error('投票失败，请稍后重试');\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.vote-detail {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.loading {\n  text-align: center;\n  padding: 40px;\n  color: #666;\n}\n\n.vote-content {\n  background: white;\n  border-radius: 8px;\n  padding: 30px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n}\n\n.vote-header {\n  text-align: center;\n  margin-bottom: 30px;\n}\n\n.vote-header h2 {\n  color: #333;\n  margin: 0 0 15px 0;\n}\n\n.description {\n  color: #666;\n  line-height: 1.6;\n}\n\n.vote-options {\n  margin: 30px 0;\n}\n\n.vote-options h3 {\n  color: #333;\n  margin-bottom: 20px;\n}\n\n.options-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 15px;\n}\n\n.option-button {\n  width: 100%;\n  padding: 15px 20px;\n  background-color: #409EFF;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.3s;\n  font-size: 1em;\n}\n\n.option-button:hover {\n  background-color: #66b1ff;\n  transform: translateY(-2px);\n}\n\n.vote-result {\n  margin: 30px 0;\n}\n\n.result-message {\n  text-align: center;\n  color: #67C23A;\n  margin-bottom: 30px;\n  font-size: 1.1em;\n}\n\n.vote-stats h3 {\n  color: #333;\n  margin-bottom: 20px;\n}\n\n.stats-list {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n}\n\n.stat-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.stat-label {\n  width: 120px;\n  color: #333;\n}\n\n.stat-bar-container {\n  flex: 1;\n  height: 24px;\n  background: #f5f7fa;\n  border-radius: 12px;\n  position: relative;\n  overflow: hidden;\n}\n\n.stat-bar {\n  height: 100%;\n  background: #409EFF;\n  border-radius: 12px;\n  transition: width 0.3s ease;\n}\n\n.stat-value {\n  position: absolute;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #333;\n  font-size: 0.9em;\n}\n\n.vote-actions {\n  margin-top: 30px;\n  text-align: center;\n}\n\n.back-button {\n  display: inline-block;\n  padding: 10px 20px;\n  background-color: #909399;\n  color: white;\n  text-decoration: none;\n  border-radius: 4px;\n  transition: background-color 0.3s;\n}\n\n.back-button:hover {\n  background-color: #a6a9ad;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}