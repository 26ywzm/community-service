{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport axios from 'axios';\nconst API = process.env.VUE_APP_API_URL;\nimport communityHome from '@/assets/community-home.js';\nexport default {\n  ...communityHome,\n  data() {\n    return {\n      ...communityHome.data(),\n      carouselImages: [],\n      // 轮播图数据\n      hotNews: [],\n      // 热门新闻数据\n      newsList: [],\n      // 新闻列表数据\n      currentImage: 0,\n      // 当前显示的轮播图索引\n      intervalId: null,\n      // 用于存储定时器 ID\n      imageCache: new Map() // 添加图片缓存\n    };\n  },\n  mounted() {\n    this.checkDevice();\n    window.addEventListener('scroll', this.handleScroll);\n    window.addEventListener('resize', this.checkDevice);\n    this.fetchData();\n    this.startCarousel();\n  },\n  beforeUnmount() {\n    clearInterval(this.intervalId); // 组件销毁时清除定时器\n  },\n  methods: {\n    ...communityHome.methods,\n    async loadImage(item) {\n      if (!item.image_url) return;\n      item.blobUrl = await this.getImageUrl(item.image_url);\n    },\n    async getImageUrl(path) {\n      if (!path) return '';\n      if (path.startsWith('http')) {\n        return path;\n      }\n\n      // 检查缓存\n      if (this.imageCache.has(path)) {\n        return this.imageCache.get(path);\n      }\n      try {\n        const uploadPath = path.startsWith('/uploads/') ? path : `/uploads/${path}`;\n        const baseUrl = API.replace('/api/auth', '');\n        const response = await fetch(`${baseUrl}${uploadPath}`);\n        const blob = await response.blob();\n        const blobUrl = URL.createObjectURL(blob);\n\n        // 存入缓存\n        this.imageCache.set(path, blobUrl);\n        return blobUrl;\n      } catch (error) {\n        console.error('加载图片失败:', error);\n        return '';\n      }\n    },\n    async fetchData() {\n      try {\n        // 获取轮播图数据\n        const carouselResponse = await axios.get(`${API}/articles?category=carousel`);\n        this.carouselImages = carouselResponse.data;\n        // 预加载轮播图\n        for (const image of this.carouselImages) {\n          await this.loadImage(image);\n        }\n\n        // 获取热门新闻数据\n        const hotNewsResponse = await axios.get(`${API}/articles?category=hotNews`);\n        this.hotNews = hotNewsResponse.data;\n        // 预加载热门新闻图片\n        for (const news of this.hotNews) {\n          await this.loadImage(news);\n        }\n\n        // 获取新闻列表数据\n        const newsListResponse = await axios.get(`${API}/articles?category=newsList`);\n        this.newsList = newsListResponse.data;\n      } catch (error) {\n        console.error('获取数据失败:', error);\n      }\n    },\n    startCarousel() {\n      this.intervalId = setInterval(() => {\n        this.nextImage();\n      }, 3000);\n    },\n    pauseCarousel() {\n      clearInterval(this.intervalId);\n    },\n    nextImage() {\n      if (this.carouselImages.length > 0) {\n        this.currentImage = (this.currentImage + 1) % this.carouselImages.length;\n      }\n    },\n    prevImage() {\n      if (this.carouselImages.length > 0) {\n        this.currentImage = (this.currentImage + this.carouselImages.length - 1) % this.carouselImages.length;\n      }\n    },\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit'\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}