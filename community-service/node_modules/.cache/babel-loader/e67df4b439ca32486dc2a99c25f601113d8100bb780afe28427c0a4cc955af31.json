{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport router from '../router';\nexport const handleAuthError = (shouldRedirect = true) => {\n  // 清除所有认证信息\n  localStorage.removeItem('authToken');\n  localStorage.removeItem('userRole');\n  localStorage.removeItem('username');\n  localStorage.removeItem('userId');\n  localStorage.removeItem('email');\n  if (shouldRedirect) {\n    // 跳转到登录页面\n    router.push('/login');\n  }\n};\nexport const handleApiError = (error, options = {}) => {\n  const {\n    customErrorHandler = null,\n    suppressAuthError = false,\n    showAlert = true\n  } = options;\n  console.error('API请求失败:', error);\n  if (error.response) {\n    const status = error.response.status;\n    const message = error.response.data?.message || '操作失败，请重试。';\n    const userRole = localStorage.getItem('userRole');\n    switch (status) {\n      case 403:\n        // 对于 admin 用户，不要自动登出\n        if (userRole === 'admin' && suppressAuthError) {\n          if (showAlert) {\n            alert('您没有权限执行此操作');\n          }\n        } else {\n          handleAuthError();\n        }\n        break;\n      case 401:\n        // 对于 admin 用户，不要自动登出\n        if (userRole === 'admin' && suppressAuthError) {\n          if (showAlert) {\n            alert('您的操作未被授权，请联系超级管理员');\n          }\n        } else {\n          handleAuthError();\n        }\n        break;\n      default:\n        if (customErrorHandler) {\n          customErrorHandler(error);\n        } else if (showAlert) {\n          alert(message);\n        }\n    }\n  } else if (error.request) {\n    if (showAlert) {\n      alert('网络错误，请检查您的网络连接。');\n    }\n  } else {\n    if (showAlert) {\n      alert('请求错误，请重试。');\n    }\n  }\n  return Promise.reject(error);\n};","map":{"version":3,"names":["router","handleAuthError","shouldRedirect","localStorage","removeItem","push","handleApiError","error","options","customErrorHandler","suppressAuthError","showAlert","console","response","status","message","data","userRole","getItem","alert","request","Promise","reject"],"sources":["c:/Users/拯救者/Desktop/text/community-service/src/utils/errorHandler.js"],"sourcesContent":["import router from '../router';\n\nexport const handleAuthError = (shouldRedirect = true) => {\n  // 清除所有认证信息\n  localStorage.removeItem('authToken');\n  localStorage.removeItem('userRole');\n  localStorage.removeItem('username');\n  localStorage.removeItem('userId');\n  localStorage.removeItem('email');\n  \n  if (shouldRedirect) {\n    // 跳转到登录页面\n    router.push('/login');\n  }\n};\n\nexport const handleApiError = (error, options = {}) => {\n  const {\n    customErrorHandler = null,\n    suppressAuthError = false,\n    showAlert = true\n  } = options;\n\n  console.error('API请求失败:', error);\n  \n  if (error.response) {\n    const status = error.response.status;\n    const message = error.response.data?.message || '操作失败，请重试。';\n    const userRole = localStorage.getItem('userRole');\n\n    switch (status) {\n      case 403:\n        // 对于 admin 用户，不要自动登出\n        if (userRole === 'admin' && suppressAuthError) {\n          if (showAlert) {\n            alert('您没有权限执行此操作');\n          }\n        } else {\n          handleAuthError();\n        }\n        break;\n      case 401:\n        // 对于 admin 用户，不要自动登出\n        if (userRole === 'admin' && suppressAuthError) {\n          if (showAlert) {\n            alert('您的操作未被授权，请联系超级管理员');\n          }\n        } else {\n          handleAuthError();\n        }\n        break;\n      default:\n        if (customErrorHandler) {\n          customErrorHandler(error);\n        } else if (showAlert) {\n          alert(message);\n        }\n    }\n  } else if (error.request) {\n    if (showAlert) {\n      alert('网络错误，请检查您的网络连接。');\n    }\n  } else {\n    if (showAlert) {\n      alert('请求错误，请重试。');\n    }\n  }\n  \n  return Promise.reject(error);\n};\n"],"mappings":";AAAA,OAAOA,MAAM,MAAM,WAAW;AAE9B,OAAO,MAAMC,eAAe,GAAGA,CAACC,cAAc,GAAG,IAAI,KAAK;EACxD;EACAC,YAAY,CAACC,UAAU,CAAC,WAAW,CAAC;EACpCD,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;EACnCD,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;EACnCD,YAAY,CAACC,UAAU,CAAC,QAAQ,CAAC;EACjCD,YAAY,CAACC,UAAU,CAAC,OAAO,CAAC;EAEhC,IAAIF,cAAc,EAAE;IAClB;IACAF,MAAM,CAACK,IAAI,CAAC,QAAQ,CAAC;EACvB;AACF,CAAC;AAED,OAAO,MAAMC,cAAc,GAAGA,CAACC,KAAK,EAAEC,OAAO,GAAG,CAAC,CAAC,KAAK;EACrD,MAAM;IACJC,kBAAkB,GAAG,IAAI;IACzBC,iBAAiB,GAAG,KAAK;IACzBC,SAAS,GAAG;EACd,CAAC,GAAGH,OAAO;EAEXI,OAAO,CAACL,KAAK,CAAC,UAAU,EAAEA,KAAK,CAAC;EAEhC,IAAIA,KAAK,CAACM,QAAQ,EAAE;IAClB,MAAMC,MAAM,GAAGP,KAAK,CAACM,QAAQ,CAACC,MAAM;IACpC,MAAMC,OAAO,GAAGR,KAAK,CAACM,QAAQ,CAACG,IAAI,EAAED,OAAO,IAAI,WAAW;IAC3D,MAAME,QAAQ,GAAGd,YAAY,CAACe,OAAO,CAAC,UAAU,CAAC;IAEjD,QAAQJ,MAAM;MACZ,KAAK,GAAG;QACN;QACA,IAAIG,QAAQ,KAAK,OAAO,IAAIP,iBAAiB,EAAE;UAC7C,IAAIC,SAAS,EAAE;YACbQ,KAAK,CAAC,YAAY,CAAC;UACrB;QACF,CAAC,MAAM;UACLlB,eAAe,CAAC,CAAC;QACnB;QACA;MACF,KAAK,GAAG;QACN;QACA,IAAIgB,QAAQ,KAAK,OAAO,IAAIP,iBAAiB,EAAE;UAC7C,IAAIC,SAAS,EAAE;YACbQ,KAAK,CAAC,mBAAmB,CAAC;UAC5B;QACF,CAAC,MAAM;UACLlB,eAAe,CAAC,CAAC;QACnB;QACA;MACF;QACE,IAAIQ,kBAAkB,EAAE;UACtBA,kBAAkB,CAACF,KAAK,CAAC;QAC3B,CAAC,MAAM,IAAII,SAAS,EAAE;UACpBQ,KAAK,CAACJ,OAAO,CAAC;QAChB;IACJ;EACF,CAAC,MAAM,IAAIR,KAAK,CAACa,OAAO,EAAE;IACxB,IAAIT,SAAS,EAAE;MACbQ,KAAK,CAAC,iBAAiB,CAAC;IAC1B;EACF,CAAC,MAAM;IACL,IAAIR,SAAS,EAAE;MACbQ,KAAK,CAAC,WAAW,CAAC;IACpB;EACF;EAEA,OAAOE,OAAO,CAACC,MAAM,CAACf,KAAK,CAAC;AAC9B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}