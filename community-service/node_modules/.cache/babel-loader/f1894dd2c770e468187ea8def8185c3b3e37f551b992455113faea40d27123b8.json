{"ast":null,"code":"import axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\nexport default {\n  data() {\n    return {\n      feedbackMessage: '',\n      // 用户输入的留言内容\n      feedbacks: [],\n      // 留言和回复的历史记录\n      feedbackSubmitted: false,\n      // 提交留言成功标志\n      message: {\n        show: false,\n        content: '',\n        type: ''\n      }\n    };\n  },\n  mounted() {\n    this.loadFeedbacks(); // 页面加载时，获取用户的留言历史\n  },\n  methods: {\n    getAuthHeaders() {\n      const token = localStorage.getItem('authToken');\n      return token ? {\n        'Authorization': `Bearer ${token}`\n      } : {};\n    },\n    // 获取用户的留言和回复历史\n    async loadFeedbacks() {\n      const userId = localStorage.getItem('userId');\n      const token = localStorage.getItem('authToken');\n      if (!userId || !token) {\n        this.showMessage('请先登录', 'error');\n        return;\n      }\n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedbacks`, {\n          params: {\n            user_id: userId\n          },\n          headers: this.getAuthHeaders()\n        });\n        this.feedbacks = response.data.feedbacks; // 设置留言历史\n      } catch (error) {\n        console.error('加载留言历史失败:', error);\n        this.showMessage('加载留言历史失败，请稍后重试', 'error');\n      }\n    },\n    // 提交留言\n    async submitFeedback() {\n      const userId = localStorage.getItem('userId');\n      const token = localStorage.getItem('authToken');\n      if (!userId || !token) {\n        this.showMessage('请先登录', 'error');\n        return;\n      }\n      if (!this.feedbackMessage.trim()) {\n        this.showMessage('留言内容不能为空', 'error');\n        return;\n      }\n      try {\n        await axios.post(`${BASE_URL}/api/canteen/feedback`, {\n          user_id: userId,\n          message: this.feedbackMessage\n        }, {\n          headers: this.getAuthHeaders()\n        });\n        this.showMessage('留言提交成功');\n        this.feedbackMessage = ''; // 清空留言内容\n\n        this.feedbackSubmitted = true; // 显示提交成功提示\n        setTimeout(() => {\n          this.feedbackSubmitted = false;\n        }, 2000);\n\n        // 重新加载留言历史，显示新的留言和可能的回复\n        await this.loadFeedbacks();\n      } catch (error) {\n        console.error('提交留言失败:', error);\n        this.showMessage('提交留言失败，请稍后重试', 'error');\n      }\n    },\n    // 删除留言\n    async deleteFeedback(feedback) {\n      if (!confirm('确定要删除这条留言吗？')) return;\n      const userId = localStorage.getItem('userId');\n      const token = localStorage.getItem('authToken');\n      if (!userId || !token) {\n        this.showMessage('请先登录', 'error');\n        return;\n      }\n      try {\n        await axios.delete(`${BASE_URL}/api/canteen/feedback/${feedback.id}`, {\n          headers: this.getAuthHeaders(),\n          data: {\n            user_id: userId,\n            is_admin: localStorage.getItem('userRole') === 'admin'\n          }\n        });\n        this.showMessage('留言已删除');\n        await this.loadFeedbacks(); // 重新获取留言列表\n      } catch (error) {\n        console.error('删除留言失败:', error);\n        this.showMessage(error.response?.data?.message || '删除失败，请稍后重试', 'error');\n      }\n    },\n    // 显示提示消息\n    showMessage(content, type = 'success') {\n      this.message = {\n        show: true,\n        content,\n        type\n      };\n      setTimeout(() => {\n        this.message.show = false;\n      }, 3000);\n    },\n    // 格式化时间\n    formatTime(time) {\n      return new Date(time).toLocaleString();\n    }\n  }\n};","map":{"version":3,"names":["axios","BASE_URL","process","env","VUE_APP_BASE_URL","data","feedbackMessage","feedbacks","feedbackSubmitted","message","show","content","type","mounted","loadFeedbacks","methods","getAuthHeaders","token","localStorage","getItem","userId","showMessage","response","get","params","user_id","headers","error","console","submitFeedback","trim","post","setTimeout","deleteFeedback","feedback","confirm","delete","id","is_admin","formatTime","time","Date","toLocaleString"],"sources":["c:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\SubmitFeedback.vue"],"sourcesContent":["<template>\n  <div class=\"submit-feedback\">\n    <h2>提交您的建议或留言</h2>\n\n    <!-- 显示历史留言 -->\n    <div class=\"feedback-history\" v-if=\"feedbacks.length > 0\">\n      <h3>我的留言历史</h3>\n      <div v-for=\"feedback in feedbacks\" :key=\"feedback.id\" class=\"feedback-item\">\n        <div class=\"feedback-header\">\n          <span class=\"feedback-time\">{{ formatTime(feedback.created_at) }}</span>\n          <button class=\"delete-btn\" @click=\"deleteFeedback(feedback)\">删除</button>\n        </div>\n        <div class=\"feedback-content\">\n          <p><strong>留言：</strong>{{ feedback.message }}</p>\n          <p v-if=\"feedback.admin_reply\" class=\"admin-reply\">\n            <strong>管理员回复：</strong>{{ feedback.admin_reply }}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <!-- 留言输入框 -->\n    <textarea v-model=\"feedbackMessage\" placeholder=\"请填写您的留言\" rows=\"4\" required></textarea>\n\n    <!-- 提交按钮 -->\n    <button @click=\"submitFeedback\">提交留言</button>\n\n    <!-- 提交后提示 -->\n    <div v-if=\"feedbackSubmitted\" class=\"submit-success\">\n      <p>留言提交成功！</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  data() {\n    return {\n      feedbackMessage: '', // 用户输入的留言内容\n      feedbacks: [], // 留言和回复的历史记录\n      feedbackSubmitted: false, // 提交留言成功标志\n      message: {\n        show: false,\n        content: '',\n        type: ''\n      }\n    };\n  },\n  mounted() {\n    this.loadFeedbacks(); // 页面加载时，获取用户的留言历史\n  },\n  methods: {\n    getAuthHeaders() {\n      const token = localStorage.getItem('authToken');\n      return token ? { 'Authorization': `Bearer ${token}` } : {};\n    },\n\n    // 获取用户的留言和回复历史\n    async loadFeedbacks() {\n      const userId = localStorage.getItem('userId');\n      const token = localStorage.getItem('authToken');\n      \n      if (!userId || !token) {\n        this.showMessage('请先登录', 'error');\n        return;\n      }\n      \n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedbacks`, {\n          params: { user_id: userId },\n          headers: this.getAuthHeaders()\n        });\n        this.feedbacks = response.data.feedbacks; // 设置留言历史\n      } catch (error) {\n        console.error('加载留言历史失败:', error);\n        this.showMessage('加载留言历史失败，请稍后重试', 'error');\n      }\n    },\n\n    // 提交留言\n    async submitFeedback() {\n      const userId = localStorage.getItem('userId');\n      const token = localStorage.getItem('authToken');\n\n      if (!userId || !token) {\n        this.showMessage('请先登录', 'error');\n        return;\n      }\n\n      if (!this.feedbackMessage.trim()) {\n        this.showMessage('留言内容不能为空', 'error');\n        return;\n      }\n\n      try {\n        await axios.post(`${BASE_URL}/api/canteen/feedback`, {\n          user_id: userId,\n          message: this.feedbackMessage,\n        }, {\n          headers: this.getAuthHeaders()\n        });\n\n        this.showMessage('留言提交成功');\n        this.feedbackMessage = ''; // 清空留言内容\n\n        this.feedbackSubmitted = true; // 显示提交成功提示\n        setTimeout(() => {\n          this.feedbackSubmitted = false;\n        }, 2000);\n\n        // 重新加载留言历史，显示新的留言和可能的回复\n        await this.loadFeedbacks();\n      } catch (error) {\n        console.error('提交留言失败:', error);\n        this.showMessage('提交留言失败，请稍后重试', 'error');\n      }\n    },\n\n    // 删除留言\n    async deleteFeedback(feedback) {\n      if (!confirm('确定要删除这条留言吗？')) return;\n\n      const userId = localStorage.getItem('userId');\n      const token = localStorage.getItem('authToken');\n      \n      if (!userId || !token) {\n        this.showMessage('请先登录', 'error');\n        return;\n      }\n\n      try {\n        await axios.delete(`${BASE_URL}/api/canteen/feedback/${feedback.id}`, {\n          headers: this.getAuthHeaders(),\n          data: {\n            user_id: userId,\n            is_admin: localStorage.getItem('userRole') === 'admin'\n          }\n        });\n        \n        this.showMessage('留言已删除');\n        await this.loadFeedbacks(); // 重新获取留言列表\n      } catch (error) {\n        console.error('删除留言失败:', error);\n        this.showMessage(error.response?.data?.message || '删除失败，请稍后重试', 'error');\n      }\n    },\n\n    // 显示提示消息\n    showMessage(content, type = 'success') {\n      this.message = {\n        show: true,\n        content,\n        type\n      };\n      setTimeout(() => {\n        this.message.show = false;\n      }, 3000);\n    },\n\n    // 格式化时间\n    formatTime(time) {\n      return new Date(time).toLocaleString();\n    }\n  },\n};\n</script>\n\n<style scoped>\n.submit-feedback {\n  padding: 20px;\n}\n\ntextarea {\n  width: 100%;\n  margin-bottom: 10px;\n  padding: 10px;\n}\n\nbutton {\n  padding: 10px 20px;\n  background-color: #4CAF50;\n  color: white;\n  border: none;\n  cursor: pointer;\n}\n\nbutton:hover {\n  background-color: #45a049;\n}\n\n.feedback-item {\n  margin-bottom: 20px;\n  border: 1px solid #ddd;\n  padding: 10px;\n}\n\n.feedback-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.feedback-time {\n  color: #666;\n  font-size: 0.9em;\n}\n\n.delete-btn {\n  padding: 4px 8px;\n  font-size: 12px;\n  background-color: #ff5252;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.delete-btn:hover {\n  background-color: #ff1744;\n  transform: translateY(-1px);\n}\n\n.submit-success {\n  background-color: #d4edda;\n  padding: 10px;\n  margin-top: 10px;\n  border-radius: 5px;\n  color: #155724;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}