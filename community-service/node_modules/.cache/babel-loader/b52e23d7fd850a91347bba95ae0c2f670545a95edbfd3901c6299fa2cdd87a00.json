{"ast":null,"code":"import axios from 'axios';\nconst API = process.env.VUE_APP_API_URL;\nexport const verifyAuth = async () => {\n  try {\n    const token = localStorage.getItem('authToken');\n    if (!token) {\n      console.warn('验证失败：没有找到token');\n      return {\n        valid: false,\n        reason: 'no-token'\n      };\n    }\n    const response = await axios.get(`${API}/verify`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    if (!response.data.valid) {\n      if (response.data.correctRole) {\n        console.warn(`角色不匹配，更新为正确的角色：${response.data.correctRole}`);\n        localStorage.setItem('userRole', response.data.correctRole);\n        return {\n          valid: false,\n          reason: 'role-mismatch',\n          newRole: response.data.correctRole\n        };\n      } else {\n        console.warn('验证失败：无效的token');\n        localStorage.removeItem('authToken');\n        localStorage.removeItem('userRole');\n        localStorage.removeItem('username');\n        localStorage.removeItem('userId');\n        localStorage.removeItem('email');\n        return {\n          valid: false,\n          reason: 'invalid-token'\n        };\n      }\n    }\n    return {\n      valid: true,\n      role: response.data.role\n    };\n  } catch (error) {\n    console.error('验证失败:', error);\n    if (error.response && error.response.status === 401) {\n      console.warn('未经授权，清除认证信息');\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('userRole');\n      localStorage.removeItem('username');\n      localStorage.removeItem('userId');\n      localStorage.removeItem('email');\n      return {\n        valid: false,\n        reason: 'unauthorized'\n      };\n    }\n    return {\n      valid: true\n    };\n  }\n};","map":{"version":3,"names":["axios","API","process","env","VUE_APP_API_URL","verifyAuth","token","localStorage","getItem","console","warn","valid","reason","response","get","headers","Authorization","data","correctRole","setItem","newRole","removeItem","role","error","status"],"sources":["C:/Users/拯救者/Desktop/text/community-service/src/utils/auth.js"],"sourcesContent":["import axios from 'axios';\n\nconst API = process.env.VUE_APP_API_URL;\n\nexport const verifyAuth = async () => {\n  try {\n    const token = localStorage.getItem('authToken');\n    if (!token) {\n      console.warn('验证失败：没有找到token');\n      return { valid: false, reason: 'no-token' };\n    }\n\n    const response = await axios.get(`${API}/verify`, {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    });\n\n    if (!response.data.valid) {\n      if (response.data.correctRole) {\n        console.warn(`角色不匹配，更新为正确的角色：${response.data.correctRole}`);\n        localStorage.setItem('userRole', response.data.correctRole);\n        return { valid: false, reason: 'role-mismatch', newRole: response.data.correctRole };\n      } else {\n        console.warn('验证失败：无效的token');\n        localStorage.removeItem('authToken');\n        localStorage.removeItem('userRole');\n        localStorage.removeItem('username');\n        localStorage.removeItem('userId');\n        localStorage.removeItem('email');\n        return { valid: false, reason: 'invalid-token' };\n      }\n    }\n\n    return { valid: true, role: response.data.role };\n  } catch (error) {\n    console.error('验证失败:', error);\n    if (error.response && error.response.status === 401) {\n      console.warn('未经授权，清除认证信息');\n      localStorage.removeItem('authToken');\n      localStorage.removeItem('userRole');\n      localStorage.removeItem('username');\n      localStorage.removeItem('userId');\n      localStorage.removeItem('email');\n      return { valid: false, reason: 'unauthorized' };\n    }\n    return { valid: true };\n  }\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,GAAG,GAAGC,OAAO,CAACC,GAAG,CAACC,eAAe;AAEvC,OAAO,MAAMC,UAAU,GAAG,MAAAA,CAAA,KAAY;EACpC,IAAI;IACF,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;IAC/C,IAAI,CAACF,KAAK,EAAE;MACVG,OAAO,CAACC,IAAI,CAAC,gBAAgB,CAAC;MAC9B,OAAO;QAAEC,KAAK,EAAE,KAAK;QAAEC,MAAM,EAAE;MAAW,CAAC;IAC7C;IAEA,MAAMC,QAAQ,GAAG,MAAMb,KAAK,CAACc,GAAG,CAAC,GAAGb,GAAG,SAAS,EAAE;MAChDc,OAAO,EAAE;QACPC,aAAa,EAAE,UAAUV,KAAK;MAChC;IACF,CAAC,CAAC;IAEF,IAAI,CAACO,QAAQ,CAACI,IAAI,CAACN,KAAK,EAAE;MACxB,IAAIE,QAAQ,CAACI,IAAI,CAACC,WAAW,EAAE;QAC7BT,OAAO,CAACC,IAAI,CAAC,kBAAkBG,QAAQ,CAACI,IAAI,CAACC,WAAW,EAAE,CAAC;QAC3DX,YAAY,CAACY,OAAO,CAAC,UAAU,EAAEN,QAAQ,CAACI,IAAI,CAACC,WAAW,CAAC;QAC3D,OAAO;UAAEP,KAAK,EAAE,KAAK;UAAEC,MAAM,EAAE,eAAe;UAAEQ,OAAO,EAAEP,QAAQ,CAACI,IAAI,CAACC;QAAY,CAAC;MACtF,CAAC,MAAM;QACLT,OAAO,CAACC,IAAI,CAAC,eAAe,CAAC;QAC7BH,YAAY,CAACc,UAAU,CAAC,WAAW,CAAC;QACpCd,YAAY,CAACc,UAAU,CAAC,UAAU,CAAC;QACnCd,YAAY,CAACc,UAAU,CAAC,UAAU,CAAC;QACnCd,YAAY,CAACc,UAAU,CAAC,QAAQ,CAAC;QACjCd,YAAY,CAACc,UAAU,CAAC,OAAO,CAAC;QAChC,OAAO;UAAEV,KAAK,EAAE,KAAK;UAAEC,MAAM,EAAE;QAAgB,CAAC;MAClD;IACF;IAEA,OAAO;MAAED,KAAK,EAAE,IAAI;MAAEW,IAAI,EAAET,QAAQ,CAACI,IAAI,CAACK;IAAK,CAAC;EAClD,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdd,OAAO,CAACc,KAAK,CAAC,OAAO,EAAEA,KAAK,CAAC;IAC7B,IAAIA,KAAK,CAACV,QAAQ,IAAIU,KAAK,CAACV,QAAQ,CAACW,MAAM,KAAK,GAAG,EAAE;MACnDf,OAAO,CAACC,IAAI,CAAC,aAAa,CAAC;MAC3BH,YAAY,CAACc,UAAU,CAAC,WAAW,CAAC;MACpCd,YAAY,CAACc,UAAU,CAAC,UAAU,CAAC;MACnCd,YAAY,CAACc,UAAU,CAAC,UAAU,CAAC;MACnCd,YAAY,CAACc,UAAU,CAAC,QAAQ,CAAC;MACjCd,YAAY,CAACc,UAAU,CAAC,OAAO,CAAC;MAChC,OAAO;QAAEV,KAAK,EAAE,KAAK;QAAEC,MAAM,EAAE;MAAe,CAAC;IACjD;IACA,OAAO;MAAED,KAAK,EAAE;IAAK,CAAC;EACxB;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}