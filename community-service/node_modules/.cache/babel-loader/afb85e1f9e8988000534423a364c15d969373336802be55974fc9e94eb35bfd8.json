{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_2 = {\n  key: 1\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"create-vote-section\"\n};\nconst _hoisted_4 = {\n  class: \"form-group\"\n};\nconst _hoisted_5 = {\n  class: \"form-group\"\n};\nconst _hoisted_6 = {\n  class: \"form-group\"\n};\nconst _hoisted_7 = [\"onUpdate:modelValue\", \"placeholder\"];\nconst _hoisted_8 = [\"onClick\"];\nconst _hoisted_9 = {\n  class: \"form-actions\"\n};\nconst _hoisted_10 = {\n  key: 1,\n  class: \"vote-list\"\n};\nconst _hoisted_11 = {\n  class: \"vote-info\"\n};\nconst _hoisted_12 = {\n  class: \"vote-options\"\n};\nconst _hoisted_13 = {\n  class: \"vote-actions\"\n};\nconst _hoisted_14 = [\"onClick\"];\nconst _hoisted_15 = {\n  class: \"action-bar\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", null, [_cache[12] || (_cache[12] = _createElementVNode(\"h2\", null, \"管理投票\", -1 /* HOISTED */)), $data.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, _cache[6] || (_cache[6] = [_createElementVNode(\"span\", null, \"加载中...\", -1 /* HOISTED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [$data.showCreateForm ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[10] || (_cache[10] = _createElementVNode(\"h3\", null, \"创建新投票\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_4, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", null, \"标题：\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.newVote.title = $event),\n    class: \"form-input\",\n    placeholder: \"请输入投票标题\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.newVote.title]])]), _createElementVNode(\"div\", _hoisted_5, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", null, \"描述：\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.newVote.description = $event),\n    class: \"form-input\",\n    placeholder: \"请输入投票描述\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.newVote.description]])]), _createElementVNode(\"div\", _hoisted_6, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", null, \"选项：\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.newVote.options, (option, index) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      class: \"option-input\"\n    }, [_withDirectives(_createElementVNode(\"input\", {\n      \"onUpdate:modelValue\": $event => $data.newVote.options[index] = $event,\n      class: \"form-input\",\n      placeholder: '选项 ' + (index + 1)\n    }, null, 8 /* PROPS */, _hoisted_7), [[_vModelText, $data.newVote.options[index]]]), _createElementVNode(\"button\", {\n      onClick: $event => $options.removeOption(index),\n      class: \"remove-option-btn\"\n    }, \"删除\", 8 /* PROPS */, _hoisted_8)]);\n  }), 128 /* KEYED_FRAGMENT */)), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.addOption && $options.addOption(...args)),\n    class: \"add-option-btn\"\n  }, \"添加选项\")]), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"button\", {\n    onClick: _cache[3] || (_cache[3] = (...args) => $options.submitNewVote && $options.submitNewVote(...args)),\n    class: \"submit-btn\"\n  }, \"创建投票\"), _createElementVNode(\"button\", {\n    onClick: _cache[4] || (_cache[4] = (...args) => $options.cancelCreate && $options.cancelCreate(...args)),\n    class: \"cancel-btn\"\n  }, \"取消\")])])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.votes, vote => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: vote.id,\n      class: \"vote-item\"\n    }, [_createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"h3\", null, _toDisplayString(vote.title), 1 /* TEXT */), _createElementVNode(\"p\", null, _toDisplayString(vote.description), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_12, [_cache[11] || (_cache[11] = _createElementVNode(\"span\", null, \"选项：\", -1 /* HOISTED */)), _createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(vote.options, (option, index) => {\n      return _openBlock(), _createElementBlock(\"li\", {\n        key: index\n      }, _toDisplayString(option), 1 /* TEXT */);\n    }), 128 /* KEYED_FRAGMENT */))])])]), _createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"button\", {\n      class: \"delete-btn\",\n      onClick: $event => $options.deleteVote(vote.id)\n    }, \"删除投票\", 8 /* PROPS */, _hoisted_14)])]);\n  }), 128 /* KEYED_FRAGMENT */))])), _createElementVNode(\"div\", _hoisted_15, [!$data.showCreateForm ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    class: \"create-btn\",\n    onClick: _cache[5] || (_cache[5] = $event => $data.showCreateForm = true)\n  }, \"创建新投票\")) : _createCommentVNode(\"v-if\", true)])]))]);\n}","map":{"version":3,"names":["key","class","_createElementBlock","_createElementVNode","$data","loading","_hoisted_1","_cache","_hoisted_2","showCreateForm","_hoisted_3","_hoisted_4","$event","newVote","title","placeholder","_hoisted_5","description","_hoisted_6","_Fragment","_renderList","options","option","index","_hoisted_7","onClick","$options","removeOption","_hoisted_8","args","addOption","_hoisted_9","submitNewVote","cancelCreate","_hoisted_10","votes","vote","id","_hoisted_11","_toDisplayString","_hoisted_12","_hoisted_13","deleteVote","_hoisted_14","_hoisted_15","_createCommentVNode"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\AdminManageVotes.vue"],"sourcesContent":["<template>\n  <div>\n    <h2>管理投票</h2>\n    <div v-if=\"loading\" class=\"loading\">\n      <span>加载中...</span>\n    </div>\n    <div v-else>\n      <div class=\"create-vote-section\" v-if=\"showCreateForm\">\n        <h3>创建新投票</h3>\n        <div class=\"form-group\">\n          <label>标题：</label>\n          <input v-model=\"newVote.title\" class=\"form-input\" placeholder=\"请输入投票标题\">\n        </div>\n        <div class=\"form-group\">\n          <label>描述：</label>\n          <textarea v-model=\"newVote.description\" class=\"form-input\" placeholder=\"请输入投票描述\"></textarea>\n        </div>\n        <div class=\"form-group\">\n          <label>选项：</label>\n          <div v-for=\"(option, index) in newVote.options\" :key=\"index\" class=\"option-input\">\n            <input v-model=\"newVote.options[index]\" class=\"form-input\" :placeholder=\"'选项 ' + (index + 1)\">\n            <button @click=\"removeOption(index)\" class=\"remove-option-btn\">删除</button>\n          </div>\n          <button @click=\"addOption\" class=\"add-option-btn\">添加选项</button>\n        </div>\n        <div class=\"form-actions\">\n          <button @click=\"submitNewVote\" class=\"submit-btn\">创建投票</button>\n          <button @click=\"cancelCreate\" class=\"cancel-btn\">取消</button>\n        </div>\n      </div>\n\n      <div v-else class=\"vote-list\">\n        <div v-for=\"vote in votes\" :key=\"vote.id\" class=\"vote-item\">\n          <div class=\"vote-info\">\n            <h3>{{ vote.title }}</h3>\n            <p>{{ vote.description }}</p>\n            <div class=\"vote-options\">\n              <span>选项：</span>\n              <ul>\n                <li v-for=\"(option, index) in vote.options\" :key=\"index\">\n                  {{ option }}\n                </li>\n              </ul>\n            </div>\n          </div>\n          <div class=\"vote-actions\">\n            <button class=\"delete-btn\" @click=\"deleteVote(vote.id)\">删除投票</button>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"action-bar\">\n        <button v-if=\"!showCreateForm\" class=\"create-btn\" @click=\"showCreateForm = true\">创建新投票</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport { ElMessage } from 'element-plus';\nimport { adminAuth } from '@/mixins/adminAuth';\nconst API = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  name: 'AdminManageVotes',\n  mixins: [adminAuth],\n  data() {\n    return {\n      votes: [],\n      loading: false,\n      showCreateForm: false,\n      newVote: {\n        title: '',\n        description: '',\n        options: ['', '']\n      }\n    };\n  },\n  mounted() {\n    if (this.checkAdminAuth()) {\n      this.fetchVotes();\n    }\n  },\n  methods: {\n    async fetchVotes() {\n      this.loading = true;\n      try {\n        console.log('开始获取投票列表');\n        const response = await axios.get(`${API}/api/canteen/votes`, {\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n          }\n        });\n        console.log('获取到的投票数据:', response.data);\n        \n        // 确保每个投票都有选项数组\n        this.votes = response.data.map(vote => ({\n          ...vote,\n          options: Array.isArray(vote.options) ? vote.options : []\n        }));\n        console.log('处理后的投票数据:', this.votes);\n      } catch (error) {\n        console.error('获取投票失败:', error);\n        console.error('错误详情:', error.response?.data || error.message);\n        ElMessage.error('获取投票列表失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async deleteVote(voteId) {\n      if (confirm('确定要删除这个投票吗？')) {\n        try {\n          await axios.delete(`${API}/api/canteen/votes/${voteId}`, {\n            headers: {\n              'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n            }\n          });\n          ElMessage.success('投票删除成功');\n          this.fetchVotes();\n        } catch (error) {\n          console.error('删除投票失败:', error);\n          ElMessage.error('删除投票失败');\n        }\n      }\n    },\n\n    addOption() {\n      this.newVote.options.push('');\n    },\n\n    removeOption(index) {\n      if (this.newVote.options.length > 2) {\n        this.newVote.options.splice(index, 1);\n      } else {\n        ElMessage.warning('至少需要两个选项');\n      }\n    },\n\n    async submitNewVote() {\n      if (!this.validateForm()) {\n        return;\n      }\n\n      try {\n        console.log('准备提交的投票数据:', this.newVote);\n        const response = await axios.post(`${API}/api/canteen/votes`, {\n          ...this.newVote,\n          options: this.newVote.options.filter(opt => opt.trim()) // 过滤空选项\n        }, {\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n          }\n        });\n        console.log('创建投票响应:', response.data);\n        ElMessage.success('投票创建成功');\n        this.showCreateForm = false;\n        this.resetForm();\n        this.fetchVotes();\n      } catch (error) {\n        console.error('创建投票失败:', error);\n        console.error('错误详情:', error.response?.data || error.message);\n        ElMessage.error(error.response?.data?.message || '创建投票失败');\n      }\n    },\n\n    validateForm() {\n      if (!this.newVote.title.trim()) {\n        ElMessage.warning('请输入投票标题');\n        return false;\n      }\n      if (!this.newVote.description.trim()) {\n        ElMessage.warning('请输入投票描述');\n        return false;\n      }\n      if (this.newVote.options.some(option => !option.trim())) {\n        ElMessage.warning('请填写所有选项');\n        return false;\n      }\n      return true;\n    },\n\n    resetForm() {\n      this.newVote = {\n        title: '',\n        description: '',\n        options: ['', '']\n      };\n    },\n\n    cancelCreate() {\n      this.showCreateForm = false;\n      this.resetForm();\n    }\n  }\n};\n</script>\n\n<style scoped>\n.vote-list {\n  margin: 20px 0;\n}\n\n.vote-item {\n  background: #fff;\n  border-radius: 8px;\n  padding: 20px;\n  margin-bottom: 15px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n}\n\n.vote-info {\n  flex: 1;\n}\n\n.vote-info h3 {\n  margin: 0 0 10px 0;\n  color: #333;\n}\n\n.vote-info p {\n  color: #666;\n  margin: 0 0 10px 0;\n}\n\n.vote-options {\n  margin-top: 10px;\n}\n\n.vote-options ul {\n  list-style: none;\n  padding-left: 20px;\n  margin: 5px 0;\n}\n\n.vote-options li {\n  color: #666;\n  margin: 3px 0;\n}\n\n.vote-actions {\n  margin-left: 20px;\n}\n\n.delete-btn {\n  padding: 8px 16px;\n  background-color: #f56c6c;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n\n.delete-btn:hover {\n  background-color: #ff7875;\n}\n\n.action-bar {\n  margin-top: 20px;\n  text-align: right;\n}\n\n.create-btn {\n  padding: 10px 20px;\n  background-color: #409eff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n\n.create-btn:hover {\n  background-color: #66b1ff;\n}\n\n.loading {\n  text-align: center;\n  padding: 20px;\n  color: #666;\n}\n\n.create-vote-section {\n  background: white;\n  border-radius: 8px;\n  padding: 20px;\n  margin-bottom: 20px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 8px;\n  color: #333;\n  font-weight: 500;\n}\n\n.form-input {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px solid #dcdfe6;\n  border-radius: 4px;\n  margin-bottom: 8px;\n  font-size: 14px;\n}\n\ntextarea.form-input {\n  min-height: 100px;\n  resize: vertical;\n}\n\n.option-input {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 10px;\n}\n\n.option-input .form-input {\n  margin-bottom: 0;\n}\n\n.remove-option-btn {\n  padding: 8px 16px;\n  background-color: #f56c6c;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.add-option-btn {\n  padding: 8px 16px;\n  background-color: #67c23a;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  margin-top: 10px;\n}\n\n.form-actions {\n  display: flex;\n  gap: 10px;\n  justify-content: flex-end;\n  margin-top: 20px;\n}\n\n.submit-btn {\n  padding: 10px 20px;\n  background-color: #409eff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.cancel-btn {\n  padding: 10px 20px;\n  background-color: #909399;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}