{"ast":null,"code":"import axios from 'axios';\nimport { ElMessage } from 'element-plus';\nconst API = process.env.VUE_APP_BASE_URL;\nexport default {\n  name: 'VoteDetail',\n  data() {\n    return {\n      vote: {\n        title: '',\n        description: '',\n        options: [],\n        results: {},\n        totalVotes: 0\n      },\n      hasVoted: false,\n      loading: true\n    };\n  },\n  mounted() {\n    this.fetchVoteDetails();\n  },\n  methods: {\n    async fetchVoteDetails() {\n      const voteId = this.$route.params.id;\n      try {\n        const response = await axios.get(`${API}/api/canteen/votes/${voteId}`);\n        this.vote = {\n          ...response.data,\n          results: response.data.results || {},\n          totalVotes: response.data.totalVotes || 0\n        };\n\n        // 检查用户是否已投票\n        const userId = localStorage.getItem('userId');\n        const voteResponse = await axios.get(`${API}/api/canteen/votes/${voteId}/user/${userId}`);\n        this.hasVoted = voteResponse.data.hasVoted;\n      } catch (error) {\n        console.error('获取投票详情失败:', error);\n        ElMessage.error('获取投票详情失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    async submitVote(option) {\n      const voteId = this.$route.params.id;\n      try {\n        await axios.post(`${API}/api/canteen/votes/${voteId}/vote`, {\n          option\n        }, {\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n          }\n        });\n        ElMessage.success('投票成功');\n        this.hasVoted = true;\n        await this.fetchVoteDetails(); // 刷新投票结果\n      } catch (error) {\n        console.error('投票失败:', error);\n        if (error.response?.status === 401) {\n          ElMessage.error('请先登录后再投票');\n        } else if (error.response?.data?.message) {\n          ElMessage.error(error.response.data.message);\n        } else {\n          ElMessage.error('投票失败，请稍后重试');\n        }\n      }\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}