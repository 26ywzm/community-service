{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelText as _vModelText, withDirectives as _withDirectives, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"manage-feedback\"\n};\nconst _hoisted_2 = [\"onUpdate:modelValue\"];\nconst _hoisted_3 = [\"onClick\", \"disabled\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[1] || (_cache[1] = _createElementVNode(\"h2\", null, \"留言管理\", -1 /* HOISTED */)), _createElementVNode(\"table\", null, [_cache[0] || (_cache[0] = _createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"用户\"), _createElementVNode(\"th\", null, \"留言内容\"), _createElementVNode(\"th\", null, \"管理员回复\"), _createElementVNode(\"th\", null, \"状态\"), _createElementVNode(\"th\", null, \"操作\")])], -1 /* HOISTED */)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.feedbacks, feedback => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: feedback.id\n    }, [_createElementVNode(\"td\", null, _toDisplayString(feedback.username), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(feedback.message), 1 /* TEXT */), _createElementVNode(\"td\", null, [_withDirectives(_createElementVNode(\"textarea\", {\n      \"onUpdate:modelValue\": $event => feedback.admin_reply = $event,\n      placeholder: \"回复内容\",\n      rows: \"3\"\n    }, null, 8 /* PROPS */, _hoisted_2), [[_vModelText, feedback.admin_reply]])]), _createElementVNode(\"td\", null, _toDisplayString($options.getStatusText(feedback.status)), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"button\", {\n      onClick: $event => $options.replyFeedback(feedback.id),\n      disabled: feedback.isReplying\n    }, _toDisplayString(feedback.isReplying ? '回复中...' : '回复'), 9 /* TEXT, PROPS */, _hoisted_3)])]);\n  }), 128 /* KEYED_FRAGMENT */))])]), _createCommentVNode(\" 提示消息 \"), $data.message.show ? (_openBlock(), _createElementBlock(\"div\", {\n    key: 0,\n    class: _normalizeClass(['message', $data.message.type])\n  }, _toDisplayString($data.message.content), 3 /* TEXT, CLASS */)) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createElementVNode","_Fragment","_renderList","$data","feedbacks","feedback","key","id","_toDisplayString","username","message","$event","admin_reply","placeholder","rows","_hoisted_2","$options","getStatusText","status","onClick","replyFeedback","disabled","isReplying","_hoisted_3","_createCommentVNode","show","_normalizeClass","type","content"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\ManageFeedback.vue"],"sourcesContent":["<template>\n  <div class=\"manage-feedback\">\n    <h2>留言管理</h2>\n    <table>\n      <thead>\n        <tr>\n          <th>用户</th>\n          <th>留言内容</th>\n          <th>管理员回复</th>\n          <th>状态</th>\n          <th>操作</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"feedback in feedbacks\" :key=\"feedback.id\">\n          <td>{{ feedback.username }}</td>\n          <td>{{ feedback.message }}</td>\n          <td>\n            <textarea v-model=\"feedback.admin_reply\" placeholder=\"回复内容\" rows=\"3\"></textarea>\n          </td>\n          <td>{{ getStatusText(feedback.status) }}</td>\n          <td>\n            <button @click=\"replyFeedback(feedback.id)\" :disabled=\"feedback.isReplying\">\n              {{ feedback.isReplying ? '回复中...' : '回复' }}\n            </button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n\n    <!-- 提示消息 -->\n    <div v-if=\"message.show\" :class=\"['message', message.type]\">\n      {{ message.content }}\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  data() {\n    return {\n      feedbacks: [], // 留言数据\n      message: {\n        show: false,\n        content: '',\n        type: 'success'\n      }\n    };\n  },\n  mounted() {\n    this.fetchFeedbacks(); // 获取留言数据\n  },\n  methods: {\n    // 显示提示消息\n    showMessage(content, type = 'success') {\n      this.message = {\n        show: true,\n        content,\n        type\n      };\n      setTimeout(() => {\n        this.message.show = false;\n      }, 3000);\n    },\n\n    // 获取状态文本\n    getStatusText(status) {\n      const statusMap = {\n        'pending': '待处理',\n        'processed': '已处理'\n      };\n      return statusMap[status] || status;\n    },\n\n    // 获取留言数据\n    async fetchFeedbacks() {\n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedback`);\n        this.feedbacks = response.data.map(feedback => ({\n          ...feedback,\n          isReplying: false // 初始时没有正在回复的状态\n        }));\n      } catch (error) {\n        console.error('获取留言失败:', error);\n        this.showMessage('获取留言失败，请稍后重试', 'error');\n      }\n    },\n  \n    // 回复留言\n    async replyFeedback(feedbackId) {\n      const feedback = this.feedbacks.find(item => item.id === feedbackId);\n      \n      // 检查是否填写了回复内容\n      if (!feedback.admin_reply?.trim()) {\n        this.showMessage('回复内容不能为空', 'error');\n        return;\n      }\n\n      try {\n        feedback.isReplying = true; // 设置正在回复状态\n        // 发送回复请求\n        await axios.put(`${BASE_URL}/api/canteen/feedback/${feedbackId}/reply`, {\n          admin_reply: feedback.admin_reply,\n        });\n        this.showMessage('回复成功');\n        await this.fetchFeedbacks(); // 回复成功后刷新留言列表\n      } catch (error) {\n        console.error('回复留言失败:', error);\n        this.showMessage('回复失败，请稍后重试', 'error');\n      } finally {\n        feedback.isReplying = false; // 回复完成，取消加载状态\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.manage-feedback {\n  padding: 20px;\n  position: relative;\n}\n\ntable {\n  width: 100%;\n  border-collapse: collapse;\n  margin-bottom: 20px;\n}\n\nth, td {\n  padding: 10px;\n  border: 1px solid #ccc;\n}\n\ntextarea {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  resize: vertical;\n}\n\nbutton {\n  padding: 8px 16px;\n  background-color: #4CAF50;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: background-color 0.3s;\n}\n\nbutton:hover {\n  background-color: #45a049;\n}\n\nbutton:disabled {\n  background-color: #cccccc;\n  cursor: not-allowed;\n}\n\n.message {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  padding: 10px 20px;\n  border-radius: 4px;\n  color: white;\n  animation: slideIn 0.3s ease-out;\n}\n\n.message.success {\n  background-color: #4CAF50;\n}\n\n.message.error {\n  background-color: #f44336;\n}\n\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n</style>\n"],"mappings":";;EACOA,KAAK,EAAC;AAAiB;mBAD9B;mBAAA;;uBACEC,mBAAA,CAiCM,OAjCNC,UAiCM,G,0BAhCJC,mBAAA,CAAa,YAAT,MAAI,sBACRA,mBAAA,CAyBQ,gB,0BAxBNA,mBAAA,CAQQ,gBAPNA,mBAAA,CAMK,aALHA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAa,YAAT,MAAI,GACRA,mBAAA,CAAc,YAAV,OAAK,GACTA,mBAAA,CAAW,YAAP,IAAE,GACNA,mBAAA,CAAW,YAAP,IAAE,E,wBAGVA,mBAAA,CAcQ,iB,kBAbNF,mBAAA,CAYKG,SAAA,QA1BbC,WAAA,CAc+BC,KAAA,CAAAC,SAAS,EAArBC,QAAQ;yBAAnBP,mBAAA,CAYK;MAZ8BQ,GAAG,EAAED,QAAQ,CAACE;QAC/CP,mBAAA,CAAgC,YAAAQ,gBAAA,CAAzBH,QAAQ,CAACI,QAAQ,kBACxBT,mBAAA,CAA+B,YAAAQ,gBAAA,CAAxBH,QAAQ,CAACK,OAAO,kBACvBV,mBAAA,CAEK,a,gBADHA,mBAAA,CAAgF;MAlB5F,uBAAAW,MAAA,IAkB+BN,QAAQ,CAACO,WAAW,GAAAD,MAAA;MAAEE,WAAW,EAAC,MAAM;MAACC,IAAI,EAAC;4BAlB7EC,UAAA,I,cAkB+BV,QAAQ,CAACO,WAAW,E,KAEzCZ,mBAAA,CAA6C,YAAAQ,gBAAA,CAAtCQ,QAAA,CAAAC,aAAa,CAACZ,QAAQ,CAACa,MAAM,mBACpClB,mBAAA,CAIK,aAHHA,mBAAA,CAES;MAFAmB,OAAK,EAAAR,MAAA,IAAEK,QAAA,CAAAI,aAAa,CAACf,QAAQ,CAACE,EAAE;MAAIc,QAAQ,EAAEhB,QAAQ,CAACiB;wBAC3DjB,QAAQ,CAACiB,UAAU,0CAvBpCC,UAAA,E;sCA8BIC,mBAAA,UAAa,EACFrB,KAAA,CAAAO,OAAO,CAACe,IAAI,I,cAAvB3B,mBAAA,CAEM;IAjCVQ,GAAA;IA+B8BT,KAAK,EA/BnC6B,eAAA,aA+BiDvB,KAAA,CAAAO,OAAO,CAACiB,IAAI;sBACpDxB,KAAA,CAAAO,OAAO,CAACkB,OAAO,2BAhCxBJ,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}