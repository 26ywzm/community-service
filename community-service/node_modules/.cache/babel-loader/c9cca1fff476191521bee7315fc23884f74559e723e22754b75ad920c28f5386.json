{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\nexport default {\n  data() {\n    return {\n      feedbacks: [],\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      isAdmin: false\n    };\n  },\n  mounted() {\n    this.checkAdminPermission();\n  },\n  methods: {\n    async checkAdminPermission() {\n      const userRole = localStorage.getItem('userRole');\n      if (userRole !== 'admin' && userRole !== 'super_admin') {\n        alert('无权访问此页面');\n        this.$router.push('/');\n        return;\n      }\n      this.isAdmin = true;\n      this.fetchFeedbacks();\n    },\n    async fetchFeedbacks() {\n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedback`, {\n          params: {\n            page: this.currentPage,\n            pageSize: this.pageSize\n          }\n        });\n        this.feedbacks = response.data.items.map(feedback => ({\n          ...feedback,\n          admin_reply: feedback.admin_reply || ''\n        }));\n        this.total = response.data.total;\n      } catch (error) {\n        console.error('获取留言失败:', error);\n        alert('获取留言失败，请稍后重试');\n      }\n    },\n    async replyFeedback(feedbackId) {\n      const feedback = this.feedbacks.find(item => item.id === feedbackId);\n      if (!feedback.admin_reply.trim()) {\n        alert('回复内容不能为空');\n        return;\n      }\n      if (feedback.admin_reply.length > 500) {\n        alert('回复内容不能超过500字符');\n        return;\n      }\n      try {\n        await axios.put(`${BASE_URL}/api/canteen/feedback/${feedbackId}/reply`, {\n          admin_reply: feedback.admin_reply\n        });\n        alert('回复成功');\n        this.fetchFeedbacks(); // 刷新留言列表\n      } catch (error) {\n        console.error('回复留言失败:', error);\n        alert('回复失败，请稍后重试');\n      }\n    },\n    handlePageChange(page) {\n      this.currentPage = page;\n      this.fetchFeedbacks();\n    }\n  }\n};","map":{"version":3,"names":["axios","BASE_URL","process","env","VUE_APP_BASE_URL","data","feedbacks","currentPage","pageSize","total","isAdmin","mounted","checkAdminPermission","methods","userRole","localStorage","getItem","alert","$router","push","fetchFeedbacks","response","get","params","page","items","map","feedback","admin_reply","error","console","replyFeedback","feedbackId","find","item","id","trim","length","put","handlePageChange"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\ManageFeedback.vue"],"sourcesContent":["<template>\n  <div class=\"manage-feedback\">\n    <h2>留言管理</h2>\n    <table>\n      <thead>\n        <tr>\n          <th>用户</th>\n          <th>留言内容</th>\n          <th>管理员回复</th>\n          <th>状态</th>\n          <th>操作</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"feedback in feedbacks\" :key=\"feedback.id\">\n          <td>{{ feedback.username }}</td>\n          <td>{{ feedback.message }}</td>\n          <td>\n            <textarea v-model=\"feedback.admin_reply\" placeholder=\"回复内容\" rows=\"3\"></textarea>\n          </td>\n          <td>{{ feedback.status }}</td>\n          <td>\n            <button @click=\"replyFeedback(feedback.id)\">回复</button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"pagination\">\n      <button @click=\"handlePageChange(currentPage - 1)\">上一页</button>\n      <span>第 {{ currentPage }} 页，共 {{ total }} 条数据</span>\n      <button @click=\"handlePageChange(currentPage + 1)\">下一页</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\nexport default {\n  data() {\n    return {\n      feedbacks: [],\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      isAdmin: false,\n    };\n  },\n  mounted() {\n    this.checkAdminPermission();\n  },\n  methods: {\n    async checkAdminPermission() {\n      const userRole = localStorage.getItem('userRole');\n      if (userRole !== 'admin' && userRole !== 'super_admin') {\n        alert('无权访问此页面');\n        this.$router.push('/');\n        return;\n      }\n      this.isAdmin = true;\n      this.fetchFeedbacks();\n    },\n    async fetchFeedbacks() {\n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedback`, {\n          params: {\n            page: this.currentPage,\n            pageSize: this.pageSize\n          }\n        });\n        this.feedbacks = response.data.items.map(feedback => ({\n          ...feedback,\n          admin_reply: feedback.admin_reply || ''\n        }));\n        this.total = response.data.total;\n      } catch (error) {\n        console.error('获取留言失败:', error);\n        alert('获取留言失败，请稍后重试');\n      }\n    },\n    async replyFeedback(feedbackId) {\n      const feedback = this.feedbacks.find(item => item.id === feedbackId);\n      if (!feedback.admin_reply.trim()) {\n        alert('回复内容不能为空');\n        return;\n      }\n\n      if (feedback.admin_reply.length > 500) {\n        alert('回复内容不能超过500字符');\n        return;\n      }\n\n      try {\n        await axios.put(`${BASE_URL}/api/canteen/feedback/${feedbackId}/reply`, {\n          admin_reply: feedback.admin_reply,\n        });\n        alert('回复成功');\n        this.fetchFeedbacks(); // 刷新留言列表\n      } catch (error) {\n        console.error('回复留言失败:', error);\n        alert('回复失败，请稍后重试');\n      }\n    },\n    handlePageChange(page) {\n      this.currentPage = page;\n      this.fetchFeedbacks();\n    }\n  },\n};\n</script>\n\n<style scoped>\n.manage-feedback {\n  padding: 20px;\n}\n\ntable {\n  width: 100%;\n  border-collapse: collapse;\n}\n\nth, td {\n  padding: 10px;\n  border: 1px solid #ccc;\n}\n\ntextarea {\n  width: 100%;\n}\n\nbutton {\n  padding: 10px 20px;\n  background-color: #4CAF50;\n  color: white;\n  border: none;\n  cursor: pointer;\n}\n\nbutton:hover {\n  background-color: #45a049;\n}\n\n.pagination {\n  margin-top: 20px;\n  text-align: center;\n}\n\n.pagination button {\n  margin: 0 10px;\n}\n</style>"],"mappings":";AAoCA,OAAOA,KAAI,MAAO,OAAO;AACzB,MAAMC,QAAO,GAAIC,OAAO,CAACC,GAAG,CAACC,gBAAgB;AAC7C,eAAe;EACbC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,SAAS,EAAE,EAAE;MACbC,WAAW,EAAE,CAAC;MACdC,QAAQ,EAAE,EAAE;MACZC,KAAK,EAAE,CAAC;MACRC,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,oBAAoB,CAAC,CAAC;EAC7B,CAAC;EACDC,OAAO,EAAE;IACP,MAAMD,oBAAoBA,CAAA,EAAG;MAC3B,MAAME,QAAO,GAAIC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MACjD,IAAIF,QAAO,KAAM,OAAM,IAAKA,QAAO,KAAM,aAAa,EAAE;QACtDG,KAAK,CAAC,SAAS,CAAC;QAChB,IAAI,CAACC,OAAO,CAACC,IAAI,CAAC,GAAG,CAAC;QACtB;MACF;MACA,IAAI,CAACT,OAAM,GAAI,IAAI;MACnB,IAAI,CAACU,cAAc,CAAC,CAAC;IACvB,CAAC;IACD,MAAMA,cAAcA,CAAA,EAAG;MACrB,IAAI;QACF,MAAMC,QAAO,GAAI,MAAMrB,KAAK,CAACsB,GAAG,CAAC,GAAGrB,QAAQ,uBAAuB,EAAE;UACnEsB,MAAM,EAAE;YACNC,IAAI,EAAE,IAAI,CAACjB,WAAW;YACtBC,QAAQ,EAAE,IAAI,CAACA;UACjB;QACF,CAAC,CAAC;QACF,IAAI,CAACF,SAAQ,GAAIe,QAAQ,CAAChB,IAAI,CAACoB,KAAK,CAACC,GAAG,CAACC,QAAO,KAAM;UACpD,GAAGA,QAAQ;UACXC,WAAW,EAAED,QAAQ,CAACC,WAAU,IAAK;QACvC,CAAC,CAAC,CAAC;QACH,IAAI,CAACnB,KAAI,GAAIY,QAAQ,CAAChB,IAAI,CAACI,KAAK;MAClC,EAAE,OAAOoB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/BZ,KAAK,CAAC,cAAc,CAAC;MACvB;IACF,CAAC;IACD,MAAMc,aAAaA,CAACC,UAAU,EAAE;MAC9B,MAAML,QAAO,GAAI,IAAI,CAACrB,SAAS,CAAC2B,IAAI,CAACC,IAAG,IAAKA,IAAI,CAACC,EAAC,KAAMH,UAAU,CAAC;MACpE,IAAI,CAACL,QAAQ,CAACC,WAAW,CAACQ,IAAI,CAAC,CAAC,EAAE;QAChCnB,KAAK,CAAC,UAAU,CAAC;QACjB;MACF;MAEA,IAAIU,QAAQ,CAACC,WAAW,CAACS,MAAK,GAAI,GAAG,EAAE;QACrCpB,KAAK,CAAC,eAAe,CAAC;QACtB;MACF;MAEA,IAAI;QACF,MAAMjB,KAAK,CAACsC,GAAG,CAAC,GAAGrC,QAAQ,yBAAyB+B,UAAU,QAAQ,EAAE;UACtEJ,WAAW,EAAED,QAAQ,CAACC;QACxB,CAAC,CAAC;QACFX,KAAK,CAAC,MAAM,CAAC;QACb,IAAI,CAACG,cAAc,CAAC,CAAC,EAAE;MACzB,EAAE,OAAOS,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK,CAAC;QAC/BZ,KAAK,CAAC,YAAY,CAAC;MACrB;IACF,CAAC;IACDsB,gBAAgBA,CAACf,IAAI,EAAE;MACrB,IAAI,CAACjB,WAAU,GAAIiB,IAAI;MACvB,IAAI,CAACJ,cAAc,CAAC,CAAC;IACvB;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}