{"ast":null,"code":"import axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\nexport default {\n  data() {\n    return {\n      feedbackMessage: '',\n      // 用户输入的留言内容\n      feedbacks: [],\n      // 留言和回复的历史记录\n      feedbackSubmitted: false,\n      // 提交留言成功标志\n      message: {\n        show: false,\n        content: '',\n        type: ''\n      }\n    };\n  },\n  mounted() {\n    this.loadFeedbacks(); // 页面加载时，获取用户的留言历史\n  },\n  methods: {\n    // 获取用户的留言和回复历史\n    async loadFeedbacks() {\n      const userId = localStorage.getItem('userId');\n      if (!userId) {\n        this.showMessage('未登录', 'error');\n        return;\n      }\n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedbacks`, {\n          params: {\n            user_id: userId\n          }\n        });\n        this.feedbacks = response.data.feedbacks; // 设置留言历史\n      } catch (error) {\n        console.error('加载留言历史失败:', error);\n        this.showMessage('加载留言历史失败，请稍后重试', 'error');\n      }\n    },\n    // 提交留言\n    async submitFeedback() {\n      const userId = localStorage.getItem('userId');\n      if (!userId) {\n        this.showMessage('未登录', 'error');\n        return;\n      }\n      if (!this.feedbackMessage.trim()) {\n        this.showMessage('留言内容不能为空', 'error');\n        return;\n      }\n      try {\n        const response = await axios.post(`${BASE_URL}/api/canteen/feedback`, {\n          user_id: userId,\n          message: this.feedbackMessage\n        });\n        this.showMessage('留言提交成功');\n        this.feedbackMessage = ''; // 清空留言内容\n\n        this.feedbackSubmitted = true; // 显示提交成功提示\n        setTimeout(() => {\n          this.feedbackSubmitted = false;\n        }, 2000);\n\n        // 重新加载留言历史，显示新的留言和可能的回复\n        this.loadFeedbacks();\n      } catch (error) {\n        console.error('提交留言失败:', error);\n        this.showMessage('提交留言失败，请稍后重试', 'error');\n      }\n    },\n    // 删除留言\n    async deleteFeedback(feedback) {\n      if (!confirm('确定要删除这条留言吗？')) {\n        return;\n      }\n      try {\n        await axios.delete(`${BASE_URL}/api/canteen/feedback/${feedback.id}`, {\n          data: {\n            user_id: localStorage.getItem('userId'),\n            is_admin: false\n          }\n        });\n        this.showMessage('留言已删除');\n        await this.loadFeedbacks(); // 重新获取留言列表\n      } catch (error) {\n        console.error('删除留言失败:', error);\n        this.showMessage(error.response?.data?.message || '删除失败，请稍后重试', 'error');\n      }\n    },\n    // 显示提示消息\n    showMessage(content, type = 'success') {\n      this.message = {\n        show: true,\n        content,\n        type\n      };\n      setTimeout(() => {\n        this.message.show = false;\n      }, 3000);\n    },\n    // 格式化时间\n    formatTime(time) {\n      return new Date(time).toLocaleString();\n    }\n  }\n};","map":{"version":3,"names":["axios","BASE_URL","process","env","VUE_APP_BASE_URL","data","feedbackMessage","feedbacks","feedbackSubmitted","message","show","content","type","mounted","loadFeedbacks","methods","userId","localStorage","getItem","showMessage","response","get","params","user_id","error","console","submitFeedback","trim","post","setTimeout","deleteFeedback","feedback","confirm","delete","id","is_admin","formatTime","time","Date","toLocaleString"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\SubmitFeedback.vue"],"sourcesContent":["<template>\n  <div class=\"submit-feedback\">\n    <h2>提交您的建议或留言</h2>\n\n    <!-- 显示历史留言 -->\n    <div class=\"feedback-history\" v-if=\"feedbacks.length > 0\">\n      <h3>我的留言历史</h3>\n      <div v-for=\"feedback in feedbacks\" :key=\"feedback.id\" class=\"feedback-item\">\n        <div class=\"feedback-header\">\n          <span class=\"feedback-time\">{{ formatTime(feedback.created_at) }}</span>\n          <button class=\"delete-btn\" @click=\"deleteFeedback(feedback)\">删除</button>\n        </div>\n        <div class=\"feedback-content\">\n          <p><strong>留言：</strong>{{ feedback.message }}</p>\n          <p v-if=\"feedback.admin_reply\" class=\"admin-reply\">\n            <strong>管理员回复：</strong>{{ feedback.admin_reply }}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <!-- 留言输入框 -->\n    <textarea v-model=\"feedbackMessage\" placeholder=\"请填写您的留言\" rows=\"4\" required></textarea>\n\n    <!-- 提交按钮 -->\n    <button @click=\"submitFeedback\">提交留言</button>\n\n    <!-- 提交后提示 -->\n    <div v-if=\"feedbackSubmitted\" class=\"submit-success\">\n      <p>留言提交成功！</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  data() {\n    return {\n      feedbackMessage: '', // 用户输入的留言内容\n      feedbacks: [], // 留言和回复的历史记录\n      feedbackSubmitted: false, // 提交留言成功标志\n      message: {\n        show: false,\n        content: '',\n        type: ''\n      }\n    };\n  },\n  mounted() {\n    this.loadFeedbacks(); // 页面加载时，获取用户的留言历史\n  },\n  methods: {\n    // 获取用户的留言和回复历史\n    async loadFeedbacks() {\n      const userId = localStorage.getItem('userId');\n      if (!userId) {\n        this.showMessage('未登录', 'error');\n        return;\n      }\n      \n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedbacks`, {\n          params: { user_id: userId },\n        });\n        this.feedbacks = response.data.feedbacks; // 设置留言历史\n      } catch (error) {\n        console.error('加载留言历史失败:', error);\n        this.showMessage('加载留言历史失败，请稍后重试', 'error');\n      }\n    },\n\n    // 提交留言\n    async submitFeedback() {\n      const userId = localStorage.getItem('userId');\n\n      if (!userId) {\n        this.showMessage('未登录', 'error');\n        return;\n      }\n\n      if (!this.feedbackMessage.trim()) {\n        this.showMessage('留言内容不能为空', 'error');\n        return;\n      }\n\n      try {\n        const response = await axios.post(`${BASE_URL}/api/canteen/feedback`, {\n          user_id: userId,\n          message: this.feedbackMessage,\n        });\n\n        this.showMessage('留言提交成功');\n        this.feedbackMessage = ''; // 清空留言内容\n\n        this.feedbackSubmitted = true; // 显示提交成功提示\n        setTimeout(() => {\n          this.feedbackSubmitted = false;\n        }, 2000);\n\n        // 重新加载留言历史，显示新的留言和可能的回复\n        this.loadFeedbacks();\n      } catch (error) {\n        console.error('提交留言失败:', error);\n        this.showMessage('提交留言失败，请稍后重试', 'error');\n      }\n    },\n\n    // 删除留言\n    async deleteFeedback(feedback) {\n      if (!confirm('确定要删除这条留言吗？')) {\n        return;\n      }\n\n      try {\n        await axios.delete(`${BASE_URL}/api/canteen/feedback/${feedback.id}`, {\n          data: {\n            user_id: localStorage.getItem('userId'),\n            is_admin: false\n          }\n        });\n        \n        this.showMessage('留言已删除');\n        await this.loadFeedbacks(); // 重新获取留言列表\n      } catch (error) {\n        console.error('删除留言失败:', error);\n        this.showMessage(\n          error.response?.data?.message || '删除失败，请稍后重试',\n          'error'\n        );\n      }\n    },\n\n    // 显示提示消息\n    showMessage(content, type = 'success') {\n      this.message = {\n        show: true,\n        content,\n        type\n      };\n      setTimeout(() => {\n        this.message.show = false;\n      }, 3000);\n    },\n\n    // 格式化时间\n    formatTime(time) {\n      return new Date(time).toLocaleString();\n    }\n  },\n};\n</script>\n\n<style scoped>\n.submit-feedback {\n  padding: 20px;\n}\n\ntextarea {\n  width: 100%;\n  margin-bottom: 10px;\n  padding: 10px;\n}\n\nbutton {\n  padding: 10px 20px;\n  background-color: #4CAF50;\n  color: white;\n  border: none;\n  cursor: pointer;\n}\n\nbutton:hover {\n  background-color: #45a049;\n}\n\n.feedback-item {\n  margin-bottom: 20px;\n  border: 1px solid #ddd;\n  padding: 10px;\n}\n\n.feedback-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.feedback-time {\n  color: #666;\n  font-size: 0.9em;\n}\n\n.delete-btn {\n  padding: 4px 8px;\n  font-size: 12px;\n  background-color: #ff5252;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.delete-btn:hover {\n  background-color: #ff1744;\n  transform: translateY(-1px);\n}\n\n.submit-success {\n  background-color: #d4edda;\n  padding: 10px;\n  margin-top: 10px;\n  border-radius: 5px;\n  color: #155724;\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}