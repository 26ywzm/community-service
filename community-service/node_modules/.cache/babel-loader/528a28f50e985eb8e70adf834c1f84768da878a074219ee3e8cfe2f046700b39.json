{"ast":null,"code":"import axios from 'axios';\nimport { ElMessage } from 'element-plus';\nconst API = process.env.VUE_APP_BASE_URL;\nexport default {\n  name: 'VoteDetail',\n  data() {\n    return {\n      vote: {\n        title: '',\n        description: '',\n        options: [],\n        results: {},\n        totalVotes: 0\n      },\n      hasVoted: false,\n      loading: true\n    };\n  },\n  mounted() {\n    this.fetchVoteDetails();\n  },\n  methods: {\n    async fetchVoteDetails() {\n      const voteId = this.$route.params.id;\n      try {\n        const response = await axios.get(`${API}/api/canteen/votes/${voteId}`);\n        this.vote = {\n          ...response.data,\n          results: response.data.results || {},\n          totalVotes: response.data.totalVotes || 0\n        };\n\n        // 检查用户是否已投票\n        const userId = localStorage.getItem('userId');\n        const voteResponse = await axios.get(`${API}/api/canteen/votes/${voteId}/user/${userId}`);\n        this.hasVoted = voteResponse.data.hasVoted;\n      } catch (error) {\n        console.error('获取投票详情失败:', error);\n        ElMessage.error('获取投票详情失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    async submitVote(option) {\n      const voteId = this.$route.params.id;\n      try {\n        await axios.post(`${API}/api/canteen/votes/${voteId}/vote`, {\n          option\n        }, {\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n          }\n        });\n        ElMessage.success('投票成功');\n        this.hasVoted = true;\n        await this.fetchVoteDetails(); // 刷新投票结果\n      } catch (error) {\n        console.error('投票失败:', error);\n        if (error.response?.status === 401) {\n          ElMessage.error('请先登录后再投票');\n        } else if (error.response?.data?.message) {\n          ElMessage.error(error.response.data.message);\n        } else {\n          ElMessage.error('投票失败，请稍后重试');\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","ElMessage","API","process","env","VUE_APP_BASE_URL","name","data","vote","title","description","options","results","totalVotes","hasVoted","loading","mounted","fetchVoteDetails","methods","voteId","$route","params","id","response","get","userId","localStorage","getItem","voteResponse","error","console","submitVote","option","post","headers","success","status","message"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\VoteDetail.vue"],"sourcesContent":["<template>\n  <div class=\"vote-detail\">\n    <div v-if=\"loading\" class=\"loading\">\n      <span>加载中...</span>\n    </div>\n    <div v-else class=\"vote-content\">\n      <div class=\"vote-header\">\n        <h2>{{ vote.title }}</h2>\n        <p class=\"description\">{{ vote.description }}</p>\n      </div>\n\n      <div v-if=\"!hasVoted\" class=\"vote-options\">\n        <h3>请选择您的选项：</h3>\n        <div class=\"options-list\">\n          <div \n            v-for=\"(option, index) in vote.options\" \n            :key=\"index\"\n            class=\"option-item\"\n          >\n            <button \n              @click=\"submitVote(option)\"\n              class=\"option-button\"\n            >\n              {{ option }}\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <div v-else class=\"vote-result\">\n        <div class=\"result-message\">\n          <i class=\"el-icon-check\"></i>\n          <span>您已完成投票</span>\n        </div>\n        <div class=\"vote-stats\">\n          <h3>当前投票结果：</h3>\n          <div class=\"stats-list\">\n            <div \n              v-for=\"(count, option) in vote.results\" \n              :key=\"option\" \n              class=\"stat-item\"\n            >\n              <div class=\"stat-label\">{{ option }}</div>\n              <div class=\"stat-bar-container\">\n                <div \n                  class=\"stat-bar\" \n                  :style=\"{ width: ((count / vote.totalVotes) * 100) + '%' }\"\n                ></div>\n                <span class=\"stat-value\">{{ count }}票 ({{ ((count / vote.totalVotes) * 100).toFixed(1) }}%)</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"vote-actions\">\n        <router-link to=\"/votelist\" class=\"back-button\">\n          返回投票列表\n        </router-link>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport { ElMessage } from 'element-plus';\nconst API = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  name: 'VoteDetail',\n  data() {\n    return {\n      vote: {\n        title: '',\n        description: '',\n        options: [],\n        results: {},\n        totalVotes: 0\n      },\n      hasVoted: false,\n      loading: true\n    };\n  },\n  mounted() {\n    this.fetchVoteDetails();\n  },\n  methods: {\n    async fetchVoteDetails() {\n      const voteId = this.$route.params.id;\n      try {\n        const response = await axios.get(`${API}/api/canteen/votes/${voteId}`);\n        this.vote = {\n          ...response.data,\n          results: response.data.results || {},\n          totalVotes: response.data.totalVotes || 0\n        };\n        \n        // 检查用户是否已投票\n        const userId = localStorage.getItem('userId');\n        const voteResponse = await axios.get(`${API}/api/canteen/votes/${voteId}/user/${userId}`);\n        this.hasVoted = voteResponse.data.hasVoted;\n      } catch (error) {\n        console.error('获取投票详情失败:', error);\n        ElMessage.error('获取投票详情失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    async submitVote(option) {\n      const voteId = this.$route.params.id;\n      \n      try {\n        await axios.post(`${API}/api/canteen/votes/${voteId}/vote`, \n          { option },\n          {\n            headers: {\n              'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n            }\n          }\n        );\n        ElMessage.success('投票成功');\n        this.hasVoted = true;\n        await this.fetchVoteDetails(); // 刷新投票结果\n      } catch (error) {\n        console.error('投票失败:', error);\n        if (error.response?.status === 401) {\n          ElMessage.error('请先登录后再投票');\n        } else if (error.response?.data?.message) {\n          ElMessage.error(error.response.data.message);\n        } else {\n          ElMessage.error('投票失败，请稍后重试');\n        }\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.vote-detail {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.loading {\n  text-align: center;\n  padding: 40px;\n  color: #666;\n}\n\n.vote-content {\n  background: white;\n  border-radius: 8px;\n  padding: 30px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n}\n\n.vote-header {\n  text-align: center;\n  margin-bottom: 30px;\n}\n\n.vote-header h2 {\n  color: #333;\n  margin: 0 0 15px 0;\n}\n\n.description {\n  color: #666;\n  line-height: 1.6;\n}\n\n.vote-options {\n  margin: 30px 0;\n}\n\n.vote-options h3 {\n  color: #333;\n  margin-bottom: 20px;\n}\n\n.options-list {\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 15px;\n}\n\n.option-button {\n  width: 100%;\n  padding: 15px 20px;\n  background-color: #409EFF;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.3s;\n  font-size: 1em;\n}\n\n.option-button:hover {\n  background-color: #66b1ff;\n  transform: translateY(-2px);\n}\n\n.vote-result {\n  margin: 30px 0;\n}\n\n.result-message {\n  text-align: center;\n  color: #67C23A;\n  margin-bottom: 30px;\n  font-size: 1.1em;\n}\n\n.vote-stats h3 {\n  color: #333;\n  margin-bottom: 20px;\n}\n\n.stats-list {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n}\n\n.stat-item {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.stat-label {\n  width: 120px;\n  color: #333;\n}\n\n.stat-bar-container {\n  flex: 1;\n  height: 24px;\n  background: #f5f7fa;\n  border-radius: 12px;\n  position: relative;\n  overflow: hidden;\n}\n\n.stat-bar {\n  height: 100%;\n  background: #409EFF;\n  border-radius: 12px;\n  transition: width 0.3s ease;\n}\n\n.stat-value {\n  position: absolute;\n  right: 10px;\n  top: 50%;\n  transform: translateY(-50%);\n  color: #333;\n  font-size: 0.9em;\n}\n\n.vote-actions {\n  margin-top: 30px;\n  text-align: center;\n}\n\n.back-button {\n  display: inline-block;\n  padding: 10px 20px;\n  background-color: #909399;\n  color: white;\n  text-decoration: none;\n  border-radius: 4px;\n  transition: background-color 0.3s;\n}\n\n.back-button:hover {\n  background-color: #a6a9ad;\n}\n</style>"],"mappings":"AAiEA,OAAOA,KAAI,MAAO,OAAO;AACzB,SAASC,SAAQ,QAAS,cAAc;AACxC,MAAMC,GAAE,GAAIC,OAAO,CAACC,GAAG,CAACC,gBAAgB;AAExC,eAAe;EACbC,IAAI,EAAE,YAAY;EAClBC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,IAAI,EAAE;QACJC,KAAK,EAAE,EAAE;QACTC,WAAW,EAAE,EAAE;QACfC,OAAO,EAAE,EAAE;QACXC,OAAO,EAAE,CAAC,CAAC;QACXC,UAAU,EAAE;MACd,CAAC;MACDC,QAAQ,EAAE,KAAK;MACfC,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,gBAAgB,CAAC,CAAC;EACzB,CAAC;EACDC,OAAO,EAAE;IACP,MAAMD,gBAAgBA,CAAA,EAAG;MACvB,MAAME,MAAK,GAAI,IAAI,CAACC,MAAM,CAACC,MAAM,CAACC,EAAE;MACpC,IAAI;QACF,MAAMC,QAAO,GAAI,MAAMvB,KAAK,CAACwB,GAAG,CAAC,GAAGtB,GAAG,sBAAsBiB,MAAM,EAAE,CAAC;QACtE,IAAI,CAACX,IAAG,GAAI;UACV,GAAGe,QAAQ,CAAChB,IAAI;UAChBK,OAAO,EAAEW,QAAQ,CAAChB,IAAI,CAACK,OAAM,IAAK,CAAC,CAAC;UACpCC,UAAU,EAAEU,QAAQ,CAAChB,IAAI,CAACM,UAAS,IAAK;QAC1C,CAAC;;QAED;QACA,MAAMY,MAAK,GAAIC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;QAC7C,MAAMC,YAAW,GAAI,MAAM5B,KAAK,CAACwB,GAAG,CAAC,GAAGtB,GAAG,sBAAsBiB,MAAM,SAASM,MAAM,EAAE,CAAC;QACzF,IAAI,CAACX,QAAO,GAAIc,YAAY,CAACrB,IAAI,CAACO,QAAQ;MAC5C,EAAE,OAAOe,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK,CAAC;QACjC5B,SAAS,CAAC4B,KAAK,CAAC,UAAU,CAAC;MAC7B,UAAU;QACR,IAAI,CAACd,OAAM,GAAI,KAAK;MACtB;IACF,CAAC;IAED,MAAMgB,UAAUA,CAACC,MAAM,EAAE;MACvB,MAAMb,MAAK,GAAI,IAAI,CAACC,MAAM,CAACC,MAAM,CAACC,EAAE;MAEpC,IAAI;QACF,MAAMtB,KAAK,CAACiC,IAAI,CAAC,GAAG/B,GAAG,sBAAsBiB,MAAM,OAAO,EACxD;UAAEa;QAAO,CAAC,EACV;UACEE,OAAO,EAAE;YACP,eAAe,EAAE,UAAUR,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC;UAC9D;QACF,CACF,CAAC;QACD1B,SAAS,CAACkC,OAAO,CAAC,MAAM,CAAC;QACzB,IAAI,CAACrB,QAAO,GAAI,IAAI;QACpB,MAAM,IAAI,CAACG,gBAAgB,CAAC,CAAC,EAAE;MACjC,EAAE,OAAOY,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK,CAAC;QAC7B,IAAIA,KAAK,CAACN,QAAQ,EAAEa,MAAK,KAAM,GAAG,EAAE;UAClCnC,SAAS,CAAC4B,KAAK,CAAC,UAAU,CAAC;QAC7B,OAAO,IAAIA,KAAK,CAACN,QAAQ,EAAEhB,IAAI,EAAE8B,OAAO,EAAE;UACxCpC,SAAS,CAAC4B,KAAK,CAACA,KAAK,CAACN,QAAQ,CAAChB,IAAI,CAAC8B,OAAO,CAAC;QAC9C,OAAO;UACLpC,SAAS,CAAC4B,KAAK,CAAC,YAAY,CAAC;QAC/B;MACF;IACF;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}