{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, vModelText as _vModelText, withDirectives as _withDirectives } from \"vue\";\nconst _hoisted_1 = {\n  class: \"submit-feedback\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"feedback-history\"\n};\nconst _hoisted_3 = {\n  class: \"feedback-header\"\n};\nconst _hoisted_4 = {\n  class: \"feedback-time\"\n};\nconst _hoisted_5 = [\"onClick\"];\nconst _hoisted_6 = {\n  class: \"feedback-content\"\n};\nconst _hoisted_7 = {\n  key: 0,\n  class: \"admin-reply\"\n};\nconst _hoisted_8 = {\n  key: 1,\n  class: \"submit-success\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[6] || (_cache[6] = _createElementVNode(\"h2\", null, \"提交您的建议或留言\", -1 /* HOISTED */)), _createCommentVNode(\" 显示历史留言 \"), $data.feedbacks.length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"我的留言历史\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.feedbacks, feedback => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: feedback.id,\n      class: \"feedback-item\"\n    }, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"span\", _hoisted_4, _toDisplayString($options.formatTime(feedback.created_at)), 1 /* TEXT */), _createElementVNode(\"button\", {\n      class: \"delete-btn\",\n      onClick: $event => $options.deleteFeedback(feedback)\n    }, \"删除\", 8 /* PROPS */, _hoisted_5)]), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"p\", null, [_cache[2] || (_cache[2] = _createElementVNode(\"strong\", null, \"留言：\", -1 /* HOISTED */)), _createTextVNode(_toDisplayString(feedback.message), 1 /* TEXT */)]), feedback.admin_reply ? (_openBlock(), _createElementBlock(\"p\", _hoisted_7, [_cache[3] || (_cache[3] = _createElementVNode(\"strong\", null, \"管理员回复：\", -1 /* HOISTED */)), _createTextVNode(_toDisplayString(feedback.admin_reply), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])]);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 留言输入框 \"), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.feedbackMessage = $event),\n    placeholder: \"请填写您的留言\",\n    rows: \"4\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.feedbackMessage]]), _createCommentVNode(\" 提交按钮 \"), _createElementVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.submitFeedback && $options.submitFeedback(...args))\n  }, \"提交留言\"), _createCommentVNode(\" 提交后提示 \"), $data.feedbackSubmitted ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, _cache[5] || (_cache[5] = [_createElementVNode(\"p\", null, \"留言提交成功！\", -1 /* HOISTED */)]))) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_createCommentVNode","$data","feedbacks","length","_hoisted_2","_Fragment","_renderList","feedback","id","_hoisted_3","_hoisted_4","_toDisplayString","$options","formatTime","created_at","onClick","$event","deleteFeedback","_hoisted_5","_hoisted_6","_createTextVNode","message","admin_reply","_hoisted_7","_cache","feedbackMessage","placeholder","rows","required","args","submitFeedback","feedbackSubmitted","_hoisted_8"],"sources":["C:\\Users\\拯救者\\Desktop\\text\\community-service\\src\\components\\SubmitFeedback.vue"],"sourcesContent":["<template>\n  <div class=\"submit-feedback\">\n    <h2>提交您的建议或留言</h2>\n\n    <!-- 显示历史留言 -->\n    <div class=\"feedback-history\" v-if=\"feedbacks.length > 0\">\n      <h3>我的留言历史</h3>\n      <div v-for=\"feedback in feedbacks\" :key=\"feedback.id\" class=\"feedback-item\">\n        <div class=\"feedback-header\">\n          <span class=\"feedback-time\">{{ formatTime(feedback.created_at) }}</span>\n          <button class=\"delete-btn\" @click=\"deleteFeedback(feedback)\">删除</button>\n        </div>\n        <div class=\"feedback-content\">\n          <p><strong>留言：</strong>{{ feedback.message }}</p>\n          <p v-if=\"feedback.admin_reply\" class=\"admin-reply\">\n            <strong>管理员回复：</strong>{{ feedback.admin_reply }}\n          </p>\n        </div>\n      </div>\n    </div>\n\n    <!-- 留言输入框 -->\n    <textarea v-model=\"feedbackMessage\" placeholder=\"请填写您的留言\" rows=\"4\" required></textarea>\n\n    <!-- 提交按钮 -->\n    <button @click=\"submitFeedback\">提交留言</button>\n\n    <!-- 提交后提示 -->\n    <div v-if=\"feedbackSubmitted\" class=\"submit-success\">\n      <p>留言提交成功！</p>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\nconst BASE_URL = process.env.VUE_APP_BASE_URL;\n\nexport default {\n  data() {\n    return {\n      feedbackMessage: '', // 用户输入的留言内容\n      feedbacks: [], // 留言和回复的历史记录\n      feedbackSubmitted: false, // 提交留言成功标志\n      message: {\n        show: false,\n        content: '',\n        type: ''\n      }\n    };\n  },\n  mounted() {\n    this.loadFeedbacks(); // 页面加载时，获取用户的留言历史\n  },\n  methods: {\n    // 获取用户的留言和回复历史\n    async loadFeedbacks() {\n      const userId = localStorage.getItem('userId');\n      if (!userId) {\n        this.showMessage('未登录', 'error');\n        return;\n      }\n      \n      try {\n        const response = await axios.get(`${BASE_URL}/api/canteen/feedbacks`, {\n          params: { user_id: userId },\n        });\n        this.feedbacks = response.data.feedbacks; // 设置留言历史\n      } catch (error) {\n        console.error('加载留言历史失败:', error);\n        this.showMessage('加载留言历史失败，请稍后重试', 'error');\n      }\n    },\n\n    // 提交留言\n    async submitFeedback() {\n      const userId = localStorage.getItem('userId');\n\n      if (!userId) {\n        this.showMessage('未登录', 'error');\n        return;\n      }\n\n      if (!this.feedbackMessage.trim()) {\n        this.showMessage('留言内容不能为空', 'error');\n        return;\n      }\n\n      try {\n        const response = await axios.post(`${BASE_URL}/api/canteen/feedback`, {\n          user_id: userId,\n          message: this.feedbackMessage,\n        });\n\n        this.showMessage('留言提交成功');\n        this.feedbackMessage = ''; // 清空留言内容\n\n        this.feedbackSubmitted = true; // 显示提交成功提示\n        setTimeout(() => {\n          this.feedbackSubmitted = false;\n        }, 2000);\n\n        // 重新加载留言历史，显示新的留言和可能的回复\n        this.loadFeedbacks();\n      } catch (error) {\n        console.error('提交留言失败:', error);\n        this.showMessage('提交留言失败，请稍后重试', 'error');\n      }\n    },\n\n    // 删除留言\n    async deleteFeedback(feedback) {\n      if (!confirm('确定要删除这条留言吗？')) {\n        return;\n      }\n\n      try {\n        await axios.delete(`${BASE_URL}/api/canteen/feedback/${feedback.id}`, {\n          data: {\n            user_id: localStorage.getItem('userId'),\n            is_admin: false\n          }\n        });\n        \n        this.showMessage('留言已删除');\n        await this.loadFeedbacks(); // 重新获取留言列表\n      } catch (error) {\n        console.error('删除留言失败:', error);\n        this.showMessage(\n          error.response?.data?.message || '删除失败，请稍后重试',\n          'error'\n        );\n      }\n    },\n\n    // 显示提示消息\n    showMessage(content, type = 'success') {\n      this.message = {\n        show: true,\n        content,\n        type\n      };\n      setTimeout(() => {\n        this.message.show = false;\n      }, 3000);\n    },\n\n    // 格式化时间\n    formatTime(time) {\n      return new Date(time).toLocaleString();\n    }\n  },\n};\n</script>\n\n<style scoped>\n.submit-feedback {\n  padding: 20px;\n}\n\ntextarea {\n  width: 100%;\n  margin-bottom: 10px;\n  padding: 10px;\n}\n\nbutton {\n  padding: 10px 20px;\n  background-color: #4CAF50;\n  color: white;\n  border: none;\n  cursor: pointer;\n}\n\nbutton:hover {\n  background-color: #45a049;\n}\n\n.feedback-item {\n  margin-bottom: 20px;\n  border: 1px solid #ddd;\n  padding: 10px;\n}\n\n.feedback-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.feedback-time {\n  color: #666;\n  font-size: 0.9em;\n}\n\n.delete-btn {\n  padding: 4px 8px;\n  font-size: 12px;\n  background-color: #ff5252;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.delete-btn:hover {\n  background-color: #ff1744;\n  transform: translateY(-1px);\n}\n\n.submit-success {\n  background-color: #d4edda;\n  padding: 10px;\n  margin-top: 10px;\n  border-radius: 5px;\n  color: #155724;\n}\n</style>"],"mappings":";;EACOA,KAAK,EAAC;AAAiB;;EAD9BC,GAAA;EAKSD,KAAK,EAAC;;;EAGFA,KAAK,EAAC;AAAiB;;EACpBA,KAAK,EAAC;AAAe;mBATrC;;EAYaA,KAAK,EAAC;AAAkB;;EAZrCC,GAAA;EAcyCD,KAAK,EAAC;;;EAd/CC,GAAA;EA4BkCD,KAAK,EAAC;;;uBA3BtCE,mBAAA,CA8BM,OA9BNC,UA8BM,G,0BA7BJC,mBAAA,CAAkB,YAAd,WAAS,sBAEbC,mBAAA,YAAe,EACqBC,KAAA,CAAAC,SAAS,CAACC,MAAM,Q,cAApDN,mBAAA,CAcM,OAdNO,UAcM,G,0BAbJL,mBAAA,CAAe,YAAX,QAAM,uB,kBACVF,mBAAA,CAWMQ,SAAA,QAlBZC,WAAA,CAO8BL,KAAA,CAAAC,SAAS,EAArBK,QAAQ;yBAApBV,mBAAA,CAWM;MAX8BD,GAAG,EAAEW,QAAQ,CAACC,EAAE;MAAEb,KAAK,EAAC;QAC1DI,mBAAA,CAGM,OAHNU,UAGM,GAFJV,mBAAA,CAAwE,QAAxEW,UAAwE,EAAAC,gBAAA,CAAzCC,QAAA,CAAAC,UAAU,CAACN,QAAQ,CAACO,UAAU,mBAC7Df,mBAAA,CAAwE;MAAhEJ,KAAK,EAAC,YAAY;MAAEoB,OAAK,EAAAC,MAAA,IAAEJ,QAAA,CAAAK,cAAc,CAACV,QAAQ;OAAG,IAAE,iBAVzEW,UAAA,E,GAYQnB,mBAAA,CAKM,OALNoB,UAKM,GAJJpB,mBAAA,CAAiD,Y,0BAA9CA,mBAAA,CAAoB,gBAAZ,KAAG,sBAbxBqB,gBAAA,CAAAT,gBAAA,CAaoCJ,QAAQ,CAACc,OAAO,iB,GACjCd,QAAQ,CAACe,WAAW,I,cAA7BzB,mBAAA,CAEI,KAFJ0B,UAEI,G,0BADFxB,mBAAA,CAAuB,gBAAf,QAAM,sBAf1BqB,gBAAA,CAAAT,gBAAA,CAesCJ,QAAQ,CAACe,WAAW,iB,KAf1DtB,mBAAA,e;sCAAAA,mBAAA,gBAqBIA,mBAAA,WAAc,E,gBACdD,mBAAA,CAAuF;IAtB3F,uBAAAyB,MAAA,QAAAA,MAAA,MAAAR,MAAA,IAsBuBf,KAAA,CAAAwB,eAAe,GAAAT,MAAA;IAAEU,WAAW,EAAC,SAAS;IAACC,IAAI,EAAC,GAAG;IAACC,QAAQ,EAAR;iDAAhD3B,KAAA,CAAAwB,eAAe,E,GAElCzB,mBAAA,UAAa,EACbD,mBAAA,CAA6C;IAApCgB,OAAK,EAAAS,MAAA,QAAAA,MAAA,UAAAK,IAAA,KAAEjB,QAAA,CAAAkB,cAAA,IAAAlB,QAAA,CAAAkB,cAAA,IAAAD,IAAA,CAAc;KAAE,MAAI,GAEpC7B,mBAAA,WAAc,EACHC,KAAA,CAAA8B,iBAAiB,I,cAA5BlC,mBAAA,CAEM,OAFNmC,UAEM,EAAAR,MAAA,QAAAA,MAAA,OADJzB,mBAAA,CAAc,WAAX,SAAO,oB,MA7BhBC,mBAAA,e","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}